!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Muuri=e()}(this,(function(){"use strict";const t=new Map,e=new Map,i="swap",s="move",n="instant",r="layoutStart",o="layoutEnd",h="layoutAbort",a="remove",l="hideStart",d="filter",c="sort",_="move",u="send",m="beforeSend",g="receive",f="beforeReceive",p="dragReleaseEnd",v="ontouchstart"in window,y=!!window.PointerEvent,w=window.navigator.userAgent.toLowerCase(),S=w.indexOf("firefox")>-1,b=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),D=w.indexOf("android")>-1,A=/^(iPad|iPhone|iPod)/.test(window.navigator.platform)||/^Mac/.test(window.navigator.platform)&&window.navigator.maxTouchPoints>1,T=100,k=(()=>{let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t})(),x=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame).bind(window);class R{constructor(){this._queue=[],this._indices=new Map,this._callbacks=new Map}add(t,e){const{_queue:i,_indices:s,_callbacks:n}=this,r=s.get(t);void 0!==r&&(i[r]=void 0),i.push(t),n.set(t,e),s.set(t,i.length-1)}remove(t){const{_queue:e,_indices:i,_callbacks:s}=this,n=i.get(t);void 0!==n&&(e[n]=void 0,s.delete(t),i.delete(t))}flush(t,e){const{_queue:i,_callbacks:s,_indices:n}=this;let r,o=0;for(;o<i.length;o++)r=i[o],r&&!e.has(r)&&(t.push(r),e.set(r,s.get(r)));i.length=0,s.clear(),n.clear()}}const C="layoutRead",E="layoutWrite",L="visibilityRead",X="visibilityWrite",Y="dragStartRead",I="dragStartWrite",M="dragMoveRead",P="dragMoveWrite",O="dragScrollRead",q="dragScrollWrite",H="dragSortRead",G="releaseScrollRead",W="releaseScrollWrite",N="placeholderLayoutRead",V="placeholderLayoutWrite",B="placeholderResizeWrite",F="autoScrollRead",z="autoScrollWrite",j="debounceRead",Q=new class{constructor(t=1){this._nextStep=null,this._lanes=[],this._stepQueue=[],this._stepCallbacks=new Map,this._step=this._step.bind(this);let e=0;for(;e<t;e++)this._lanes.push(new R)}add(t,e,i){const s=this._lanes[t];s&&(s.add(e,i),this._nextStep||(this._nextStep=x(this._step)))}remove(t,e){const i=this._lanes[t];i&&i.remove(e)}_step(t){const{_lanes:e,_stepQueue:i,_stepCallbacks:s}=this;let n=0;for(this._nextStep=null,n=0;n<e.length;n++)e[n].flush(i,s);for(n=0;n<i.length;n++)s.get(i[n])(t);i.length=0,s.clear()}}(3);function U(t){Q.remove(0,C+t),Q.remove(2,E+t)}function Z(t){Q.remove(0,L+t),Q.remove(2,X+t)}function $(t){Q.remove(0,Y+t),Q.remove(2,I+t)}function J(t){Q.remove(0,M+t),Q.remove(2,P+t)}function K(t){Q.remove(0,O+t),Q.remove(2,q+t)}function tt(t,e){Q.add(1,H+t,e)}function et(t){Q.remove(0,N+t),Q.remove(2,V+t)}function it(t,e){Q.add(0,F,t),Q.add(2,z,e)}function st(t,e){return!(t.left+t.width<=e.left||e.left+e.width<=t.left||t.top+t.height<=e.top||e.top+e.height<=t.top)}function nt(t,e){const i=function(t,e){return st(t,e)?(Math.min(t.left+t.width,e.left+e.width)-Math.max(t.left,e.left))*(Math.min(t.top+t.height,e.top+e.height)-Math.max(t.top,e.top)):0}(t,e);if(!i)return 0;return i/(Math.min(t.width,e.width)*Math.min(t.height,e.height))*100}let rt=new WeakMap,ot=null,ht=!0;const at=function(){ht?ht=!0:(null!==ot&&(window.clearInterval(ot),ot=null),rt=new WeakMap)};function lt(t,e){if(!e)return"";let i=rt.get(t);return i||(i=window.getComputedStyle(t,null),rt.set(t,i)),ot?ht=!1:ot=window.setInterval(at,1e3),i.getPropertyValue(e)}function dt(t,e){return parseFloat(lt(t,e))||0}function ct(t){return"function"==typeof t}const _t={width:0,height:0,left:0,right:0,top:0,bottom:0},ut=Object.assign({},_t),mt={direction:0,threshold:0,distance:0,value:0,maxValue:0,duration:0,speed:0,deltaTime:0,isEnding:!1};function gt(t){return t===window}function ft(t){return gt(t)||t===document.documentElement||t===document.body?window:t}function pt(t){return gt(t)?t.pageXOffset:t.scrollLeft}function vt(t){return gt(t)?t.pageYOffset:t.scrollTop}function yt(t){return gt(t)?document.documentElement.scrollWidth-document.documentElement.clientWidth:t.scrollWidth-t.clientWidth}function wt(t){return gt(t)?document.documentElement.scrollHeight-document.documentElement.clientHeight:t.scrollHeight-t.clientHeight}function St(t,e={width:0,height:0,left:0,right:0,top:0,bottom:0}){if(gt(t))e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight,e.left=0,e.right=e.width,e.top=0,e.bottom=e.height;else{const{left:i,top:s}=t.getBoundingClientRect(),n=t.clientLeft||dt(t,"border-left-width"),r=t.clientTop||dt(t,"border-top-width");e.width=t.clientWidth,e.height=t.clientHeight,e.left=i+n,e.right=e.left+e.width,e.top=s+r,e.bottom=e.top+e.height}return e}function bt(t){return t.getGrid().settings.dragAutoScroll}function Dt(t){const e=t._drag;e&&e._prepareScroll()}function At(t){if(!t.isActive())return;const e=t._drag;e&&(e._scrollDiffX=e._scrollDiffY=0,t._setTranslate(e._translateX,e._translateY))}function Tt(t,e){return Math.min(e/2,t)}function kt(t,e,i,s){return Math.max(0,i+2*t+s*e-s)/2}class xt{constructor(t,e){this._pool=[],this._createObject=t,this._onRelease=e}pick(){return this._pool.pop()||this._createObject()}release(t){-1===this._pool.indexOf(t)&&(this._onRelease&&this._onRelease(t),this._pool.push(t))}reset(){this._pool.length=0}}class Rt{constructor(){this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}reset(){this.requestX&&(this.requestX.action=null),this.requestY&&(this.requestY.action=null),this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}addRequest(t){1&t.direction?(this.requestX&&this.removeRequest(this.requestX),this.requestX=t):(this.requestY&&this.removeRequest(this.requestY),this.requestY=t),t.action=this}removeRequest(t){this.requestX===t?(this.requestX=null,t.action=null):this.requestY===t&&(this.requestY=null,t.action=null)}computeScrollValues(){this.element&&(this.scrollLeft=this.requestX?this.requestX.value:pt(this.element),this.scrollTop=this.requestY?this.requestY.value:vt(this.element))}scroll(){this.element&&(this.element.scrollTo?this.element.scrollTo(this.scrollLeft,this.scrollTop):(this.element.scrollLeft=this.scrollLeft,this.element.scrollTop=this.scrollTop))}}class Ct{constructor(){this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}reset(){this.isActive&&this.onStop(),this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}hasReachedEnd(){return 4&this.direction?this.value>=this.maxValue:this.value<=0}computeCurrentScrollValue(){return this.element?this.value!=this.value?1&this.direction?pt(this.element):vt(this.element):Math.max(0,Math.min(this.value,this.maxValue)):0}computeNextScrollValue(){const t=this.speed*(this.deltaTime/1e3),e=4&this.direction?this.value+t:this.value-t;return Math.max(0,Math.min(e,this.maxValue))}computeSpeed(){if(!this.item||!this.element)return 0;const t=bt(this.item).speed;return ct(t)?(mt.direction=this.direction,mt.threshold=this.threshold,mt.distance=this.distance,mt.value=this.value,mt.maxValue=this.maxValue,mt.duration=this.duration,mt.speed=this.speed,mt.deltaTime=this.deltaTime,mt.isEnding=this.isEnding,t(this.item,this.element,mt)):t}tick(t){return this.isActive||(this.isActive=!0,this.onStart()),this.deltaTime=t,this.value=this.computeCurrentScrollValue(),this.speed=this.computeSpeed(),this.value=this.computeNextScrollValue(),this.duration+=t,this.value}onStart(){if(!this.item||!this.element)return;const{onStart:t}=bt(this.item);ct(t)&&t(this.item,this.element,this.direction)}onStop(){if(!this.item||!this.element)return;const{onStop:t}=bt(this.item);ct(t)&&t(this.item,this.element,this.direction);const e=this.item._drag;e&&e.sort()}}class Et{constructor(){this._isDestroyed=!1,this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,this._items=[],this._actions=[],this._requests={1:new Map,2:new Map},this._requestOverlapCheck=new Map,this._dragPositions=new Map,this._dragDirections=new Map,this._overlapCheckInterval=150,this._requestPool=new xt((()=>new Ct),(t=>t.reset())),this._actionPool=new xt((()=>new Rt),(t=>t.reset())),this._readTick=this._readTick.bind(this),this._writeTick=this._writeTick.bind(this)}isDestroyed(){return this._isDestroyed}addItem(t,e,i){if(this._isDestroyed)return;-1===this._items.indexOf(t)&&(this._items.push(t),this._requestOverlapCheck.set(t.id,this._tickTime),this._dragDirections.set(t.id,[0,0]),this._dragPositions.set(t.id,[e,i]),this._isTicking||this._startTicking())}updateItem(t,e,i){if(this._isDestroyed)return;const s=this._dragPositions.get(t.id),n=this._dragDirections.get(t.id);if(!s||!n)return;const r=s[0],o=s[1];n[0]=e>r?5:e<r?9:n[0]||0,n[1]=i>o?6:i<o?10:n[1]||0,s[0]=e,s[1]=i,this._requestOverlapCheck.set(t.id,this._requestOverlapCheck.get(t.id)||this._tickTime)}removeItem(t){if(this._isDestroyed)return;const e=this._items.indexOf(t);if(-1===e)return;const i=t.id;this._requests[1].get(i)&&(this._cancelItemScroll(t,1),this._requests[1].delete(i));this._requests[2].get(i)&&(this._cancelItemScroll(t,2),this._requests[2].delete(i)),this._requestOverlapCheck.delete(i),this._dragPositions.delete(i),this._dragDirections.delete(i),this._items.splice(e,1),this._isTicking&&!this._items.length&&this._stopTicking()}isItemScrollingX(t){const e=this._requests[1].get(t.id);return!(!e||!e.isActive)}isItemScrollingY(t){const e=this._requests[2].get(t.id);return!(!e||!e.isActive)}isItemScrolling(t){return this.isItemScrollingX(t)||this.isItemScrollingY(t)}destroy(){if(this._isDestroyed)return;const t=this._items.slice(0);let e=0;for(;e<t.length;e++)this.removeItem(t[e]);this._actions.length=0,this._requestPool.reset(),this._actionPool.reset(),this._isDestroyed=!0}_readTick(t){this._isDestroyed||(t&&this._tickTime?(this._tickDeltaTime=t-this._tickTime,this._tickTime=t,this._updateRequests(),this._updateActions()):(this._tickTime=t,this._tickDeltaTime=0))}_writeTick(){this._isDestroyed||(this._applyActions(),it(this._readTick,this._writeTick))}_startTicking(){this._isTicking=!0,it(this._readTick,this._writeTick)}_stopTicking(){this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,Q.remove(0,F),Q.remove(2,z)}_getItemHandleRect(t,e,i={width:0,height:0,left:0,right:0,top:0,bottom:0}){const s=t._drag;if(e){const n=s._dragMoveEvent||s._dragStartEvent,r=e(t,s._clientX,s._clientY,t.width,t.height,n.clientX,n.clientY);i.left=r.left,i.top=r.top,i.width=r.width,i.height=r.height}else i.left=s._clientX,i.top=s._clientY,i.width=t.width,i.height=t.height;return i.right=i.left+i.width,i.bottom=i.top+i.height,i}_requestItemScroll(t,e,i,s,n,r,o){const h=this._requests[e];let a=h.get(t.id);a?a.element===i&&a.direction===s||a.reset():a=this._requestPool.pick(),a.item=t,a.element=i,a.direction=s,a.threshold=n,a.distance=r,a.maxValue=o,h.set(t.id,a)}_cancelItemScroll(t,e){const i=this._requests[e],s=i.get(t.id);s&&(s.action&&s.action.removeRequest(s),this._requestPool.release(s),i.delete(t.id))}_checkItemOverlap(t,e,i){const s=bt(t),{threshold:n,safeZone:r,handle:o,targets:h}=s,a=ct(h)?h(t):h;if(!a||!a.length)return e&&this._cancelItemScroll(t,1),void(i&&this._cancelItemScroll(t,2));const l=this._dragDirections.get(t.id),d=l&&l[0]||0,c=l&&l[1]||0;if(!d&&!c)return e&&this._cancelItemScroll(t,1),void(i&&this._cancelItemScroll(t,2));const _=this._getItemHandleRect(t,o,_t);let u=null,m=-1/0,g=0,f=0,p=0,v=0,y=0,w=null,S=-1/0,b=0,D=0,A=0,T=0,k=0,x=0;for(;x<a.length;x++){const t=a[x],s=t.threshold||n,o=!(!e||!d||2===t.axis),h=!(!i||!c||1===t.axis),l=t.priority||0;if((!o||l<m)&&(!h||l<S))continue;const R=ft(t.element||t),C=o?yt(R):-1,E=h?wt(R):-1;if(!C&&!E)continue;const L=St(R,ut),X=nt(_,L);if(!(X<=0)){if(o&&l>=m&&C>0&&(l>m||X>f)){let t=0,e=0;const i=Tt(s,L.width),n=kt(i,r,_.width,L.width);5===d?(t=L.right+n-_.right,t<=i&&pt(R)<C&&(e=5)):9===d&&(t=_.left-(L.left-n),t<=i&&pt(R)>0&&(e=9)),e&&(u=R,m=l,g=i,f=X,p=e,v=t,y=C)}if(h&&l>=S&&E>0&&(l>S||X>D)){let t=0,e=0;const i=Tt(s,L.height),n=kt(i,r,_.height,L.height);6===c?(t=L.bottom+n-_.bottom,t<=i&&vt(R)<E&&(e=6)):10===c&&(t=_.top-(L.top-n),t<=i&&vt(R)>0&&(e=10)),e&&(w=R,S=l,b=i,D=X,A=e,T=t,k=E)}}}e&&(u&&p?this._requestItemScroll(t,1,u,p,g,v,y):this._cancelItemScroll(t,1)),i&&(w&&A?this._requestItemScroll(t,2,w,A,b,T,k):this._cancelItemScroll(t,2))}_updateScrollRequest(t){const e=t.item,{threshold:i,safeZone:s,smoothStop:n,handle:r,targets:o}=bt(e),h=ct(o)?o(e):o,a=h&&h.length||0,l=this._getItemHandleRect(e,r,_t);let d=null,c=0;for(;c<a;c++){const e=h[c],n=ft(e.element||e);if(n!==t.element)continue;const r=!!(1&t.direction);if(r){if(2===e.axis)continue}else if(1===e.axis)continue;const o=r?yt(n):wt(n);if(o<=0)break;const a=St(n,ut);if(nt(l,a)<=0)break;const _=Tt("number"==typeof e.threshold?e.threshold:i,r?a.width:a.height),u=kt(_,s,r?l.width:l.height,r?a.width:a.height);let m=0;if(m=9===t.direction?l.left-(a.left-u):5===t.direction?a.right+u-l.right:10===t.direction?l.top-(a.top-u):a.bottom+u-l.bottom,m>_)break;const g=r?pt(n):vt(n);if(d=4&t.direction?g>=o:g<=0,d)break;return t.maxValue=o,t.threshold=_,t.distance=m,t.isEnding=!1,!0}return!0===n&&t.speed>0?(null===d&&(d=t.hasReachedEnd()),t.isEnding=!d):t.isEnding=!1,t.isEnding}_updateRequests(){const t=this._items,e=this._requests[1],i=this._requests[2];let s=0;for(;s<t.length;s++){const n=t[s],r=this._requestOverlapCheck.get(n.id)||0;let o=r>0&&this._tickTime-r>this._overlapCheckInterval,h=!0;const a=e.get(n.id);a&&a.isActive&&(h=!this._updateScrollRequest(a),h&&(o=!0,this._cancelItemScroll(n,1)));let l=!0;const d=i.get(n.id);d&&d.isActive&&(l=!this._updateScrollRequest(d),l&&(o=!0,this._cancelItemScroll(n,2))),o&&(this._requestOverlapCheck.set(n.id,0),this._checkItemOverlap(n,h,l))}}_requestAction(t,e){const i=this._actions,s=1===e;let n=null,r=0;for(;r<i.length;r++){if(n=i[r],t.element===n.element){if(s?n.requestX:n.requestY)return void this._cancelItemScroll(t.item,e);break}n=null}n||(n=this._actionPool.pick()),n.element=t.element,n.addRequest(t),t.tick(this._tickDeltaTime),i.push(n)}_updateActions(){const t=this._items,e=this._requests,i=this._actions;let s=0;for(s=0;s<t.length;s++){const i=e[1].get(t[s].id),n=e[2].get(t[s].id);i&&this._requestAction(i,1),n&&this._requestAction(n,2)}for(s=0;s<i.length;s++)i[s].computeScrollValues()}_applyActions(){const t=this._actions;if(!t.length)return;let e=0;for(e=0;e<t.length;e++)t[e].scroll(),this._actionPool.release(t[e]);t.length=0;const i=this._items;for(e=0;e<i.length;e++)Dt(i[e]);for(e=0;e<i.length;e++)At(i[e])}}Et.AXIS_X=1,Et.AXIS_Y=2,Et.LEFT=9,Et.RIGHT=5,Et.UP=10,Et.DOWN=6,Et.smoothSpeed=function(t,e,i){return function(s,n,r){let o=0;if(!r.isEnding)if(r.threshold>0){const e=r.threshold-Math.max(0,r.distance);o=t/r.threshold*e}else o=t;const h=r.speed;if(h===o)return o;let a=o;return h<o?(a=h+e*(r.deltaTime/1e3),Math.min(o,a)):(a=h-i*(r.deltaTime/1e3),Math.max(o,a))}},Et.pointerHandle=function(t){const e={left:0,top:0,width:0,height:0},i=t||1;return function(t,s,n,r,o,h,a){return e.left=h-.5*i,e.top=a-.5*i,e.width=i,e.height=i,e}};class Lt{constructor(){this._events={},this._queue=[],this._counter=0,this._clearOnEmit=!1}on(t,e){if(!this._events)return this;const i=this._events[t]||[];return this._events[t]=i,i.push(e),this}off(t,e){if(!this._events)return this;const i=this._events[t];if(!i||!i.length)return this;let s=0;for(;-1!==(s=i.indexOf(e));)i.splice(s,1);return this}clear(t){if(!this._events)return this;const e=this._events[t];return e&&(e.length=0,delete this._events[t]),this}emit(t,...e){if(!this._events)return this._clearOnEmit=!1,this;const i=this._events[t];if(!i||!i.length)return this._clearOnEmit=!1,this;const s=this._queue,n=s.length;s.push(...i),this._clearOnEmit&&(i.length=0,this._clearOnEmit=!1),++this._counter;let r=n;const o=s.length;for(;r<o;r++)if(s[r](...e),!this._events)return this;return--this._counter,this._counter||(s.length=0),this}burst(t,...e){return this._events?(this._clearOnEmit=!0,this.emit(t,...e)):this}countListeners(t){if(!this._events)return 0;const e=this._events[t];return e?e.length:0}destroy(){return this._events?(this._queue.length=this._counter=0,this._events=null,this):this}}const Xt=["","webkit","moz","ms","o","Webkit","Moz","MS","O"],Yt=new Map;function It(t,e){let i=Yt.get(e);if(i)return i;const s=e[0].toUpperCase()+e.slice(1);let n=0;for(;n<Xt.length;){if(i=Xt[n]?Xt[n]+s:e,i in t)return Yt.set(e,i),i;++n}return""}const Mt={start:"touchstart",move:"touchmove",cancel:"touchcancel",end:"touchend"},Pt=Object.assign({},v?Mt:y?{start:"pointerdown",move:"pointermove",cancel:"pointercancel",end:"pointerup"}:{start:"mousedown",move:"mousemove",cancel:"",end:"mouseup"}),Ot="start",qt="move",Ht="cancel",Gt="end",Wt="auto",Nt="touchAction",Vt=It(document.documentElement.style,Nt);function Bt(t){t.preventDefault&&!1!==t.cancelable&&t.preventDefault()}function Ft(t,e){return(t?1:0)|(k&&e?2:0)}function zt(t){return k?{capture:!!(1&t),passive:!!(2&t)}:!!(1&t)}function jt(t){return"pointerType"in t?t.pointerType:"touches"in t?"touch":"mouse"}class Qt{constructor(t){this._emitter=new Lt,this._listenerOptions=zt(t),this._draggers=new Set,this._onMove=this._onMove.bind(this),this._onCancel=this._onCancel.bind(this),this._onEnd=this._onEnd.bind(this)}hasDragger(t){return this._draggers.has(t)}addDragger(t){this._draggers.has(t)||(this._draggers.add(t),this._emitter.on(qt,t.onMove),this._emitter.on(Ht,t.onCancel),this._emitter.on(Gt,t.onEnd),1===this._draggers.size&&this._activate())}removeDragger(t){this._draggers.has(t)&&(this._draggers.delete(t),this._emitter.off(qt,t.onMove),this._emitter.off(Ht,t.onCancel),this._emitter.off(Gt,t.onEnd),0===this._draggers.size&&this._deactivate())}destroy(){this._draggers.size&&this._deactivate(),this._draggers.clear(),this._emitter.destroy()}_activate(){window.addEventListener(Pt.move,this._onMove,this._listenerOptions),window.addEventListener(Pt.end,this._onEnd,this._listenerOptions),Pt.cancel&&window.addEventListener(Pt.cancel,this._onCancel,this._listenerOptions)}_deactivate(){window.removeEventListener(Pt.move,this._onMove,this._listenerOptions),window.removeEventListener(Pt.end,this._onEnd,this._listenerOptions),Pt.cancel&&window.removeEventListener(Pt.cancel,this._onCancel,this._listenerOptions)}_onMove(t){this._emitter.emit(qt,t)}_onCancel(t){this._emitter.emit(Ht,t)}_onEnd(t){this._emitter.emit(Gt,t)}}const Ut=[new Qt(0),new Qt(1)];k&&Ut.push(new Qt(2),new Qt(3));class Zt{constructor(t,e,i={}){const{capture:s=!0,passive:n=!0}=i;this.element=t,this._emitter=new Lt,this._cssProps={},this._touchAction="",this._listenerType=Ft(s,n),this._isActive=!1,this._pointerId=null,this._startTime=0,this._startX=0,this._startY=0,this._currentX=0,this._currentY=0,this.onStart=this.onStart.bind(this),this.onMove=this.onMove.bind(this),this.onCancel=this.onCancel.bind(this),this.onEnd=this.onEnd.bind(this),e&&this.setCssProps(e),this._touchAction||this.setTouchAction(Wt),t.addEventListener("dragstart",Bt,!1),t.addEventListener(Pt.start,this.onStart,zt(this._listenerType))}getTrackedTouch(t){return null===this._pointerId?null:function(t,e){if("pointerId"in t)return t.pointerId===e?t:null;if("changedTouches"in t){let i=0;for(;i<t.changedTouches.length;i++)if(t.changedTouches[i].identifier===e)return t.changedTouches[i];return null}return t}(t,this._pointerId)}onStart(t){if(!this.element)return;if(null!==this._pointerId)return;if(this._pointerId=function(t){return"pointerId"in t?t.pointerId:"changedTouches"in t?t.changedTouches[0]?t.changedTouches[0].identifier:null:1}(t),null===this._pointerId)return;const e=this.getTrackedTouch(t);if(e&&(this._startX=this._currentX=e.clientX,this._startY=this._currentY=e.clientY,this._startTime=Date.now(),this._isActive=!0,this._emit(Ot,t),this._isActive)){const t=Ut[this._listenerType];t&&t.addDragger(this)}}onMove(t){const e=this.getTrackedTouch(t);e&&(this._currentX=e.clientX,this._currentY=e.clientY,this._emit(qt,t))}onCancel(t){this.getTrackedTouch(t)&&(this._emit(Ht,t),this.reset())}onEnd(t){this.getTrackedTouch(t)&&(this._emit(Gt,t),this.reset())}isActive(){return this._isActive}setTouchAction(t){this.element&&t&&(this._touchAction=t,Vt&&(this._cssProps[Vt]="",this.element.style[Vt]=t),v&&(this.element.removeEventListener(Mt.start,Bt,!0),t!==Wt&&(this.element.style[Vt]!==t||S&&D)&&this.element.addEventListener(Mt.start,Bt,!0)))}setCssProps(t){if(!this.element)return;const e=this._cssProps,{element:i}=this;let s,n="";for(n in e)i.style[n]=e[n],delete e[n];for(s in t){const n=t[s]||"";if(!n)continue;if(s===Nt){this.setTouchAction(n);continue}const r=It(i.style,s);r&&(e[r]="",i.style[r]=n)}}setListenerOptions(t){if(!this.element)return;const{capture:e=!0,passive:i=!0}=t,s=this._listenerType,n=Ft(e,i);if(s!==n){this.element.removeEventListener(Pt.start,this.onStart,zt(this._listenerType));const t=Ut[this._listenerType],e=!!t&&t.hasDragger(this);if(e&&t.removeDragger(this),this._listenerType=n,this.element.addEventListener(Pt.start,this.onStart,zt(this._listenerType)),e){const t=Ut[this._listenerType];t&&t.addDragger(this)}}}getDeltaX(){return this._currentX-this._startX}getDeltaY(){return this._currentY-this._startY}getDistance(){const t=this.getDeltaX(),e=this.getDeltaY();return Math.sqrt(t*t+e*e)}getDeltaTime(){return this._startTime?Date.now()-this._startTime:0}on(t,e){this._emitter.on(t,e)}off(t,e){this._emitter.off(t,e)}reset(){this._pointerId=null,this._startTime=0,this._startX=0,this._startY=0,this._currentX=0,this._currentY=0,this._isActive=!1;const t=Ut[this._listenerType];t&&t.removeDragger(this)}destroy(){const{element:t}=this;if(!t)return;let e;for(e in this.reset(),this._emitter.destroy(),t.removeEventListener(Pt.start,this.onStart,zt(this._listenerType)),t.removeEventListener("dragstart",Bt,!1),t.removeEventListener(Mt.start,Bt,!0),this._cssProps)t.style[e]="";this._cssProps={},this.element=null}_createEvent(t,e){const i=this.getTrackedTouch(e);return i&&null!==this._pointerId?{type:t,srcEvent:e,distance:this.getDistance(),deltaX:this.getDeltaX(),deltaY:this.getDeltaY(),deltaTime:t===Ot?0:this.getDeltaTime(),isFirst:t===Ot,isFinal:t===Gt||t===Ht,pointerType:jt(e),identifier:this._pointerId,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,target:i.target}:null}_emit(t,e){this._emitter.emit(t,this._createEvent(t,e))}}function $t(t,e){e&&t.classList.add(e)}function Jt(t,e,i=-1){i<0&&(i=t.length-i+1),Array.isArray(e)?t.splice(i,0,...e):t.splice(i,0,e)}function Kt(t,e,i=0){const s=Math.max(0,t.length-1+i);return e>s?s:e<0?Math.max(s+e+1,0):e}function te(t,e,i){if(t.length<2)return;const s=Kt(t,e),n=Kt(t,i);s!==n&&t.splice(n,0,t.splice(s,1)[0])}function ee(t,e,i){if(t.length<2)return;const s=Kt(t,e),n=Kt(t,i);if(s!==n){const e=t[s];t[s]=t[n],t[n]=e}}const ie=It(document.documentElement.style,"transform")||"transform",se=/([A-Z])/g,ne=/^(webkit-|moz-|ms-|o-)/,re=/^(-m-s-)/;function oe(t){let e=t.replace(se,"-$1").toLowerCase();return e=e.replace(ne,"-$1"),e=e.replace(re,"-ms-"),e}const he=oe(ie);function ae(t){if("static"!==lt(t,"position"))return!0;const e=lt(t,"display");if("inline"===e||"none"===e)return!1;const i=lt(t,he);if(i&&"none"!==i)return!0;const s=lt(t,"perspective");if(s&&"none"!==s)return!0;const n=lt(t,"content-visibility");if(n&&("auto"===n||"hidden"===n))return!0;const r=lt(t,"contain");if(r&&("strict"===r||"content"===r||r.indexOf("paint")>-1||r.indexOf("layout")>-1))return!0;if(!b){const e=lt(t,"filter");if(e&&"none"!==e)return!0;const i=lt(t,"will-change");if(i&&(i.indexOf("transform")>-1||i.indexOf("perspective")>-1))return!0}return!1}function le(t){let e=t||document;for(;e&&e!==document&&!ae(t);)e=e.parentElement||document;return e}const de={left:0,top:0},ce={left:0,top:0},_e={left:0,top:0};function ue(t,e={left:0,top:0}){if(e.left=0,e.top=0,t===document)return e;if(e.left=window.pageXOffset||0,e.top=window.pageYOffset||0,"self"in t&&t.self===window.self)return e;const{left:i,top:s}=t.getBoundingClientRect();return e.left+=i,e.top+=s,e.left+=dt(t,"border-left-width"),e.top+=dt(t,"border-top-width"),e}function me(t,e,i=!1){return _e.left=0,_e.top=0,t===e||i&&(t=le(t))===(e=le(e))||(ue(t,de),ue(e,ce),_e.left=ce.left-de.left,_e.top=ce.top-de.top),_e}function ge(t,e){e&&t.classList.remove(e)}const fe=!k||{capture:!0,passive:!0},pe={left:0,top:0,width:0,height:0},ve={left:0,top:0,width:0,height:0};class ye{constructor(t){const e=t.element,i=t.getGrid(),{settings:s}=i;this.item=t,this._originGridId=i.id,this._isMigrated=!1,this._isActive=!1,this._isStarted=!1,this._startPredicateState=0,this._startPredicateData=null,this._isSortNeeded=!1,this._sortTimer=void 0,this._blockedSortIndex=null,this._sortX1=0,this._sortX2=0,this._sortY1=0,this._sortY2=0,this._container=null,this._containingBlock=null,this._dragStartEvent=null,this._dragEndEvent=null,this._dragMoveEvent=null,this._dragPrevMoveEvent=null,this._scrollEvent=null,this._translateX=0,this._translateY=0,this._clientX=0,this._clientY=0,this._scrollDiffX=0,this._scrollDiffY=0,this._moveDiffX=0,this._moveDiffY=0,this._containerDiffX=0,this._containerDiffY=0,this._preStartCheck=this._preStartCheck.bind(this),this._preEndCheck=this._preEndCheck.bind(this),this._onScroll=this._onScroll.bind(this),this._prepareStart=this._prepareStart.bind(this),this._applyStart=this._applyStart.bind(this),this._prepareMove=this._prepareMove.bind(this),this._applyMove=this._applyMove.bind(this),this._prepareScroll=this._prepareScroll.bind(this),this._applyScroll=this._applyScroll.bind(this),this._handleSort=this._handleSort.bind(this),this._handleSortDelayed=this._handleSortDelayed.bind(this),this.dragger=new Zt("string"==typeof s.dragHandle&&e.querySelector(s.dragHandle)||e,s.dragCssProps,s.dragEventListenerOptions),this.dragger.on("start",this._preStartCheck),this.dragger.on("move",this._preStartCheck),this.dragger.on("cancel",this._preEndCheck),this.dragger.on("end",this._preEndCheck)}isActive(){return this._isActive}getOriginGrid(){return t.get(this._originGridId)||null}stop(){if(!this.item||!this.isActive())return;if(this._isMigrated)return void this._finishMigration();const{item:t}=this;if(ye.autoScroll.removeItem(t),$(t.id),J(t.id),K(t.id),this._cancelSort(),this._isStarted){const e=t.element,i=t.getGrid(),{itemDraggingClass:s}=i.settings;this._unbindScrollHandler(),e.parentNode!==i.element&&(i.element.appendChild(e),t._setTranslate(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY),t._containerDiffX=this._containerDiffX=0,t._containerDiffY=this._containerDiffY=0,s&&e.clientWidth),ge(e,s)}this._reset()}sort(t=!1){this.item&&this.isActive()&&this.item.isActive()&&this._dragMoveEvent&&(t?this._handleSort():tt(this.item.id,this._handleSort))}destroy(){this.item&&(this._isMigrated=!1,this.stop(),this.dragger.destroy(),this.item=null)}_startPredicate(t,e){const{dragStartPredicate:i}=t.getGrid().settings;return ct(i)?i(t,e):ye.defaultStartPredicate(t,e)}_reset(){this._isActive=!1,this._isStarted=!1,this._container=null,this._containingBlock=null,this._dragStartEvent=null,this._dragEndEvent=null,this._dragMoveEvent=null,this._dragPrevMoveEvent=null,this._scrollEvent=null,this._translateX=0,this._translateY=0,this._clientX=0,this._clientY=0,this._scrollDiffX=0,this._scrollDiffY=0,this._moveDiffX=0,this._moveDiffY=0,this._containerDiffX=0,this._containerDiffY=0}_bindScrollHandler(){window.addEventListener("scroll",this._onScroll,fe)}_unbindScrollHandler(){window.removeEventListener("scroll",this._onScroll,fe)}_resetHeuristics(t,e){this._blockedSortIndex=null,this._sortX1=this._sortX2=t,this._sortY1=this._sortY2=e}_checkHeuristics(t,e){if(!this.item)return!1;const{settings:i}=this.item.getGrid(),{minDragDistance:s,minBounceBackAngle:n}=i.dragSortHeuristics;if(s<=0)return this._blockedSortIndex=null,!0;const r=t-this._sortX2,o=e-this._sortY2,h=s>3&&n>0;if(h||(this._blockedSortIndex=null),Math.abs(r)>s||Math.abs(o)>s){if(h){const t=Math.atan2(r,o),e=Math.atan2(this._sortX2-this._sortX1,this._sortY2-this._sortY1),i=Math.atan2(Math.sin(t-e),Math.cos(t-e));Math.abs(i)>n&&(this._blockedSortIndex=null)}return this._sortX1=this._sortX2,this._sortY1=this._sortY2,this._sortX2=t,this._sortY2=e,!0}return!1}_resetDefaultStartPredicate(){const{_startPredicateData:t}=this;t&&(t.delayTimer&&(t.delayTimer=void window.clearTimeout(t.delayTimer)),this._startPredicateData=null)}_handleSort(){if(!this.item||!this.isActive())return;const{item:t}=this,{dragSort:e,dragSortHeuristics:i,dragAutoScroll:s}=t.getGrid().settings;if(!e||!s.sortDuringScroll&&ye.autoScroll.isItemScrolling(t))return this._sortX1=this._sortX2=this._translateX-t._containerDiffX,this._sortY1=this._sortY2=this._translateY-t._containerDiffY,this._isSortNeeded=!0,void(void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)));const n=this._checkHeuristics(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY);if(!this._isSortNeeded&&!n)return;const r=i.sortInterval;r<=0||this._isSortNeeded?(this._isSortNeeded=!1,void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)),this._checkOverlap()):void 0===this._sortTimer&&(this._sortTimer=window.setTimeout(this._handleSortDelayed,r))}_handleSortDelayed(){this.item&&(this._isSortNeeded=!0,this._sortTimer=void 0,tt(this.item.id,this._handleSort))}_cancelSort(){var t;this.item&&(this._isSortNeeded=!1,void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)),t=this.item.id,Q.remove(1,H+t))}_finishSort(){if(!this.item)return;const{dragSort:t}=this.item.getGrid().settings,e=t&&(this._isSortNeeded||void 0!==this._sortTimer);this._cancelSort(),e&&this._checkOverlap(),t&&this._checkOverlap(!0)}_checkOverlap(t=!1){if(!this.item||!this.isActive())return;const{item:e}=this,n=e.element,r=e.getGrid(),{settings:o}=r;let h=null;if(ct(o.dragSortPredicate)?h=o.dragSortPredicate(e,t?this._dragEndEvent:this._dragMoveEvent):t||(h=ye.defaultSortPredicate(e,o.dragSortPredicate)),!h||"number"!=typeof h.index)return;const a=h.action===i?i:s,l=h.grid||r,d=r!==l,c=r.items.indexOf(e),p=Kt(l.items,h.index,d&&a===s?1:0);if(d||p!==this._blockedSortIndex)if(d){this._blockedSortIndex=null;const t=l.items[p],s=l.settings;if(r._hasListeners(m)&&r._emit(m,{item:e,fromGrid:r,fromIndex:c,toGrid:l,toIndex:p}),l._hasListeners(f)&&l._emit(f,{item:e,fromGrid:r,fromIndex:c,toGrid:l,toIndex:p}),!this.isActive()||r.isDestroyed()||l.isDestroyed())return;e._gridId=l.id,this._isMigrated=e._gridId!==this._originGridId,r.items.splice(c,1),Jt(l.items,e,p),e._sortData=null;const h=this._container,d=this._containingBlock,_=s.dragContainer||l.element,v=le(_);let y=me(v,le(l.element));e._containerDiffX=this._containerDiffX=y.left,e._containerDiffY=this._containerDiffY=y.top,_!==h&&(y=me(d,v),this._container=_,this._containingBlock=v,this._translateX-=y.left,this._translateY-=y.top,_.appendChild(n),e._setTranslate(this._translateX,this._translateY)),o.itemClass!==s.itemClass&&(ge(n,o.itemClass),$t(n,s.itemClass)),o.itemDraggingClass!==s.itemDraggingClass&&(ge(n,o.itemDraggingClass),$t(n,s.itemDraggingClass)),e.isActive()?(o.itemVisibleClass!==s.itemVisibleClass&&(ge(n,o.itemVisibleClass),$t(n,s.itemVisibleClass)),e._visibility.setStyles(s.visibleStyles)):(o.itemHiddenClass!==s.itemHiddenClass&&(ge(n,o.itemHiddenClass),$t(n,s.itemHiddenClass)),e._visibility.setStyles(s.hiddenStyles)),e._dragPlaceholder.updateClassName(s.itemPlaceholderClass),e._updateDimensions(),r._hasListeners(u)&&r._emit(u,{item:e,fromGrid:r,fromIndex:c,toGrid:l,toIndex:p}),l._hasListeners(g)&&l._emit(g,{item:e,fromGrid:r,fromIndex:c,toGrid:l,toIndex:p}),a===i&&t&&t.isActive()&&l.items.indexOf(t)>-1&&l.send(t,r,c,{appendTo:h||document.body,layoutSender:!1,layoutReceiver:!1}),r.layout(),l.layout()}else c!==p&&(this._blockedSortIndex=c,(a===i?ee:te)(r.items,c,p),r._hasListeners(_)&&r._emit(_,{item:e,fromIndex:c,toIndex:p,action:a}),r.layout())}_finishMigration(){if(!this.item)return;const{item:t}=this,{dragEnabled:e}=t.getGrid().settings;this.destroy(),t._drag=e?new ye(t):null,t._dragRelease.start()}_preStartCheck(t){if(0===this._startPredicateState&&(this._startPredicateState=1),1===this._startPredicateState){const e=this._startPredicate(this.item,t);!0===e?(this._startPredicateState=2,this._onStart(t)):!1===e&&(this._startPredicateState=0,this.dragger.reset())}else 2===this._startPredicateState&&this.isActive()&&this._onMove(t)}_preEndCheck(t){const e=2===this._startPredicateState;this._startPredicate(this.item,t),this._resetDefaultStartPredicate(),this._startPredicateState=0,e&&this.isActive()&&(this._isStarted?this._onEnd(t):this.stop())}_onStart(t){var e,i,s;this.item&&this.item.isActive()&&(this._isActive=!0,this._dragStartEvent=t,ye.autoScroll.addItem(this.item,this._translateX,this._translateY),e=this.item.id,i=this._prepareStart,s=this._applyStart,Q.add(0,Y+e,i),Q.add(2,I+e,s))}_prepareStart(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.element,i=t.getGrid(),s=i.settings.dragContainer||i.element,n=le(s),r=t._getTranslate(),o=e.getBoundingClientRect();if(this._container=s,this._containingBlock=n,this._clientX=o.left,this._clientY=o.top,this._translateX=r.x,this._translateY=r.y,this._scrollDiffX=this._scrollDiffY=0,this._moveDiffX=this._moveDiffY=0,this._containerDiffX=this._containerDiffY=0,s!==i.element){const{left:t,top:e}=me(n,i.element);this._containerDiffX=t,this._containerDiffY=e}this._resetHeuristics(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY)}_applyStart(){if(!this.item||!this.isActive())return;const{item:t}=this;if(!t.isActive())return;t.isPositioning()&&t._layout.stop(!0,this._translateX,this._translateY);const e=t._migrate;e.isActive()&&(this._translateX-=t._containerDiffX,this._translateY-=t._containerDiffY,e.stop(!0,this._translateX,this._translateY));const i=t._dragRelease;t.isReleasing()&&i.reset();const s=t.getGrid(),n=t.element;s.settings.dragPlaceholder.enabled&&t._dragPlaceholder.create(),this._isStarted=!0,this._dragStartEvent&&s._emit("dragInit",t,this._dragStartEvent),n.parentNode!==this._container&&(this._translateX+=this._containerDiffX,this._translateY+=this._containerDiffY,this._container.appendChild(n),t._setTranslate(this._translateX,this._translateY)),t._containerDiffX=this._containerDiffX,t._containerDiffY=this._containerDiffY,$t(n,s.settings.itemDraggingClass),this._bindScrollHandler(),this._dragStartEvent&&s._emit("dragStart",t,this._dragStartEvent)}_onMove(t){if(!this.item)return;if(!this.item.isActive())return void this.stop();const e=this.item.id;this._dragMoveEvent=t,function(t,e,i){Q.add(0,M+t,e),Q.add(2,P+t,i)}(e,this._prepareMove,this._applyMove),tt(e,this._handleSort)}_prepareMove(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{dragAxis:t}=this.item.getGrid().settings,e=this._dragMoveEvent,i=this._dragPrevMoveEvent||this._dragStartEvent||e;if("y"!==t){const t=e.clientX-i.clientX;this._translateX=this._translateX-this._moveDiffX+t,this._clientX=this._clientX-this._moveDiffX+t,this._moveDiffX=t}if("x"!==t){const t=e.clientY-i.clientY;this._translateY=this._translateY-this._moveDiffY+t,this._clientY=this._clientY-this._moveDiffY+t,this._moveDiffY=t}this._dragPrevMoveEvent=e}_applyMove(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();this._moveDiffX=this._moveDiffY=0,t._setTranslate(this._translateX,this._translateY),this._dragMoveEvent&&e._emit("dragMove",t,this._dragMoveEvent),ye.autoScroll.updateItem(t,this._translateX,this._translateY)}_onScroll(t){if(!this.item)return;if(!this.item.isActive())return void this.stop();const e=this.item.id;this._scrollEvent=t,function(t,e,i){Q.add(0,O+t,e),Q.add(2,q+t,i)}(e,this._prepareScroll,this._applyScroll),tt(e,this._handleSort)}_prepareScroll(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();if(this._container!==e.element){const{left:i,top:s}=me(this._containingBlock,e.element);t._containerDiffX=this._containerDiffX=i,t._containerDiffY=this._containerDiffY=s}const{dragAxis:i}=e.settings,{left:s,top:n}=t.element.getBoundingClientRect();if("y"!==i){const t=this._clientX-this._moveDiffX-this._scrollDiffX-s;this._translateX=this._translateX-this._scrollDiffX+t,this._scrollDiffX=t}if("x"!==i){const t=this._clientY-this._moveDiffY-this._scrollDiffY-n;this._translateY=this._translateY-this._scrollDiffY+t,this._scrollDiffY=t}}_applyScroll(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();this._scrollDiffX=this._scrollDiffY=0,t._setTranslate(this._translateX,this._translateY),this._scrollEvent&&e._emit("dragScroll",t,this._scrollEvent)}_onEnd(t){if(!this.item)return;const{item:e}=this;if(!e.isActive())return void this.stop();const i=e.getGrid();this._dragEndEvent=t,$(e.id),J(e.id),K(e.id),this._finishSort(),this._unbindScrollHandler(),this._reset(),ge(e.element,i.settings.itemDraggingClass),ye.autoScroll.removeItem(e),i._emit("dragEnd",e,t),this._isMigrated?this._finishMigration():e._dragRelease.start()}}ye.autoScroll=new Et,ye.defaultStartPredicate=function(t,e,i){if(e.isFinal)return;const s=t._drag;if(e.isFirst&&e.srcEvent.button)return s._resetDefaultStartPredicate(),!1;if(!A&&e.isFirst&&!0===e.srcEvent.isTrusted&&!1===e.srcEvent.defaultPrevented&&!1===e.srcEvent.cancelable)return s._resetDefaultStartPredicate(),!1;let n=s._startPredicateData;if(!n){n=s._startPredicateData={distance:0,delay:0};const{dragStartPredicate:e}=t.getGrid().settings,r=i||e;"object"==typeof r&&(n.distance=Math.max(r.distance||0,0),n.delay=Math.max(r.delay||0,0))}return n.delay?(n.event=e,void(n.delayTimer||(n.delayTimer=window.setTimeout((function(){s._startPredicateData===n&&(s.item?n&&(n.delay=0,1===s._startPredicateState&&n.event&&n.event.distance>=n.distance&&(s._resetDefaultStartPredicate(),s._startPredicateState=2,s._onStart(n.event))):s._resetDefaultStartPredicate())}),n.delay)))):!(e.distance<n.distance)||void 0},ye.defaultSortPredicate=function(t,e){const n=t._drag,r=e&&e.action===i?i:s,o=e&&e.migrateAction===i?i:s,h=Math.min(Math.max(e&&"number"==typeof e.threshold?e.threshold:50,1),100),a=function(t,e){const i=t.getGrid(),{dragSort:s}=i.settings,n=!0===s?[i]:ct(s)?s(t):void 0;let r=null;if(!n||!Array.isArray(n)||!n.length)return r;const o=pe,h=ve;let a,l,d=-1,c=0,_=null,u=0,m=0,g=0,f=0,p=0;const v=t._drag;for(o.width=t.width,o.height=t.height,o.left=v._clientX,o.top=v._clientY;p<n.length;p++)if(a=n[p],!a.isDestroyed()){for(a._updateBoundingRect(),u=Math.max(0,a._rect.left),m=Math.max(0,a._rect.top),g=Math.min(window.innerWidth,a._rect.right),f=Math.min(window.innerHeight,a._rect.bottom),_=a.element.parentNode;_&&_!==document&&_!==document.documentElement&&_!==document.body;)if(_.getRootNode&&_ instanceof DocumentFragment)_=_.getRootNode().host;else{if("visible"!==lt(_,"overflow")&&(l=_.getBoundingClientRect(),u=Math.max(u,l.left),m=Math.max(m,l.top),g=Math.min(g,l.right),f=Math.min(f,l.bottom)),"fixed"===lt(_,"position"))break;_=_.parentNode}u>=g||m>=f||(h.left=u,h.top=m,h.width=g-u,h.height=f-m,c=nt(o,h),c>e&&c>d&&(d=c,r=a))}return r}(t,h);if(!a)return null;const l=t.getGrid()!==a,d=pe,c=ve;d.width=t.width,d.height=t.height,l?(a._updateBorders(!0,!1,!0,!1),d.left=n._clientX-(a._rect.left+a._borderLeft),d.top=n._clientY-(a._rect.top+a._borderTop)):(d.left=n._translateX-t._containerDiffX+t.marginLeft,d.top=n._translateY-t._containerDiffY+t.marginTop);let _=0,u=-1,m=!1;for(let e=0;e<a.items.length;e++){const i=a.items[e];if(!i.isActive()||i===t)continue;m=!0,c.width=i.width,c.height=i.height,c.left=i.left+i.marginLeft,c.top=i.top+i.marginTop;const s=nt(d,c);s>_&&(u=e,_=s)}return l&&_<h&&(u=m?u:0,_=h),_>=h?{grid:a,index:u,action:l?o:r}:null};const we=/^(webkit|moz|ms|o|Webkit|Moz|MS|O)(?=[A-Z])/,Se=new Map;function be(t){let e=Se.get(t);return e||(e=t.replace(we,""),e!==t&&(e=e[0].toLowerCase()+e.slice(1)),Se.set(t,e),e)}function De(t,e){let i;for(i in e)t.style[i]=e[i]||""}const Ae=ct(Element.prototype.animate),Te=!!((ke=Element.prototype.animate)&&ct(window.Symbol)&&ct(window.Symbol.toString)&&window.Symbol(ke).toString().indexOf("[native code]")>-1);var ke;function xe(t,e){const i={};let s;for(s in t)i[e?s:be(s)]=t[s];return i}class Re{constructor(t){this.element=t||null,this.animation=null,this._finishCallback=null,this._onFinish=this._onFinish.bind(this)}start(t,e,i){if(!this.element)return;const{element:s}=this,{duration:n,easing:r,onFinish:o}=i||{};if(!Ae)return De(s,e),this._finishCallback=ct(o)?o:null,void this._onFinish();this.animation&&this.animation.cancel(),this.animation=s.animate([xe(t,Te),xe(e,Te)],{duration:n||300,easing:r||"ease"}),this._finishCallback=ct(o)?o:null,this.animation.onfinish=this._onFinish,De(s,e)}stop(){this.element&&this.animation&&(this.animation.cancel(),this.animation=this._finishCallback=null)}isAnimating(){return!!this.animation}destroy(){this.element&&(this.stop(),this.element=null)}_onFinish(){const{_finishCallback:t}=this;this.animation=this._finishCallback=null,t&&t()}}function Ce(t,e,i=!1){return i?"translate3d("+t+"px, "+e+"px, 0px)":"translateX("+t+"px) translateY("+e+"px)"}const Ee={x:0,y:0},Le=/^matrix3d/,Xe=/([^,]*,){4}/,Ye=/([^,]*,){12}/,Ie=/[^,]*,/;function Me(t){Ee.x=0,Ee.y=0;const e=lt(t,he);if(!e||"none"===e)return Ee;const i=Le.test(e),s=e.replace(i?Ye:Xe,""),n=s.replace(Ie,"");return Ee.x=parseFloat(s)||0,Ee.y=parseFloat(n)||0,Ee}const Pe={},Oe={};class qe{constructor(t){this.item=t,this.element=null,this.animator=new Re,this.left=0,this.top=0,this._className="",this._didMigrate=!1,this._resetAfterLayout=!1,this._transX=0,this._transY=0,this._nextTransX=0,this._nextTransY=0,this._setupAnimation=this._setupAnimation.bind(this),this._startAnimation=this._startAnimation.bind(this),this._updateDimensions=this._updateDimensions.bind(this),this._onLayoutStart=this._onLayoutStart.bind(this),this._onLayoutEnd=this._onLayoutEnd.bind(this),this._onReleaseEnd=this._onReleaseEnd.bind(this),this._onMigrate=this._onMigrate.bind(this),this._onHide=this._onHide.bind(this)}create(){if(!this.item)return;if(this.element)return void(this._resetAfterLayout=!1);const{item:t}=this,e=t.getGrid(),{settings:i}=e;let s;this.left=t.left,this.top=t.top,s=ct(i.dragPlaceholder.createElement)?i.dragPlaceholder.createElement(t):document.createElement("div"),this.element=s,this.animator.element=s,this._className=i.itemPlaceholderClass||"",this._className&&$t(s,this._className),De(s,{position:"absolute",left:"0px",top:"0px",width:t.width+"px",height:t.height+"px"}),s.style[ie]=Ce(t.left+t.marginLeft,t.top+t.marginTop,i.translate3d),e.on(r,this._onLayoutStart),e.on(p,this._onReleaseEnd),e.on(m,this._onMigrate),e.on(l,this._onHide),ct(i.dragPlaceholder.onCreate)&&i.dragPlaceholder.onCreate(t,s),e.element.appendChild(s)}reset(){var t;if(!this.item||!this.element)return;const{item:e,element:i,animator:s}=this,n=e.getGrid();var o;this._resetAfterLayout=!1,et(e.id),o=e.id,Q.remove(2,B+o),s.stop(),s.element=null,n.off(p,this._onReleaseEnd),n.off(r,this._onLayoutStart),n.off(m,this._onMigrate),n.off(l,this._onHide),this._className&&(ge(i,this._className),this._className=""),null===(t=i.parentNode)||void 0===t||t.removeChild(i),this.element=null;const{onRemove:h}=n.settings.dragPlaceholder;ct(h)&&h(e,i)}isActive(){return!!this.element}updateDimensions(){var t,e;this.item&&this.isActive()&&(t=this.item.id,e=this._updateDimensions,Q.add(2,B+t,e))}updateClassName(t){this.element&&(ge(this.element,this._className),this._className=t,$t(this.element,t))}destroy(){this.reset(),this.animator&&this.animator.destroy(),this.item=null}_updateDimensions(){this.item&&this.element&&De(this.element,{width:this.item.width+"px",height:this.item.height+"px"})}_onLayoutStart(t,e){if(!this.item||!this.element)return;const{item:i}=this;if(-1===t.indexOf(i))return void this.reset();const s=i.left,n=i.top,r=this.left,o=this.top;if(this.left=s,this.top=n,!e&&!this._didMigrate&&r===s&&o===n)return;const h=s+i.marginLeft,a=n+i.marginTop,l=i.getGrid();if(!(!e&&l.settings.layoutDuration>0)||this._didMigrate)return et(i.id),this.element.style[ie]=Ce(h,a,l.settings.translate3d),this.animator.stop(),void(this._didMigrate&&(l.element.appendChild(this.element),this._didMigrate=!1));var d,c,_;this.animator.animation&&(this.animator.animation.onfinish=null),this._nextTransX=h,this._nextTransY=a,d=i.id,c=this._setupAnimation,_=this._startAnimation,Q.add(0,N+d,c),Q.add(2,V+d,_)}_setupAnimation(){if(!this.element)return;const{x:t,y:e}=Me(this.element);this._transX=t,this._transY=e}_startAnimation(){if(!this.item||!this.element)return;const{animator:t}=this,e=this._transX,i=this._transY,s=this._nextTransX,n=this._nextTransY,{layoutDuration:r,layoutEasing:o,translate3d:h}=this.item.getGrid().settings;e!==s||i!==n?(Pe[ie]=Ce(e,i,h),Oe[ie]=Ce(s,n,h),t.start(Pe,Oe,{duration:r,easing:o,onFinish:this._onLayoutEnd})):t.isAnimating()&&(this.element.style[ie]=Ce(s,n,h),t.stop())}_onLayoutEnd(){this._resetAfterLayout&&this.reset()}_onReleaseEnd(t){if(this.item&&this.item.id===t.id){if(!this.animator.isAnimating())return void this.reset();this._resetAfterLayout=!0}}_onMigrate(t){if(!this.item||this.item!==t.item)return;const e=this.item.getGrid();e.off(p,this._onReleaseEnd),e.off(r,this._onLayoutStart),e.off(m,this._onMigrate),e.off(l,this._onHide);const i=t.toGrid;i.on(p,this._onReleaseEnd),i.on(r,this._onLayoutStart),i.on(m,this._onMigrate),i.on(l,this._onHide),this._didMigrate=!0}_onHide(t){this.item&&t.indexOf(this.item)>-1&&this.reset()}}const He=!k||{capture:!0,passive:!0};class Ge{constructor(t){this.item=t,this._isActive=!1,this._isPositioning=!1,this._onScroll=this._onScroll.bind(this)}isActive(){return this._isActive}isPositioning(){return this._isPositioning}start(){if(!this.item||this.isActive())return;const{item:t}=this,e=t.getGrid(),{settings:i}=e;this._isActive=!0,$t(t.element,i.itemReleasingClass),i.dragRelease.useDragContainer?t.element.parentNode!==e.element&&window.addEventListener("scroll",this._onScroll,He):this._placeToGrid(),e._emit("dragReleaseStart",t),e._nextLayoutData||t._layout.start(!1)}stop(t=!1,e,i){if(!this.item||!this.isActive())return;const{item:s}=this;t||void 0!==e&&void 0!==i||(e=s.left,i=s.top);const n=this._placeToGrid(e,i);this.reset(n),t||s.getGrid()._emit(p,s)}reset(t=!1){if(!this.item)return;const{item:e}=this,{itemReleasingClass:i}=e.getGrid().settings;var s;this._isActive=!1,this._isPositioning=!1,s=e.id,Q.remove(0,G+s),Q.remove(2,W+s),window.removeEventListener("scroll",this._onScroll,He),i&&(t&&e.element.clientWidth,ge(e.element,i))}destroy(){this.item&&(this.stop(!0),this.item=null)}_placeToGrid(t,e){if(!this.item)return!1;const{item:i}=this,s=i.getGrid().element;if(i.element.parentNode!==s){if(void 0===t||void 0===e){const{x:s,y:n}=i._getTranslate();t=s-i._containerDiffX,e=n-i._containerDiffY}return s.appendChild(i.element),i._setTranslate(t,e),i._containerDiffX=0,i._containerDiffY=0,!0}return!1}_onScroll(){if(!this.item||!this.isActive())return;const{item:t}=this;let e=0,i=0;var s,n,r;s=t.id,n=()=>{if(!this.isActive())return;const s=t.element.parentNode;if(s){const n=t.getGrid().element,{left:r,top:o}=me(s,n,!0);e=r,i=o}},r=()=>{this.isActive()&&(Math.abs(e-t._containerDiffX)>.1||Math.abs(i-t._containerDiffY)>.1)&&(t._containerDiffX=e,t._containerDiffY=i,t._dragPlaceholder.reset(),t._layout.stop(!0,t.left,t.top),this.stop(!1,t.left,t.top))},Q.add(0,G+s,n),Q.add(2,W+s,r)}}const We={},Ne={},Ve={duration:0,easing:"",onFinish:void 0};class Be{constructor(t){this.item=t,this.animator=new Re(t.element),this._skipNextAnimation=!1,this._isActive=!1,this._isInterrupted=!1,this._easing="",this._duration=0,this._tX=0,this._tY=0,this._queue="layout-"+t.id,this._setupAnimation=this._setupAnimation.bind(this),this._startAnimation=this._startAnimation.bind(this),this._finish=this._finish.bind(this);const{style:e}=t.element;e.left="0px",e.top="0px",this.item._setTranslate(0,0)}isActive(){return this._isActive}start(t,e){if(!this.item)return;const{item:i,animator:s}=this,n=i.getGrid(),r=i._dragRelease,{settings:o}=n,h=this.isActive(),a=r.isActive()&&!r.isPositioning(),l=a?o.dragRelease.duration:o.layoutDuration,d=a?o.dragRelease.easing:o.layoutEasing,c=!t&&!this._skipNextAnimation&&l>0;if(h&&(U(i.id),i._emitter.burst(this._queue,!0,i)),a&&(r._isPositioning=!0),e&&ct(e)&&i._emitter.on(this._queue,e),this._skipNextAnimation=!1,!c)return i._setTranslate(i.left+i._containerDiffX,i.top+i._containerDiffY),s.stop(),void this._finish();var _,u,m;s.animation&&(s.animation.onfinish=null),n._itemLayoutNeedsDimensionRefresh=!0,this._isActive=!0,this._easing=d,this._duration=l,this._isInterrupted=h,_=i.id,u=this._setupAnimation,m=this._startAnimation,Q.add(0,C+_,u),Q.add(2,E+_,m)}stop(t,e,i){if(!this.item||!this.isActive())return;const{item:s}=this;if(U(s.id),this.animator.isAnimating()){if(void 0===e||void 0===i){const{x:t,y:e}=Me(s.element);s._setTranslate(t,e)}else s._setTranslate(e,i);this.animator.stop()}const{itemPositioningClass:n}=s.getGrid().settings;ge(s.element,n),this._isActive=!1,t&&s._emitter.burst(this._queue,!0,s)}destroy(){if(!this.item)return;this.stop(!0,0,0),this.item._emitter.clear(this._queue),this.animator.destroy();const{style:t}=this.item.element;t[ie]="",t.left="",t.top="",this.item=null}_finish(){if(!this.item)return;const{item:t}=this;if(t._translateX=t.left+t._containerDiffX,t._translateY=t.top+t._containerDiffY,this.isActive()){this._isActive=!1;const{itemPositioningClass:e}=t.getGrid().settings;ge(t.element,e)}t._dragRelease.isActive()&&t._dragRelease.stop(),t._migrate.isActive()&&t._migrate.stop(),t._emitter.burst(this._queue,!1,t)}_setupAnimation(){if(!this.item||!this.isActive())return;const{item:t}=this,{x:e,y:i}=t._getTranslate();this._tX=e,this._tY=i;const s=t.getGrid();s.settings._animationWindowing&&s._itemLayoutNeedsDimensionRefresh&&(s._itemLayoutNeedsDimensionRefresh=!1,s._updateBoundingRect(),s._updateBorders(!0,!1,!0,!1))}_startAnimation(){if(!this.item||!this.isActive())return;const{item:t}=this,{settings:e}=t.getGrid(),i=this._duration<=0,s=t.left+t._containerDiffX,n=t.top+t._containerDiffY,r=Math.abs(t.left-(this._tX-t._containerDiffX)),o=Math.abs(t.top-(this._tY-t._containerDiffY));if(i||r<2&&o<2||e._animationWindowing&&!t._isInViewport(this._tX,this._tY,T)&&!t._isInViewport(s,n,T))return(this._isInterrupted||r>.1||o>.1)&&t._setTranslate(s,n),this.animator.stop(),void this._finish();this._isInterrupted||$t(t.element,e.itemPositioningClass),We[ie]=Ce(this._tX,this._tY,e.translate3d),Ne[ie]=Ce(s,n,e.translate3d),Ve.duration=this._duration,Ve.easing=this._easing,Ve.onFinish=this._finish,t._translateX=t._translateY=void 0,this.animator.start(We,Ne,Ve),Ve.onFinish=void 0}}class Fe{constructor(t){this.item=t,this.container=null,this._isActive=!1}isActive(){return this._isActive}start(t,e,i){if(!this.item)return;const s=this.item,n=s.getGrid(),r=s.element,o=s.isActive(),h=s.isVisible(),a=n.settings,l=n.items.indexOf(s),d=t.element,c=t.settings,_=t.items,p=i||document.body;let v=0;if("number"==typeof e)v=Kt(_,e,1);else{const i=t.getItem(e);if(!i)return;v=_.indexOf(i)}if(s._drag&&s._drag.stop(),this.isActive()||s.isPositioning()||s.isReleasing()){let{x:t,y:e}=s._getTranslate();s.isPositioning()&&s._layout.stop(!0,t,e),t-=s._containerDiffX,e-=s._containerDiffY,this.isActive()?this.stop(!0,t,e):s.isReleasing()&&s._dragRelease.stop(!0,t,e)}if(s._visibility.stop(!0),n._hasListeners(m)&&n._emit(m,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:v}),t._hasListeners(f)&&t._emit(f,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:v}),s.isDestroyed()||n.isDestroyed()||t.isDestroyed())return;s._drag&&(s._drag.destroy(),s._drag=null),a.itemClass!==c.itemClass&&(ge(r,a.itemClass),$t(r,c.itemClass));const y=h?a.itemVisibleClass:a.itemHiddenClass,w=h?c.itemVisibleClass:c.itemHiddenClass;if(y!==w&&(ge(r,y),$t(r,w)),n.items.splice(l,1),Jt(_,s,v),s._gridId=t.id,o){const t=r.parentNode;if(p!==t){p.appendChild(r);const e=me(p,t,!0),i=s._getTranslate();s._setTranslate(i.x+e.left,i.y+e.top)}}else d.appendChild(r);if(s._visibility.setStyles(h?c.visibleStyles:c.hiddenStyles),o){const{left:t,top:e}=me(p,d,!0);s._containerDiffX=t,s._containerDiffY=e}s._updateDimensions(),s._sortData=null,c.dragEnabled&&(s._drag=new ye(s)),o?(this._isActive=!0,this.container=p):(this._isActive=!1,this.container=null),n._hasListeners(u)&&n._emit(u,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:v}),t._hasListeners(g)&&t._emit(g,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:v})}stop(t=!1,e,i){if(!this.item||!this.isActive())return;const{item:s}=this,n=s.getGrid();if(this.container!==n.element){if(void 0===e||void 0===i)if(t){const t=s._getTranslate();e=t.x-s._containerDiffX,i=t.y-s._containerDiffY}else e=s.left,i=s.top;n.element.appendChild(s.element),s._setTranslate(e,i),s._containerDiffX=0,s._containerDiffY=0}this._isActive=!1,this.container=null}destroy(){this.item&&(this.stop(!0),this.item=null)}}class ze{constructor(t){const e=t.element.children[0];if(!e)throw new Error("No valid child element found within item element.");const i=t.isActive();this.item=t,this.element=e,this.animator=new Re(e),this._isHidden=!i,this._isHiding=!1,this._isShowing=!1,this._currentStyleProps=[],this._queue="visibility-"+t.id,this._finishShow=this._finishShow.bind(this),this._finishHide=this._finishHide.bind(this),t.element.style.display=i?"":"none";const{settings:s}=t.getGrid();$t(t.element,i?s.itemVisibleClass:s.itemHiddenClass),this.setStyles(i?s.visibleStyles:s.hiddenStyles)}isHidden(){return this._isHidden}isHiding(){return this._isHiding}isShowing(){return this._isShowing}show(t,e){if(!this.item)return;const{item:i}=this,s=ct(e)?e:null;if(this._isShowing||this._isHidden)if(!this._isShowing||t){if(!this._isShowing){i._emitter.burst(this._queue,!0,i);const{settings:t}=i.getGrid();t&&(ge(i.element,t.itemHiddenClass),$t(i.element,t.itemVisibleClass)),this._isHiding||(i.element.style.display="")}s&&i._emitter.on(this._queue,s),this._isShowing=!0,this._isHiding=this._isHidden=!1,this._startAnimation(!0,t,this._finishShow)}else s&&i._emitter.on(this._queue,s);else s&&s(!1,i)}hide(t,e){if(!this.item)return;const{item:i}=this,s=ct(e)?e:null;if(this._isHiding||!this._isHidden)if(!this._isHiding||t){if(!this._isHiding){i._emitter.burst(this._queue,!0,i);const{settings:t}=i.getGrid();$t(i.element,t.itemHiddenClass),ge(i.element,t.itemVisibleClass)}s&&i._emitter.on(this._queue,s),this._isHidden=this._isHiding=!0,this._isShowing=!1,this._startAnimation(!1,t,this._finishHide)}else s&&i._emitter.on(this._queue,s);else s&&s(!1,i)}stop(t){if(!this.item||!this._isHiding&&!this._isShowing)return;const{item:e}=this;Z(e.id),this.animator.stop(),t&&e._emitter.burst(this._queue,!0,e)}setStyles(t){if(!this.element)return;const{element:e,_currentStyleProps:i}=this;let s;for(s in this._removeCurrentStyles(),t)i.push(s),e.style[s]=t[s]}destroy(){if(!this.item)return;const{item:t}=this,e=t.element,{settings:i}=t.getGrid();this.stop(!0),t._emitter.clear(this._queue),this.animator.destroy(),this._removeCurrentStyles(),i&&(ge(e,i.itemVisibleClass),ge(e,i.itemHiddenClass)),e.style.display="",this._isHiding=this._isShowing=!1,this._isHidden=!0,this.item=null}_startAnimation(t,e,i){if(!this.item||!this.element)return;const{item:s,element:n,animator:r}=this,o=s.getGrid(),{settings:h}=o,a=t?h.visibleStyles:h.hiddenStyles,l=t?h.showDuration:h.hideDuration,d=t?h.showEasing:h.hideEasing,c=e||l<=0;if(!a)return r.stop(),void(i&&i());if(Z(s.id),c)return De(n,a),r.stop(),void(i&&i());let _;r.animation&&(r.animation.onfinish=null);let u=0,m=0;var g,f,p;o._itemVisibilityNeedsDimensionRefresh=!0,g=s.id,f=()=>{if(!this.item||(t?!this._isShowing:!this._isHiding))return;_=function(t,e){const i={};let s;if(Array.isArray(e)){let n=0;for(;n<e.length;n++)s=e[n],i[s]=lt(t,oe(s))}else for(s in e)i[s]=lt(t,oe(s));return i}(n,a);const{x:e,y:i}=s._getTranslate();u=e,m=i,h._animationWindowing&&o._itemVisibilityNeedsDimensionRefresh&&(o._itemVisibilityNeedsDimensionRefresh=!1,o._updateBoundingRect(),o._updateBorders(!0,!1,!0,!1))},p=()=>{if(this.item&&(t?this._isShowing:this._isHiding))return!h._animationWindowing||s._isInViewport(u,m,T)||s.isActive()&&s._isInViewport(s.left+s._containerDiffX,s.top+s._containerDiffY,T)?void(_&&r.start(_,a,{duration:l,easing:d,onFinish:i})):(De(n,a),r.stop(),void(i&&i()))},Q.add(0,L+g,f),Q.add(2,X+g,p)}_finishShow(){this.item&&!this._isHidden&&(this._isShowing=!1,this.item._emitter.burst(this._queue,!1,this.item))}_finishHide(){if(!this.item||!this._isHidden)return;const{item:t}=this;this._isHiding=!1,t._layout.stop(!0,0,0),t.element.style.display="none",t._emitter.burst(this._queue,!1,t)}_removeCurrentStyles(){if(!this.element)return;const{element:t,_currentStyleProps:e}=this;let i=0;for(;i<e.length;i++)t.style[e[i]]="";e.length=0}}let je=0;function Qe(){return++je}const Ue={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",(function(){Ue.width=window.innerWidth,Ue.height=window.innerHeight}));const Ze={left:0,top:0,width:0,height:0},$e={left:0,top:0,width:0,height:0};const Je={x:0,y:0},Ke={left:0,top:0};class ti{constructor(t,i,s){const{settings:n,element:r,id:o}=t;if(e){if(e.has(i))throw new Error("You can only create one Muuri Item per element!");e.set(i,this)}this.id=Qe(),this.element=i,this.left=0,this.top=0,this.width=0,this.height=0,this.marginLeft=0,this.marginRight=0,this.marginTop=0,this.marginBottom=0,this._gridId=o,this._isDestroyed=!1,this._translateX=void 0,this._translateY=void 0,this._containerDiffX=0,this._containerDiffY=0,this._sortData=null,this._emitter=new Lt,r&&i.parentNode!==r&&r.appendChild(i),$t(i,n.itemClass),"boolean"!=typeof s&&(s="none"!==lt(i,"display")),this._isActive=s,this._visibility=new ze(this),this._layout=new Be(this),this._migrate=new Fe(this),this._drag=n.dragEnabled?new ye(this):null,this._dragRelease=new Ge(this),this._dragPlaceholder=new qe(this)}getGrid(){return t.get(this._gridId)||null}isActive(){return this._isActive}isVisible(){return!this._visibility.isHidden()}isShowing(){return!!this._visibility.isShowing()}isHiding(){return!!this._visibility.isHiding()}isPositioning(){return!!this._layout.isActive()}isDragging(){var t;return!!(null===(t=this._drag)||void 0===t?void 0:t.isActive())}isReleasing(){return!!this._dragRelease.isActive()}isDestroyed(){return this._isDestroyed}_updateDimensions(t){if(this._isDestroyed)return;if(!0!==t&&!this.isVisible()&&!this.isHiding())return;const e=this.element,{width:i,height:s}=e.getBoundingClientRect();this.width=i,this.height=s,this.marginLeft=Math.max(0,dt(e,"margin-left")),this.marginRight=Math.max(0,dt(e,"margin-right")),this.marginTop=Math.max(0,dt(e,"margin-top")),this.marginBottom=Math.max(0,dt(e,"margin-bottom")),this._dragPlaceholder.updateDimensions()}_updateSortData(){if(this._isDestroyed)return;const{settings:t}=this.getGrid(),{sortData:e}=t;if(this._sortData={},e){let t;for(t in e)this._sortData[t]=e[t](this,this.element)}}_addToLayout(t=0,e=0){this.isActive()||(this._isActive=!0,this.left=t,this.top=e)}_removeFromLayout(){this.isActive()&&(this._isActive=!1,this.left=0,this.top=0)}_canSkipLayout(t,e){return this.left===t&&this.top===e&&!this._migrate.isActive()&&!this._dragRelease.isActive()&&!this._layout._skipNextAnimation}_setTranslate(t,e){this._translateX===t&&this._translateY===e||(this._translateX=t,this._translateY=e,this.element.style[ie]=Ce(t,e,this.getGrid().settings.translate3d))}_getTranslate(){if(void 0===this._translateX||void 0===this._translateY){const t=Me(this.element);Je.x=t.x,Je.y=t.y}else Je.x=this._translateX,Je.y=this._translateY;return Je}_getClientRootPosition(){const t=this.getGrid();return Ke.left=t._rect.left+t._borderLeft-this._containerDiffX,Ke.top=t._rect.top+t._borderTop-this._containerDiffY,Ke}_isInViewport(t,e,i=0){const s=this._getClientRootPosition();return n=this.width,r=this.height,o=s.left+this.marginLeft+t,h=s.top+this.marginTop+e,a=(a=i||0)||0,Ze.left=o,Ze.top=h,Ze.width=n,Ze.height=r,$e.left=0-a,$e.top=0-a,$e.width=Ue.width+a+a,$e.height=Ue.height+a+a,st(Ze,$e);var n,r,o,h,a}_destroy(t=!1){var i;if(this._isDestroyed)return;const s=this.element,{settings:n}=this.getGrid();this._dragPlaceholder.destroy(),this._dragRelease.destroy(),this._migrate.destroy(),this._layout.destroy(),this._visibility.destroy(),this._drag&&this._drag.destroy(),this._emitter.destroy(),ge(s,n.itemClass),t&&(null===(i=s.parentNode)||void 0===i||i.removeChild(s)),e&&e.delete(s),this._isActive=!1,this._isDestroyed=!0}}function ei(t=!1){const e=1,i=2,s=4,n=8,r=16,o=.001,h=.5;function a(t){return((1e3*t+.5<<0)/10<<0)/100}const l=new class{constructor(){this._currentRects=[],this._nextRects=[],this._rectStore=[],this._slotSizes=[],this._shards=[],this._rectTarget={left:0,top:0,width:0,height:0},this._tempRectA={left:0,top:0,width:0,height:0},this._tempRectB={left:0,top:0,width:0,height:0},this._rectId=0,this._slotIndex=-1,this._slot={left:0,top:0,width:0,height:0},this._sortRectsLeftTop=this._sortRectsLeftTop.bind(this),this._sortRectsTopLeft=this._sortRectsTopLeft.bind(this)}computeLayout(t,o){const h=t.items;if(!h.length)return t;const l=t.slots,d=!!(o&e),c=!!(o&i),_=!!(o&s),u=!!(o&n),m=!!(o&r),g="number"==typeof h[0],f=g?2:1;let p,v,y=0,w=0,S=0;for(y=0;y<h.length;y+=f)g?(w=h[y],S=h[y+1]):(v=h[y],w=v.width+(v.marginLeft||0)+(v.marginRight||0),S=v.height+(v.marginTop||0)+(v.marginBottom||0)),m&&(w=a(w),S=a(S)),p=this._computeNextSlot(t,w,S,d,c),c?p.left+p.width>t.width&&(t.width=p.left+p.width):p.top+p.height>t.height&&(t.height=p.top+p.height),l[++this._slotIndex]=p.left,l[++this._slotIndex]=p.top,(_||u)&&this._slotSizes.push(p.width,p.height);if(_)for(y=0;y<l.length;y+=2)l[y]=t.width-(l[y]+this._slotSizes[y]);if(u)for(y=1;y<l.length;y+=2)l[y]=t.height-(l[y]+this._slotSizes[y]);return this._slotSizes.length=0,this._currentRects.length=0,this._nextRects.length=0,this._shards.length=0,this._rectId=0,this._slotIndex=-1,t}_computeNextSlot(t,e,i,s,n){const{_slot:r,_currentRects:a,_nextRects:l}=this;let d,c,_=!1,u=!1,m=0,g=0;for(l.length=0,r.left=0,r.top=0,r.width=e,r.height=i,m=0;m<a.length;m++)if(c=a[m],c&&(d=this._getRect(c),r.width<=d.width+o&&r.height<=d.height+o)){u=!0,r.left=d.left,r.top=d.top;break}if(u||(n?(r.left=t.width,r.top=0):(r.left=0,r.top=t.height),s||(_=!0)),!n&&r.top+r.height>t.height+o&&(r.left>h&&l.push(this._addRect(0,t.height,r.left,1/0)),r.left+r.width<t.width-h&&l.push(this._addRect(r.left+r.width,t.height,t.width-r.left-r.width,1/0)),t.height=r.top+r.height),n&&r.left+r.width>t.width+o&&(r.top>h&&l.push(this._addRect(t.width,0,1/0,r.top)),r.top+r.height<t.height-h&&l.push(this._addRect(t.width,r.top+r.height,1/0,t.height-r.top-r.height)),t.width=r.left+r.width),!_)for(s&&(m=0);m<a.length;m++){if(c=a[m],!c)continue;d=this._getRect(c);const e=this._splitRect(d,r);for(g=0;g<e.length;g++)c=e[g],d=this._getRect(c),(n?d.left+o<t.width-o:d.top+o<t.height-o)&&l.push(c)}return l.length>1&&this._purgeRects(l).sort(n?this._sortRectsLeftTop:this._sortRectsTopLeft),this._currentRects=l,this._nextRects=a,r}_addRect(t,e,i,s){const n=++this._rectId;return this._rectStore[n]=t||0,this._rectStore[++this._rectId]=e||0,this._rectStore[++this._rectId]=i||0,this._rectStore[++this._rectId]=s||0,n}_getRect(t,e){return(e=e||this._rectTarget).left=this._rectStore[t]||0,e.top=this._rectStore[++t]||0,e.width=this._rectStore[++t]||0,e.height=this._rectStore[++t]||0,e}_splitRect(t,e){const{_shards:i}=this;let s=0,n=0;return i.length=0,t.left+t.width<=e.left+o||e.left+e.width<=t.left+o||t.top+t.height<=e.top+o||e.top+e.height<=t.top+o?(i.push(this._addRect(t.left,t.top,t.width,t.height)),i):(s=e.left-t.left,s>=h&&i.push(this._addRect(t.left,t.top,s,t.height)),s=t.left+t.width-(e.left+e.width),s>=h&&i.push(this._addRect(e.left+e.width,t.top,s,t.height)),n=e.top-t.top,n>=h&&i.push(this._addRect(t.left,t.top,t.width,n)),n=t.top+t.height-(e.top+e.height),n>=h&&i.push(this._addRect(t.left,e.top+e.height,t.width,n)),i)}_isRectAWithinRectB(t,e){return t.left+o>=e.left&&t.top+o>=e.top&&t.left+t.width-o<=e.left+e.width&&t.top+t.height-o<=e.top+e.height}_purgeRects(t){const{_tempRectA:e,_tempRectB:i}=this;let s=t.length,n=0;for(;s--;)if(n=t.length,t[s])for(this._getRect(t[s],e);n--;)if(t[n]&&s!==n&&(this._getRect(t[n],i),this._isRectAWithinRectB(e,i))){t[s]=0;break}return t}_sortRectsTopLeft(t,e){const{_tempRectA:i,_tempRectB:s}=this;return this._getRect(t,i),this._getRect(e,s),i.top<s.top&&i.top+o<s.top?-1:i.top>s.top&&i.top-o>s.top?1:i.left<s.left&&i.left+o<s.left?-1:i.left>s.left&&i.left-o>s.left?1:0}_sortRectsLeftTop(t,e){const{_tempRectA:i,_tempRectB:s}=this;return this._getRect(t,i),this._getRect(e,s),i.left<s.left&&i.left+o<s.left?-1:i.left>s.left&&i.left-o<s.left?1:i.top<s.top&&i.top+o<s.top?-1:i.top>s.top&&i.top-o>s.top?1:0}};if(t){const t=self,e=1,i=2,s=3,n=4;t.onmessage=function(r){const o=new Float32Array(r.data),h=o.subarray(n,o.length),a=new Float32Array(h.length),d=o[s],c={items:h,slots:a,width:o[e],height:o[i]};l.computeLayout(c,d),o[e]=c.width,o[i]=c.height,o.set(c.slots,n),t.postMessage(o.buffer,[o.buffer])}}return l}let ii="";const si=new Set;const ni=1,ri=2,oi=4,hi=8,ai=16,li=0,di=1,ci=2,_i=3,ui=4,mi=ei();class gi{constructor(t=0,e){this._settings=0,this._asyncMode=!0,this._workers=[],this._layoutWorkerQueue=[],this._layoutsProcessing=new Set,this._layoutWorkerData=new Map,this._onWorkerMessage=this._onWorkerMessage.bind(this),e&&this.updateSettings(e);try{this._workers=function(t,e){const i=[];if(t>0){ii||(ii=URL.createObjectURL(new Blob(["("+ei.toString()+")(true)"],{type:"application/javascript"})));let s=0;for(;s<t;s++){const t=new Worker(ii);t.onmessage=e,i.push(t),si.add(t)}}return i}(t,this._onWorkerMessage),this._asyncMode=!!this._workers.length}catch(t){}}updateSettings(t){let e=this._settings&ni;"boolean"==typeof t.fillGaps&&(e=t.fillGaps?ni:0);let i=this._settings&ri;"boolean"==typeof t.horizontal&&(i=t.horizontal?ri:0);let s=this._settings&oi;"boolean"==typeof t.alignRight&&(s=t.alignRight?oi:0);let n=this._settings&hi;"boolean"==typeof t.alignBottom&&(n=t.alignBottom?hi:0);let r=this._settings&ai;"boolean"==typeof t.rounding&&(r=t.rounding?ai:0),this._settings=e|i|s|n|r}createLayout(t,e,i,s){if(this._layoutWorkerData.has(t))throw new Error("A layout with the provided id is currently being processed.");const n=!this._asyncMode||!e.length,r=this._settings&ri,o={id:t,items:e,slots:new Float32Array(n?2*e.length:0),width:r?0:i.width,height:r?i.height:0,styles:{}};if(n)return e.length&&mi.computeLayout(o,this._settings),this._setContainerStyles(o,i,this._settings),void s(o);const h=new Float32Array(ui+2*e.length);h[li]=t,h[di]=o.width,h[ci]=o.height,h[_i]=this._settings;let a=0,l=ui-1;for(;a<e.length;a++){const t=e[a];h[++l]=t.width+(t.marginLeft||0)+(t.marginRight||0),h[++l]=t.height+(t.marginTop||0)+(t.marginBottom||0)}return this._layoutWorkerQueue.push(t),this._layoutWorkerData.set(t,Object.assign(Object.assign({},o),{container:i,settings:this._settings,callback:s,packet:h,aborted:!1})),this._sendToWorker(),this.cancelLayout.bind(this,t)}cancelLayout(t){const e=this._layoutWorkerData.get(t);if(e&&!e.aborted)if(e.worker)e.aborted=!0;else{const e=this._layoutWorkerQueue.indexOf(t);this._layoutWorkerQueue.splice(e,1),this._layoutWorkerData.delete(t)}}destroy(){this._layoutWorkerData.forEach((t=>{this.cancelLayout(t.id),t.worker&&this._workers.push(t.worker)})),this._layoutWorkerData.clear(),this._layoutsProcessing.clear(),this._layoutWorkerQueue.length=0,function(t){let e=0;for(;e<t.length;e++){const i=t[e];i.onmessage=null,i.onerror=null,i.onmessageerror=null,i.terminate(),si.delete(i)}ii&&!si.size&&(URL.revokeObjectURL(ii),ii="")}(this._workers),this._workers.length=0}_sendToWorker(){if(!this._layoutWorkerQueue.length||!this._workers.length)return;const t=this._workers.pop(),e=this._layoutWorkerQueue.shift(),i=this._layoutWorkerData.get(e);i.worker=t,this._layoutsProcessing.add(e);const{buffer:s}=i.packet;t.postMessage(s,[s])}_onWorkerMessage(t){const e=new Float32Array(t.data),i=e[li],s=this._layoutWorkerData.get(i);if(this._layoutWorkerData.delete(i),this._layoutsProcessing.delete(i),!s)return;const{worker:n}=s;if(n&&this._workers.push(n),!s.aborted){const t={id:i,items:s.items,slots:e.subarray(ui,e.length),width:e[di],height:e[ci],styles:{}};this._setContainerStyles(t,s.container,s.settings),s.callback(t)}n&&this._sendToWorker()}_setContainerStyles(t,e,i){const s=!!(i&ri),n="border-box"===e.boxSizing,{borderLeft:r=0,borderRight:o=0,borderTop:h=0,borderBottom:a=0}=e,{styles:l,width:d,height:c}=t;s?l.width=(n?d+r+o:d)+"px":l.height=(n?c+h+a:c)+"px"}}let fi=0;function pi(t,e){let i=++fi,s=0,n=0,r=!1,o=e=>{r||(n&&(s-=e-n),n=e,s>0?o&&function(t,e){Q.add(0,j+t,e)}(i,o):(s=n=0,t()))};return function(h=!1){if(!r){if(!(e<=0))return!0===h?(r=!0,s=n=0,o=void 0,void function(t){Q.remove(0,j+t)}(i)):void(s<=0?(s=e,o&&o(0)):s=e);!0!==h&&t()}}}const vi=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||function(){return!1};function yi(t,e){return vi.call(t,e)}function wi(t){const e=Object.prototype.toString.call(t);return"[object HTMLCollection]"===e||"[object NodeList]"===e}const Si=Object.prototype.toString;function bi(t){return"object"==typeof t&&"[object Object]"===Si.call(t)}let Di=0;function Ai(t,e={}){let i=Ti({},t);return i=Ti(i,e),e.visibleStyles?i.visibleStyles=Object.assign({},e.visibleStyles):t.visibleStyles&&(i.visibleStyles=Object.assign({},t.visibleStyles)),e.hiddenStyles?i.hiddenStyles=Object.assign({},e.hiddenStyles):t.hiddenStyles&&(i.hiddenStyles=Object.assign({},t.hiddenStyles)),i}function Ti(t,e){const i=Object.keys(e),s=i.length;let n=0;for(;n<s;n++){const s=i[n],r=bi(e[s]);bi(t[s])&&r?t[s]=Ti(Ti({},t[s]),e[s]):r?t[s]=Ti({},e[s]):Array.isArray(e[s])?t[s]=e[s].slice(0):t[s]=e[s]}return t}function ki(t){const e={},i=document.documentElement.style;let s,n;for(s in t)t[s]&&(n=It(i,s),n&&(e[n]=t[s]));return e}function xi(t){const e={};let i=0;for(;i<t.length;i++)e[t[i].id]=i;return e}function Ri(t,e,i){return t[e.id]-t[i.id]}function Ci(t,e){let i;for(i in t)if(t[i]!==e[i])return!1;return Object.keys(t).length===Object.keys(e).length}class Ei{constructor(e,i={}){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("No container element found.");e=t}if(!e.isConnected||e===document.documentElement)throw new Error("Container element must be an existing DOM element.");const s=Ai(Ei.defaultOptions,i);s.visibleStyles=ki(s.visibleStyles),s.hiddenStyles=ki(s.hiddenStyles),this.id=Qe(),this.element=e,this.settings=s,this.items=[],this._isDestroyed=!1,this._rect={width:0,height:0,left:0,right:0,top:0,bottom:0},this._borderLeft=0,this._borderRight=0,this._borderTop=0,this._borderBottom=0,this._boxSizing="",this._layout={id:0,items:[],slots:[]},this._isLayoutFinished=!0,this._nextLayoutData=null,this._resizeHandler=null,this._emitter=new Lt,t.set(this.id,this),$t(e,s.containerClass),this._bindLayoutOnResize(s.layoutOnResize),this.add(function(t,e){if("*"===e)return t.children;if("string"==typeof e){const i=[],s=t.children;let n=0;for(;n<s.length;n++)yi(s[n],e)&&i.push(s[n]);return i}return Array.isArray(e)||wi(e)?e:[]}(e,s.items),{layout:!1}),s.layoutOnInit&&this.layout(!0)}on(t,e){return this._emitter.on(t,e),this}off(t,e){return this._emitter.off(t,e),this}isDestroyed(){return this._isDestroyed}getItem(t){if(this._isDestroyed||!t&&0!==t)return null;if("number"==typeof t)return this.items[t>-1?t:this.items.length+t]||null;if(t instanceof ti)return t._gridId===this.id?t:null;const i=e.get(t);return i&&i._gridId===this.id?i:null}getItems(t){if(this._isDestroyed||void 0===t)return this.items.slice(0);const e=[];if(Array.isArray(t)||wi(t)){let i,s=0;for(;s<t.length;s++)i=this.getItem(t[s]),i&&e.push(i)}else{const i=this.getItem(t);i&&e.push(i)}return e}updateSettings(t){if(this._isDestroyed||!t)return this;const{settings:e,items:i}=this,s=[];let n=!1,r=!1,o=!1,h=!1,a=!1,l=!1;const d=Ai(e,t);d.visibleStyles=ki(d.visibleStyles),d.hiddenStyles=ki(d.hiddenStyles),this.settings=d;for(let i in t)switch(i){case"visibleStyles":a=!Ci(e[i],d[i]);break;case"hiddenStyles":l=!Ci(e[i],d[i]);break;case"dragEnabled":n=e[i]!==d[i];break;case"dragHandle":r=e[i]!==d[i];break;case"dragCssProps":o=!Ci(e[i],d[i]);break;case"dragEventListenerOptions":h=!Ci(e[i],d[i]);break;case"layoutOnResize":e[i]!==d[i]&&(this._unbindLayoutOnResize(),this._bindLayoutOnResize(d[i]));break;case"containerClass":e[i]!==d[i]&&(ge(this.element,e[i]),$t(this.element,d[i]));break;case"itemClass":case"itemVisibleClass":case"itemHiddenClass":case"itemPositioningClass":case"itemDraggingClass":case"itemReleasingClass":case"itemPlaceholderClass":e[i]!==d[i]&&s.push(i,e[i],d[i])}if(s.length||a||l||n||r||o||h){let t,e;for(t=0;t<i.length;t++){const c=i[t];for(e=0;e<s.length;e+=3){const t=s[e],i=s[e+1],n=s[e+2];let r=!1;switch(t){case"itemClass":r=!0;break;case"itemVisibleClass":r=c.isVisible();break;case"itemHiddenClass":r=!c.isVisible();break;case"itemPositioningClass":r=c.isPositioning();break;case"itemDraggingClass":r=c.isDragging();break;case"itemReleasingClass":r=c.isReleasing();break;case"itemPlaceholderClass":c._dragPlaceholder.updateClassName(n)}r&&(ge(c.element,i),$t(c.element,n))}c.isActive()?a&&(c._visibility.setStyles(d.visibleStyles),c._visibility.stop(!0)):l&&(c._visibility.setStyles(d.hiddenStyles),c._visibility.stop(!0)),(r||n)&&c._drag&&c._drag.getOriginGrid()===this&&(c._drag.destroy(),c._drag=null),d.dragEnabled&&(c._drag?c._drag.getOriginGrid()===this&&(o&&c._drag.dragger.setCssProps(d.dragCssProps),h&&c._drag.dragger.setListenerOptions(d.dragEventListenerOptions)):c._drag=new ye(c))}}return"sortData"in t&&this.refreshSortData(),this}refreshItems(t,e=!1){if(this._isDestroyed)return this;const i=t||this.items;let s,n,r,o;if(!0===e)for(o=[],s=0;s<i.length;s++)n=i[s],n.isVisible()||n.isHiding()||(r=n.element.style,r.visibility="hidden",r.display="",o.push(r));for(s=0;s<i.length;s++)i[s]._updateDimensions(e);if(o){for(s=0;s<o.length;s++)r=o[s],r.visibility="",r.display="none";o.length=0}return this}refreshSortData(t){if(this._isDestroyed)return this;const e=t||this.items;let i=0;for(;i<e.length;i++)e[i]._updateSortData();return this}synchronize(){if(this._isDestroyed)return this;const{items:t}=this;if(!t.length)return this;let e,i,s=0;for(;s<t.length;s++)i=t[s].element,i.parentNode===this.element&&(e||(e=document.createDocumentFragment()),e.appendChild(i));return e?(this.element.appendChild(e),this._emit("synchronize"),this):this}layout(t=!1,e){if(this._isDestroyed)return this;const i=this._nextLayoutData;i&&ct(i.cancel)&&i.cancel();const s=Di=Di%16777216+1;this._nextLayoutData={id:s,instant:t,onFinish:e,cancel:null};const{items:n}=this,r=[];let o=0;for(;o<n.length;o++)n[o].isActive()&&r.push(n[o]);this._updateDimensions();const h={width:this._rect.width-this._borderLeft-this._borderRight,height:this._rect.height-this._borderTop-this._borderBottom,borderLeft:this._borderLeft,borderRight:this._borderRight,borderTop:this._borderTop,borderBottom:this._borderBottom,boxSizing:this._boxSizing},{layout:a}=this.settings;let l;return ct(a)?l=a(s,this,r,h,(t=>{this._onLayoutDataReceived(t)})):(Ei.defaultPacker.updateSettings(a),l=Ei.defaultPacker.createLayout(s,r,h,(t=>{this._onLayoutDataReceived(Object.assign(Object.assign({},t),{items:r}))}))),ct(l)&&this._nextLayoutData&&this._nextLayoutData.id===s&&(this._nextLayoutData.cancel=l),this}add(t,e={}){if(this._isDestroyed||!t)return[];const i=wi(s=t)?Array.prototype.slice.call(s):Array.prototype.concat(s);var s;if(!i.length)return[];const r=e.layout?e.layout:void 0===e.layout,{items:o}=this;let h,a,l,d,c=!1;for(d=0;d<i.length;d++)a=i[d],a.parentNode!==this.element&&(h=h||document.createDocumentFragment(),h.appendChild(a));h&&this.element.appendChild(h);const _=[];for(d=0;d<i.length;d++)a=i[d],l=_[d]=new ti(this,a,e.active),l.isActive()&&(c=!0,l._layout._skipNextAnimation=!0);for(d=0;d<_.length;d++)l=_[d],l._updateDimensions(),l._updateSortData();return Jt(o,_,e.index),this._hasListeners("add")&&this._emit("add",_.slice(0)),c&&r&&this.layout(r===n,ct(r)?r:void 0),_}remove(t,e={}){if(this._isDestroyed||!t.length)return[];const i=e.layout?e.layout:void 0===e.layout,s=this.getItems(),r=[],o=[];let h,l,d,c=!1;for(d=0;d<t.length;d++)l=t[d],l.isDestroyed()||(h=this.items.indexOf(l),-1!==h&&(l.isActive()&&(c=!0),r.push(l),o.push(s.indexOf(l)),l._destroy(e.removeElements),this.items.splice(h,1)));return this._hasListeners(a)&&this._emit(a,r.slice(0),o),c&&i&&this.layout(i===n,ct(i)?i:void 0),r}show(t,e={}){return!this._isDestroyed&&t.length&&this._setItemsVisibility(t,!0,e),this}hide(t,e={}){return!this._isDestroyed&&t.length&&this._setItemsVisibility(t,!1,e),this}filter(t,e={}){if(this._isDestroyed||!this.items.length)return this;const i=[],s=[];if(ct(t)||"string"==typeof t){let e,n;for(n=0;n<this.items.length;n++)e=this.items[n],(ct(t)?t(e):yi(e.element,t))?i.push(e):s.push(e)}const r=ct(e.onFinish)?e.onFinish:void 0;let o=[],h=[],a=-1;if(i.length?this.show(i,{instant:!!e.instant,syncWithLayout:!!e.syncWithLayout,onFinish:r?t=>{o=t,++a&&r(o,h)}:void 0,layout:!1}):r&&++a&&r(o,h),s.length?this.hide(s,{instant:!!e.instant,syncWithLayout:!!e.syncWithLayout,onFinish:r?t=>{h=t,++a&&r(o,h)}:void 0,layout:!1}):r&&++a&&r(o,h),i.length||s.length){this._hasListeners(d)&&this._emit(d,i.slice(0),s.slice(0));const t=e.layout?e.layout:void 0===e.layout;t&&this.layout(t===n,ct(t)?t:void 0)}return this}sort(t,e={}){if(this._isDestroyed||this.items.length<2)return this;const{items:i}=this,s=i.slice(0),r=e.layout?e.layout:void 0===e.layout,o=!!e.descending;let h=null;if(ct(t))i.sort(((e,i)=>{let n=o?-t(e,i):t(e,i);return n||(h||(h=xi(s)),n=o?Ri(h,i,e):Ri(h,e,i)),n}));else if("string"==typeof t){const e=t.trim().split(" ").filter((function(t){return t})).map((function(t){return t.split(":")}));i.sort(((t,i)=>{let n=0,r=0;for(;r<e.length;r++){const s=e[r][0],h=e[r][1];null===t._sortData&&t._updateSortData(),null===i._sortData&&i._updateSortData();const a=t._sortData[s],l=i._sortData[s];if(n="desc"===h||!h&&o?l<a?-1:l>a?1:0:a<l?-1:a>l?1:0,n)return n}return n||(h||(h=xi(s)),n=o?Ri(h,i,t):Ri(h,t,i)),n}))}else{if(!Array.isArray(t))throw new Error("Invalid comparer argument provided.");i.length=0,i.push.apply(i,t)}return this._hasListeners(c)&&this._emit(c,i.slice(0),s),r&&this.layout(r===n,ct(r)?r:void 0),this}move(t,e,r={}){if(this._isDestroyed||this.items.length<2)return this;const{items:o}=this,h=r.layout?r.layout:void 0===r.layout,a=r.action===i,l=a?i:s,d=this.getItem(t),c=this.getItem(e);if(d&&c&&d!==c){const t=o.indexOf(d),e=o.indexOf(c);a?ee(o,t,e):te(o,t,e),this._hasListeners(_)&&this._emit(_,{item:d,fromIndex:t,toIndex:e,action:l}),h&&this.layout(h===n,ct(h)?h:void 0)}return this}send(t,e,i,s={}){if(this._isDestroyed||e._isDestroyed||this===e)return this;const r=this.getItem(t);if(!r)return this;if(r._migrate.start(e,i,s.appendTo||document.body),r._migrate.isActive()&&r.isActive()){const t=s.layoutSender?s.layoutSender:void 0===s.layoutSender,i=s.layoutReceiver?s.layoutReceiver:void 0===s.layoutReceiver;t&&this.layout(t===n,ct(t)?t:void 0),i&&e.layout(i===n,ct(i)?i:void 0)}return this}destroy(e=!1){if(this._isDestroyed)return this;const i=this.element,s=this.getItems(),n=this._layout&&this._layout.styles||{};this._unbindLayoutOnResize();let r,o=0;for(;o<s.length;o++)s[o]._destroy(e);for(r in this.items.length=0,ge(i,this.settings.containerClass),n)i.style[r]="";return t.delete(this.id),this._isDestroyed=!0,this._emitter.emit("destroy"),this._emitter.destroy(),this}_emit(t,...e){this._isDestroyed||this._emitter.emit(t,...e)}_hasListeners(t){return!this._isDestroyed&&this._emitter.countListeners(t)>0}_updateBoundingRect(){const{_rect:t}=this,{width:e,height:i,left:s,right:n,top:r,bottom:o}=this.element.getBoundingClientRect();t.width=e,t.height=i,t.left=s,t.right=n,t.top=r,t.bottom=o}_updateBorders(t,e,i,s){const{element:n}=this;t&&(this._borderLeft=dt(n,"border-left-width")),e&&(this._borderRight=dt(n,"border-right-width")),i&&(this._borderTop=dt(n,"border-top-width")),s&&(this._borderBottom=dt(n,"border-bottom-width"))}_updateDimensions(){this._updateBoundingRect(),this._updateBorders(!0,!0,!0,!0),this._boxSizing=lt(this.element,"box-sizing")}_bindLayoutOnResize(t){"number"!=typeof t&&(t=!0===t?0:-1),t>=0&&(this._resizeHandler=pi((()=>{this.refreshItems().layout()}),t),window.addEventListener("resize",this._resizeHandler))}_unbindLayoutOnResize(){const{_resizeHandler:t}=this;ct(t)&&(t(!0),window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null)}_onLayoutDataReceived(t){if(this._isDestroyed||!this._nextLayoutData||this._nextLayoutData.id!==t.id)return;const{instant:e,onFinish:i}=this._nextLayoutData,s=t.items.length;let n,a,l,d,c=s;this._nextLayoutData=null,!this._isLayoutFinished&&this._hasListeners(h)&&this._emit(h,this._layout.items.slice(0)),this._layout=t;const _=[];for(d=0;d<s;d++)n=t.items[d],n?(a=t.slots[2*d],l=t.slots[2*d+1],n._canSkipLayout(a,l)?--c:(n.left=a,n.top=l,n.isActive()&&!n.isDragging()?_.push(n):--c)):--c;if(t.styles&&De(this.element,t.styles),this._hasListeners(r)&&(this._emit(r,t.items.slice(0),e),this._layout.id!==t.id))return;const u=()=>{if(--c>0)return;const e=this._layout.id!==t.id;e||(this._isLayoutFinished=!0),ct(i)&&i(t.items.slice(0),e),!e&&this._hasListeners(o)&&this._emit(o,t.items.slice(0))};if(_.length)for(this._isLayoutFinished=!1,d=0;d<_.length&&this._layout.id===t.id;d++)_[d]._layout.start(e,u);else u()}_setItemsVisibility(t,e,i={}){const s=t.slice(0),o=!0===i.instant,h=i.onFinish,a=i.layout?i.layout:void 0===i.layout,d=e?"showStart":l,c=e?"showEnd":"hideEnd",_=e?"show":"hide",u=[],m=[];let g,f,p=!1,v=s.length;if(!v)return void(ct(h)&&h(s));for(f=0;f<s.length;f++)g=s[f],(e&&!g.isActive()||!e&&g.isActive())&&(p=!0),g._layout._skipNextAnimation=!(!e||g.isActive()),!e||g.isVisible()||g.isHiding()||m.push(g),e?g._addToLayout():g._removeFromLayout();m.length&&(this.refreshItems(m,!0),m.length=0);const y=()=>{for(p&&!1!==i.syncWithLayout&&this.off(r,y),this._hasListeners(d)&&this._emit(d,s.slice(0)),f=0;f<s.length;f++)g=s[f],g._gridId===this.id?g._visibility[_](o,((t,e)=>{t||u.push(e),--v<1&&(ct(h)&&h(u.slice(0)),this._hasListeners(c)&&this._emit(c,u.slice(0)))})):--v<1&&(ct(h)&&h(u.slice(0)),this._hasListeners(c)&&this._emit(c,u.slice(0)))};p&&!1!==i.syncWithLayout?this.on(r,y):y(),p&&a&&this.layout(a===n,ct(a)?a:void 0)}}return Ei.Item=ti,Ei.ItemLayout=Be,Ei.ItemVisibility=ze,Ei.ItemMigrate=Fe,Ei.ItemDrag=ye,Ei.ItemDragRelease=Ge,Ei.ItemDragPlaceholder=qe,Ei.AutoScroller=Et,Ei.Emitter=Lt,Ei.Animator=Re,Ei.Dragger=Zt,Ei.Packer=gi,Ei.defaultPacker=new gi,Ei.defaultOptions={items:"*",showDuration:300,showEasing:"ease",hideDuration:300,hideEasing:"ease",visibleStyles:{opacity:"1",transform:"scale(1)"},hiddenStyles:{opacity:"0",transform:"scale(0.5)"},layout:{fillGaps:!1,horizontal:!1,alignRight:!1,alignBottom:!1,rounding:!1},layoutOnResize:150,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",sortData:null,translate3d:!1,dragEnabled:!1,dragContainer:null,dragHandle:null,dragStartPredicate:{distance:0,delay:0},dragAxis:"xy",dragSort:!0,dragSortHeuristics:{sortInterval:100,minDragDistance:10,minBounceBackAngle:1},dragSortPredicate:{threshold:50,action:s,migrateAction:s},dragRelease:{duration:300,easing:"ease",useDragContainer:!0},dragCssProps:{touchAction:"none",userSelect:"none",userDrag:"none",tapHighlightColor:"rgba(0, 0, 0, 0)",touchCallout:"none",contentZooming:"none"},dragEventListenerOptions:{passive:!0,capture:!1},dragPlaceholder:{enabled:!1,createElement:null,onCreate:null,onRemove:null},dragAutoScroll:{targets:[],handle:null,threshold:50,safeZone:.2,speed:Et.smoothSpeed(1e3,2e3,2500),sortDuringScroll:!0,smoothStop:!1,onStart:null,onStop:null},containerClass:"muuri",itemClass:"muuri-item",itemVisibleClass:"muuri-item-shown",itemHiddenClass:"muuri-item-hidden",itemPositioningClass:"muuri-item-positioning",itemDraggingClass:"muuri-item-dragging",itemReleasingClass:"muuri-item-releasing",itemPlaceholderClass:"muuri-item-placeholder",_animationWindowing:!1},Ei}));