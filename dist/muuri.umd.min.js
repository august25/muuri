!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("tikki"),require("eventti")):"function"==typeof define&&define.amd?define(["exports","tikki","eventti"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Muuri={},t.tikki,t.eventti)}(this,(function(t,e,i){"use strict";function s(t){return"function"==typeof t}function n(t,e){let i;for(i in e)t.style[i]=e[i]||""}const r=!!((o=Element.prototype.animate)&&s(window.Symbol)&&s(window.Symbol.toString)&&window.Symbol(o).toString().indexOf("[native code]")>-1);var o;class h{constructor(t){this.element=t||null,this.animation=null,this._finishCallback=null,this._onFinish=this._onFinish.bind(this)}start(t,e,i){if(!this.element)return;const{element:o}=this,{duration:h,easing:a,onFinish:l}=i||{};if(!r)return n(o,e),this._finishCallback=s(l)?l:null,void this._onFinish();this.animation&&this.animation.cancel(),this.animation=o.animate([Object.assign({},t),Object.assign({},e)],{duration:h||300,easing:a||"ease"}),this._finishCallback=s(l)?l:null,this.animation.onfinish=this._onFinish,n(o,e)}stop(){this.element&&this.animation&&(this.animation.cancel(),this.animation=this._finishCallback=null)}isAnimating(){return!!this.animation}destroy(){this.element&&(this.stop(),this.element=null)}_onFinish(){const{_finishCallback:t}=this;this.animation=this._finishCallback=null,t&&t()}}const a=Symbol(),l=Symbol(),d=Symbol(),c=Symbol(),_="layoutRead",u="layoutWrite",m="visibilityRead",f="visibilityWrite",g="dragStartRead",p="dragStartWrite",y="dragMoveRead",v="dragMoveWrite",S="dragScrollRead",w="dragScrollWrite",b="dragSortRead",D="releaseScrollRead",T="releaseScrollWrite",A="placeholderLayoutRead",k="placeholderLayoutWrite",R="placeholderResizeWrite",x="autoScrollRead",E="autoScrollWrite",C="debounceRead",L=new Map;function X(t,e,i){L.size||I.once(a,(()=>{L.clear()}));let s=L.get(e);s&&I.off(t,s),s=I.once(t,i),L.set(e,s)}function Y(t,e){const i=L.get(e);i&&(L.delete(e),I.off(t,i))}const I=new e.Ticker({phases:[a,l,d,c]});function P(t,e,i){X(l,_+t,e),X(c,u+t,i)}function M(t){Y(l,_+t),Y(c,u+t)}function O(t,e,i){X(l,m+t,e),X(c,f+t,i)}function H(t){Y(l,m+t),Y(c,f+t)}function q(t,e,i){X(l,g+t,e),X(c,p+t,i)}function G(t){Y(l,g+t),Y(c,p+t)}function W(t,e,i){X(l,y+t,e),X(c,v+t,i)}function N(t){Y(l,y+t),Y(c,v+t)}function V(t,e,i){X(l,S+t,e),X(c,w+t,i)}function B(t){Y(l,S+t),Y(c,w+t)}function z(t,e){X(d,b+t,e)}function F(t){Y(d,b+t)}function j(t,e,i){X(l,D+t,e),X(c,T+t,i)}function Q(t){Y(l,D+t),Y(c,T+t)}function U(t,e,i){X(l,A+t,e),X(c,k+t,i)}function Z(t){Y(l,A+t),Y(c,k+t)}function $(t,e){X(c,R+t,e)}function J(t){Y(c,R+t)}function K(t,e){X(l,x,t),X(c,E,e)}function tt(){Y(l,x),Y(c,E)}function et(t,e){X(l,C+t,e)}function it(t){Y(l,C+t)}function st(t,e){return!(t.left+t.width<=e.left||e.left+e.width<=t.left||t.top+t.height<=e.top||e.top+e.height<=t.top)}function nt(t,e){const i=function(t,e){return st(t,e)?(Math.min(t.left+t.width,e.left+e.width)-Math.max(t.left,e.left))*(Math.min(t.top+t.height,e.top+e.height)-Math.max(t.top,e.top)):0}(t,e);if(!i)return 0;return i/(Math.min(t.width,e.width)*Math.min(t.height,e.height))*100}let rt=new WeakMap,ot=null,ht=!0;const at=function(){ht?ht=!0:(null!==ot&&(window.clearInterval(ot),ot=null),rt=new WeakMap)};function lt(t,e){if(!e)return"";let i=rt.get(t);return i||(i=window.getComputedStyle(t,null),rt.set(t,i)),ot?ht=!1:ot=window.setInterval(at,1e3),i.getPropertyValue(e)}function dt(t,e){return parseFloat(lt(t,e))||0}const ct={width:0,height:0,left:0,right:0,top:0,bottom:0},_t=Object.assign({},ct),ut={direction:0,threshold:0,distance:0,value:0,maxValue:0,duration:0,speed:0,deltaTime:0,isEnding:!1};function mt(t){return t===window}function ft(t){return mt(t)||t===document.documentElement||t===document.body?window:t}function gt(t){return mt(t)?t.pageXOffset:t.scrollLeft}function pt(t){return mt(t)?t.pageYOffset:t.scrollTop}function yt(t){return mt(t)?document.documentElement.scrollWidth-document.documentElement.clientWidth:t.scrollWidth-t.clientWidth}function vt(t){return mt(t)?document.documentElement.scrollHeight-document.documentElement.clientHeight:t.scrollHeight-t.clientHeight}function St(t,e={width:0,height:0,left:0,right:0,top:0,bottom:0}){if(mt(t))e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight,e.left=0,e.right=e.width,e.top=0,e.bottom=e.height;else{const{left:i,top:s}=t.getBoundingClientRect(),n=t.clientLeft||dt(t,"border-left-width"),r=t.clientTop||dt(t,"border-top-width");e.width=t.clientWidth,e.height=t.clientHeight,e.left=i+n,e.right=e.left+e.width,e.top=s+r,e.bottom=e.top+e.height}return e}function wt(t){return t.getGrid().settings.dragAutoScroll}function bt(t){const e=t._drag;e&&e._prepareScroll()}function Dt(t){if(!t.isActive())return;const e=t._drag;e&&(e._scrollDiffX=e._scrollDiffY=0,t._setTranslate(e._translateX,e._translateY))}function Tt(t,e){return Math.min(e/2,t)}function At(t,e,i,s){return Math.max(0,i+2*t+s*e-s)/2}class kt{constructor(t,e){this._pool=[],this._createObject=t,this._onRelease=e}pick(){return this._pool.pop()||this._createObject()}release(t){-1===this._pool.indexOf(t)&&(this._onRelease&&this._onRelease(t),this._pool.push(t))}reset(){this._pool.length=0}}class Rt{constructor(){this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}reset(){this.requestX&&(this.requestX.action=null),this.requestY&&(this.requestY.action=null),this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}addRequest(t){1&t.direction?(this.requestX&&this.removeRequest(this.requestX),this.requestX=t):(this.requestY&&this.removeRequest(this.requestY),this.requestY=t),t.action=this}removeRequest(t){this.requestX===t?(this.requestX=null,t.action=null):this.requestY===t&&(this.requestY=null,t.action=null)}computeScrollValues(){this.element&&(this.scrollLeft=this.requestX?this.requestX.value:gt(this.element),this.scrollTop=this.requestY?this.requestY.value:pt(this.element))}scroll(){this.element&&(this.element.scrollTo?this.element.scrollTo(this.scrollLeft,this.scrollTop):(this.element.scrollLeft=this.scrollLeft,this.element.scrollTop=this.scrollTop))}}class xt{constructor(){this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}reset(){this.isActive&&this.onStop(),this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}hasReachedEnd(){return 4&this.direction?this.value>=this.maxValue:this.value<=0}computeCurrentScrollValue(){return this.element?this.value!=this.value?1&this.direction?gt(this.element):pt(this.element):Math.max(0,Math.min(this.value,this.maxValue)):0}computeNextScrollValue(){const t=this.speed*(this.deltaTime/1e3),e=4&this.direction?this.value+t:this.value-t;return Math.max(0,Math.min(e,this.maxValue))}computeSpeed(){if(!this.item||!this.element)return 0;const t=wt(this.item).speed;return s(t)?(ut.direction=this.direction,ut.threshold=this.threshold,ut.distance=this.distance,ut.value=this.value,ut.maxValue=this.maxValue,ut.duration=this.duration,ut.speed=this.speed,ut.deltaTime=this.deltaTime,ut.isEnding=this.isEnding,t(this.item,this.element,ut)):t}tick(t){return this.isActive||(this.isActive=!0,this.onStart()),this.deltaTime=t,this.value=this.computeCurrentScrollValue(),this.speed=this.computeSpeed(),this.value=this.computeNextScrollValue(),this.duration+=t,this.value}onStart(){if(!this.item||!this.element)return;const{onStart:t}=wt(this.item);s(t)&&t(this.item,this.element,this.direction)}onStop(){if(!this.item||!this.element)return;const{onStop:t}=wt(this.item);s(t)&&t(this.item,this.element,this.direction);const e=this.item._drag;e&&e.sort()}}class Et{constructor(){this._isDestroyed=!1,this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,this._items=[],this._actions=[],this._requests={1:new Map,2:new Map},this._requestOverlapCheck=new Map,this._dragPositions=new Map,this._dragDirections=new Map,this._overlapCheckInterval=150,this._requestPool=new kt((()=>new xt),(t=>t.reset())),this._actionPool=new kt((()=>new Rt),(t=>t.reset())),this._readTick=this._readTick.bind(this),this._writeTick=this._writeTick.bind(this)}isDestroyed(){return this._isDestroyed}addItem(t,e,i){if(this._isDestroyed)return;-1===this._items.indexOf(t)&&(this._items.push(t),this._requestOverlapCheck.set(t.id,this._tickTime),this._dragDirections.set(t.id,[0,0]),this._dragPositions.set(t.id,[e,i]),this._isTicking||this._startTicking())}updateItem(t,e,i){if(this._isDestroyed)return;const s=this._dragPositions.get(t.id),n=this._dragDirections.get(t.id);if(!s||!n)return;const r=s[0],o=s[1];n[0]=e>r?5:e<r?9:n[0]||0,n[1]=i>o?6:i<o?10:n[1]||0,s[0]=e,s[1]=i,this._requestOverlapCheck.set(t.id,this._requestOverlapCheck.get(t.id)||this._tickTime)}removeItem(t){if(this._isDestroyed)return;const e=this._items.indexOf(t);if(-1===e)return;const i=t.id;this._requests[1].get(i)&&(this._cancelItemScroll(t,1),this._requests[1].delete(i));this._requests[2].get(i)&&(this._cancelItemScroll(t,2),this._requests[2].delete(i)),this._requestOverlapCheck.delete(i),this._dragPositions.delete(i),this._dragDirections.delete(i),this._items.splice(e,1),this._isTicking&&!this._items.length&&this._stopTicking()}isItemScrollingX(t){const e=this._requests[1].get(t.id);return!(!e||!e.isActive)}isItemScrollingY(t){const e=this._requests[2].get(t.id);return!(!e||!e.isActive)}isItemScrolling(t){return this.isItemScrollingX(t)||this.isItemScrollingY(t)}destroy(){if(this._isDestroyed)return;const t=this._items.slice(0);let e=0;for(;e<t.length;e++)this.removeItem(t[e]);this._actions.length=0,this._requestPool.reset(),this._actionPool.reset(),this._isDestroyed=!0}_readTick(t){this._isDestroyed||(t&&this._tickTime?(this._tickDeltaTime=t-this._tickTime,this._tickTime=t,this._updateRequests(),this._updateActions()):(this._tickTime=t,this._tickDeltaTime=0))}_writeTick(){this._isDestroyed||(this._applyActions(),K(this._readTick,this._writeTick))}_startTicking(){this._isTicking=!0,K(this._readTick,this._writeTick)}_stopTicking(){this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,tt()}_getItemHandleRect(t,e,i={width:0,height:0,left:0,right:0,top:0,bottom:0}){const s=t._drag;if(e){const n=s._dragMoveEvent||s._dragStartEvent,r=e(t,s._clientX,s._clientY,t.width,t.height,n.clientX,n.clientY);i.left=r.left,i.top=r.top,i.width=r.width,i.height=r.height}else i.left=s._clientX,i.top=s._clientY,i.width=t.width,i.height=t.height;return i.right=i.left+i.width,i.bottom=i.top+i.height,i}_requestItemScroll(t,e,i,s,n,r,o){const h=this._requests[e];let a=h.get(t.id);a?a.element===i&&a.direction===s||a.reset():a=this._requestPool.pick(),a.item=t,a.element=i,a.direction=s,a.threshold=n,a.distance=r,a.maxValue=o,h.set(t.id,a)}_cancelItemScroll(t,e){const i=this._requests[e],s=i.get(t.id);s&&(s.action&&s.action.removeRequest(s),this._requestPool.release(s),i.delete(t.id))}_checkItemOverlap(t,e,i){const n=wt(t),{threshold:r,safeZone:o,handle:h,targets:a}=n,l=s(a)?a(t):a;if(!l||!l.length)return e&&this._cancelItemScroll(t,1),void(i&&this._cancelItemScroll(t,2));const d=this._dragDirections.get(t.id),c=d&&d[0]||0,_=d&&d[1]||0;if(!c&&!_)return e&&this._cancelItemScroll(t,1),void(i&&this._cancelItemScroll(t,2));const u=this._getItemHandleRect(t,h,ct);let m=null,f=-1/0,g=0,p=0,y=0,v=0,S=0,w=null,b=-1/0,D=0,T=0,A=0,k=0,R=0,x=0;for(;x<l.length;x++){const t=l[x],s=t.threshold||r,n=!(!e||!c||2===t.axis),h=!(!i||!_||1===t.axis),a=t.priority||0;if((!n||a<f)&&(!h||a<b))continue;const d=ft(t.element||t),E=n?yt(d):-1,C=h?vt(d):-1;if(!E&&!C)continue;const L=St(d,_t),X=nt(u,L);if(!(X<=0)){if(n&&a>=f&&E>0&&(a>f||X>p)){let t=0,e=0;const i=Tt(s,L.width),n=At(i,o,u.width,L.width);5===c?(t=L.right+n-u.right,t<=i&&gt(d)<E&&(e=5)):9===c&&(t=u.left-(L.left-n),t<=i&&gt(d)>0&&(e=9)),e&&(m=d,f=a,g=i,p=X,y=e,v=t,S=E)}if(h&&a>=b&&C>0&&(a>b||X>T)){let t=0,e=0;const i=Tt(s,L.height),n=At(i,o,u.height,L.height);6===_?(t=L.bottom+n-u.bottom,t<=i&&pt(d)<C&&(e=6)):10===_&&(t=u.top-(L.top-n),t<=i&&pt(d)>0&&(e=10)),e&&(w=d,b=a,D=i,T=X,A=e,k=t,R=C)}}}e&&(m&&y?this._requestItemScroll(t,1,m,y,g,v,S):this._cancelItemScroll(t,1)),i&&(w&&A?this._requestItemScroll(t,2,w,A,D,k,R):this._cancelItemScroll(t,2))}_updateScrollRequest(t){const e=t.item,{threshold:i,safeZone:n,smoothStop:r,handle:o,targets:h}=wt(e),a=s(h)?h(e):h,l=a&&a.length||0,d=this._getItemHandleRect(e,o,ct);let c=null,_=0;for(;_<l;_++){const e=a[_],s=ft(e.element||e);if(s!==t.element)continue;const r=!!(1&t.direction);if(r){if(2===e.axis)continue}else if(1===e.axis)continue;const o=r?yt(s):vt(s);if(o<=0)break;const h=St(s,_t);if(nt(d,h)<=0)break;const l=Tt("number"==typeof e.threshold?e.threshold:i,r?h.width:h.height),u=At(l,n,r?d.width:d.height,r?h.width:h.height);let m=0;if(m=9===t.direction?d.left-(h.left-u):5===t.direction?h.right+u-d.right:10===t.direction?d.top-(h.top-u):h.bottom+u-d.bottom,m>l)break;const f=r?gt(s):pt(s);if(c=4&t.direction?f>=o:f<=0,c)break;return t.maxValue=o,t.threshold=l,t.distance=m,t.isEnding=!1,!0}return!0===r&&t.speed>0?(null===c&&(c=t.hasReachedEnd()),t.isEnding=!c):t.isEnding=!1,t.isEnding}_updateRequests(){const t=this._items,e=this._requests[1],i=this._requests[2];let s=0;for(;s<t.length;s++){const n=t[s],r=this._requestOverlapCheck.get(n.id)||0;let o=r>0&&this._tickTime-r>this._overlapCheckInterval,h=!0;const a=e.get(n.id);a&&a.isActive&&(h=!this._updateScrollRequest(a),h&&(o=!0,this._cancelItemScroll(n,1)));let l=!0;const d=i.get(n.id);d&&d.isActive&&(l=!this._updateScrollRequest(d),l&&(o=!0,this._cancelItemScroll(n,2))),o&&(this._requestOverlapCheck.set(n.id,0),this._checkItemOverlap(n,h,l))}}_requestAction(t,e){const i=this._actions,s=1===e;let n=null,r=0;for(;r<i.length;r++){if(n=i[r],t.element===n.element){if(s?n.requestX:n.requestY)return void this._cancelItemScroll(t.item,e);break}n=null}n||(n=this._actionPool.pick()),n.element=t.element,n.addRequest(t),t.tick(this._tickDeltaTime),i.push(n)}_updateActions(){const t=this._items,e=this._requests,i=this._actions;let s=0;for(s=0;s<t.length;s++){const i=e[1].get(t[s].id),n=e[2].get(t[s].id);i&&this._requestAction(i,1),n&&this._requestAction(n,2)}for(s=0;s<i.length;s++)i[s].computeScrollValues()}_applyActions(){const t=this._actions;if(!t.length)return;let e=0;for(e=0;e<t.length;e++)t[e].scroll(),this._actionPool.release(t[e]);t.length=0;const i=this._items;for(e=0;e<i.length;e++)bt(i[e]);for(e=0;e<i.length;e++)Dt(i[e])}}Et.AXIS_X=1,Et.AXIS_Y=2,Et.LEFT=9,Et.RIGHT=5,Et.UP=10,Et.DOWN=6,Et.smoothSpeed=function(t,e,i){return function(s,n,r){let o=0;if(!r.isEnding)if(r.threshold>0){const e=r.threshold-Math.max(0,r.distance);o=t/r.threshold*e}else o=t;const h=r.speed;if(h===o)return o;let a=o;return h<o?(a=h+e*(r.deltaTime/1e3),Math.min(o,a)):(a=h-i*(r.deltaTime/1e3),Math.max(o,a))}},Et.pointerHandle=function(t){const e={left:0,top:0,width:0,height:0},i=t||1;return function(t,s,n,r,o,h,a){return e.left=h-.5*i,e.top=a-.5*i,e.width=i,e.height=i,e}};const Ct=new Map,Lt=new Map,Xt="swap",Yt="move",It="instant",Pt="layoutStart",Mt="layoutEnd",Ot="layoutAbort",Ht="remove",qt="hideStart",Gt="filter",Wt="sort",Nt="move",Vt="send",Bt="beforeSend",zt="receive",Ft="beforeReceive",jt="dragReleaseEnd",Qt="ontouchstart"in window,Ut=!!window.PointerEvent,Zt=window.navigator.userAgent.toLowerCase(),$t=Zt.indexOf("firefox")>-1,Jt=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),Kt=Zt.indexOf("android")>-1,te=/^(iPad|iPhone|iPod)/.test(window.navigator.platform)||/^Mac/.test(window.navigator.platform)&&window.navigator.maxTouchPoints>1,ee=100,ie=(()=>{let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t})(),se=["","webkit","moz","ms","o","Webkit","Moz","MS","O"],ne=new Map;function re(t,e){let i=ne.get(e);if(i)return i;const s=e[0].toUpperCase()+e.slice(1);let n=0;for(;n<se.length;){if(i=se[n]?se[n]+s:e,i in t)return ne.set(e,i),i;++n}return""}const oe={start:"touchstart",move:"touchmove",cancel:"touchcancel",end:"touchend"},he=Object.assign({},Qt?oe:Ut?{start:"pointerdown",move:"pointermove",cancel:"pointercancel",end:"pointerup"}:{start:"mousedown",move:"mousemove",cancel:"",end:"mouseup"}),ae="start",le="move",de="cancel",ce="end",_e="auto",ue="touchAction",me=re(document.documentElement.style,ue);function fe(t){t.preventDefault&&!1!==t.cancelable&&t.preventDefault()}function ge(t,e){return(t?1:0)|(ie&&e?2:0)}function pe(t){return ie?{capture:!!(1&t),passive:!!(2&t)}:!!(1&t)}function ye(t){return"pointerType"in t?t.pointerType:"touches"in t?"touch":"mouse"}class ve{constructor(t){this._emitter=new i.Emitter,this._listenerOptions=pe(t),this._draggers=new Set,this._onMove=this._onMove.bind(this),this._onCancel=this._onCancel.bind(this),this._onEnd=this._onEnd.bind(this)}hasDragger(t){return this._draggers.has(t)}addDragger(t){this._draggers.has(t)||(this._draggers.add(t),this._emitter.on(le,t.onMove),this._emitter.on(de,t.onCancel),this._emitter.on(ce,t.onEnd),1===this._draggers.size&&this._activate())}removeDragger(t){this._draggers.has(t)&&(this._draggers.delete(t),this._emitter.off(le,t.onMove),this._emitter.off(de,t.onCancel),this._emitter.off(ce,t.onEnd),0===this._draggers.size&&this._deactivate())}destroy(){this._draggers.size&&this._deactivate(),this._draggers.clear(),this._emitter.off()}_activate(){window.addEventListener(he.move,this._onMove,this._listenerOptions),window.addEventListener(he.end,this._onEnd,this._listenerOptions),he.cancel&&window.addEventListener(he.cancel,this._onCancel,this._listenerOptions)}_deactivate(){window.removeEventListener(he.move,this._onMove,this._listenerOptions),window.removeEventListener(he.end,this._onEnd,this._listenerOptions),he.cancel&&window.removeEventListener(he.cancel,this._onCancel,this._listenerOptions)}_onMove(t){this._emitter.emit(le,t)}_onCancel(t){this._emitter.emit(de,t)}_onEnd(t){this._emitter.emit(ce,t)}}const Se=[new ve(0),new ve(1)];ie&&Se.push(new ve(2),new ve(3));class we{constructor(t,e,s={}){const{capture:n=!0,passive:r=!0}=s;this.element=t,this._emitter=new i.Emitter,this._cssProps={},this._touchAction="",this._listenerType=ge(n,r),this._isActive=!1,this._pointerId=null,this._startTime=0,this._startX=0,this._startY=0,this._currentX=0,this._currentY=0,this.onStart=this.onStart.bind(this),this.onMove=this.onMove.bind(this),this.onCancel=this.onCancel.bind(this),this.onEnd=this.onEnd.bind(this),e&&this.setCssProps(e),this._touchAction||this.setTouchAction(_e),t.addEventListener("dragstart",fe,!1),t.addEventListener(he.start,this.onStart,pe(this._listenerType))}getTrackedTouch(t){return null===this._pointerId?null:function(t,e){if("pointerId"in t)return t.pointerId===e?t:null;if("changedTouches"in t){let i=0;for(;i<t.changedTouches.length;i++)if(t.changedTouches[i].identifier===e)return t.changedTouches[i];return null}return t}(t,this._pointerId)}onStart(t){if(!this.element)return;if(null!==this._pointerId)return;if(this._pointerId=function(t){return"pointerId"in t?t.pointerId:"changedTouches"in t?t.changedTouches[0]?t.changedTouches[0].identifier:null:1}(t),null===this._pointerId)return;const e=this.getTrackedTouch(t);if(e&&(this._startX=this._currentX=e.clientX,this._startY=this._currentY=e.clientY,this._startTime=Date.now(),this._isActive=!0,this._emit(ae,t),this._isActive)){const t=Se[this._listenerType];t&&t.addDragger(this)}}onMove(t){const e=this.getTrackedTouch(t);e&&(this._currentX=e.clientX,this._currentY=e.clientY,this._emit(le,t))}onCancel(t){this.getTrackedTouch(t)&&(this._emit(de,t),this.reset())}onEnd(t){this.getTrackedTouch(t)&&(this._emit(ce,t),this.reset())}isActive(){return this._isActive}setTouchAction(t){this.element&&t&&(this._touchAction=t,me&&(this._cssProps[me]="",this.element.style[me]=t),Qt&&(this.element.removeEventListener(oe.start,fe,!0),t!==_e&&(this.element.style[me]!==t||$t&&Kt)&&this.element.addEventListener(oe.start,fe,!0)))}setCssProps(t){if(!this.element)return;const e=this._cssProps,{element:i}=this;let s,n="";for(n in e)i.style[n]=e[n],delete e[n];for(s in t){const n=t[s]||"";if(!n)continue;if(s===ue){this.setTouchAction(n);continue}const r=re(i.style,s);r&&(e[r]="",i.style[r]=n)}}setListenerOptions(t){if(!this.element)return;const{capture:e=!0,passive:i=!0}=t,s=this._listenerType,n=ge(e,i);if(s!==n){this.element.removeEventListener(he.start,this.onStart,pe(this._listenerType));const t=Se[this._listenerType],e=!!t&&t.hasDragger(this);if(e&&t.removeDragger(this),this._listenerType=n,this.element.addEventListener(he.start,this.onStart,pe(this._listenerType)),e){const t=Se[this._listenerType];t&&t.addDragger(this)}}}getDeltaX(){return this._currentX-this._startX}getDeltaY(){return this._currentY-this._startY}getDistance(){const t=this.getDeltaX(),e=this.getDeltaY();return Math.sqrt(t*t+e*e)}getDeltaTime(){return this._startTime?Date.now()-this._startTime:0}on(t,e){this._emitter.on(t,e)}off(t,e){this._emitter.off(t,e)}reset(){this._pointerId=null,this._startTime=0,this._startX=0,this._startY=0,this._currentX=0,this._currentY=0,this._isActive=!1;const t=Se[this._listenerType];t&&t.removeDragger(this)}destroy(){const{element:t}=this;if(!t)return;let e;for(e in this.reset(),this._emitter.off(),t.removeEventListener(he.start,this.onStart,pe(this._listenerType)),t.removeEventListener("dragstart",fe,!1),t.removeEventListener(oe.start,fe,!0),this._cssProps)t.style[e]="";this._cssProps={},this.element=null}_createEvent(t,e){const i=this.getTrackedTouch(e);return i&&null!==this._pointerId?{type:t,srcEvent:e,distance:this.getDistance(),deltaX:this.getDeltaX(),deltaY:this.getDeltaY(),deltaTime:t===ae?0:this.getDeltaTime(),isFirst:t===ae,isFinal:t===ce||t===de,pointerType:ye(e),identifier:this._pointerId,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,target:i.target}:null}_emit(t,e){this._emitter.emit(t,this._createEvent(t,e))}}function be(t,e){e&&t.classList.add(e)}function De(t,e,i=-1){i<0&&(i=t.length-i+1),Array.isArray(e)?t.splice(i,0,...e):t.splice(i,0,e)}function Te(t,e,i=0){const s=Math.max(0,t.length-1+i);return e>s?s:e<0?Math.max(s+e+1,0):e}function Ae(t,e,i){if(t.length<2)return;const s=Te(t,e),n=Te(t,i);s!==n&&t.splice(n,0,t.splice(s,1)[0])}function ke(t,e,i){if(t.length<2)return;const s=Te(t,e),n=Te(t,i);if(s!==n){const e=t[s];t[s]=t[n],t[n]=e}}const Re=re(document.documentElement.style,"transform")||"transform",xe=/([A-Z])/g,Ee=/^(webkit-|moz-|ms-|o-)/,Ce=/^(-m-s-)/;function Le(t){let e=t.replace(xe,"-$1").toLowerCase();return e=e.replace(Ee,"-$1"),e=e.replace(Ce,"-ms-"),e}const Xe=Le(Re);function Ye(t){if("static"!==lt(t,"position"))return!0;const e=lt(t,"display");if("inline"===e||"none"===e)return!1;const i=lt(t,Xe);if(i&&"none"!==i)return!0;const s=lt(t,"perspective");if(s&&"none"!==s)return!0;const n=lt(t,"content-visibility");if(n&&("auto"===n||"hidden"===n))return!0;const r=lt(t,"contain");if(r&&("strict"===r||"content"===r||r.indexOf("paint")>-1||r.indexOf("layout")>-1))return!0;if(!Jt){const e=lt(t,"filter");if(e&&"none"!==e)return!0;const i=lt(t,"will-change");if(i&&(i.indexOf("transform")>-1||i.indexOf("perspective")>-1))return!0}return!1}function Ie(t){let e=t||document;for(;e&&e!==document&&!Ye(t);)e=e.parentElement||document;return e}const Pe={left:0,top:0},Me={left:0,top:0},Oe={left:0,top:0};function He(t,e={left:0,top:0}){if(e.left=0,e.top=0,t===document)return e;if(e.left=window.pageXOffset||0,e.top=window.pageYOffset||0,"self"in t&&t.self===window.self)return e;const{left:i,top:s}=t.getBoundingClientRect();return e.left+=i,e.top+=s,e.left+=dt(t,"border-left-width"),e.top+=dt(t,"border-top-width"),e}function qe(t,e,i=!1){return Oe.left=0,Oe.top=0,t===e||i&&(t=Ie(t))===(e=Ie(e))||(He(t,Pe),He(e,Me),Oe.left=Me.left-Pe.left,Oe.top=Me.top-Pe.top),Oe}function Ge(t,e){e&&t.classList.remove(e)}const We=!ie||{capture:!0,passive:!0},Ne={left:0,top:0,width:0,height:0},Ve={left:0,top:0,width:0,height:0};class Be{constructor(t){const e=t.element,i=t.getGrid(),{settings:s}=i;this.item=t,this._originGridId=i.id,this._isMigrated=!1,this._isActive=!1,this._isStarted=!1,this._startPredicateState=0,this._startPredicateData=null,this._isSortNeeded=!1,this._sortTimer=void 0,this._blockedSortIndex=null,this._sortX1=0,this._sortX2=0,this._sortY1=0,this._sortY2=0,this._container=null,this._containingBlock=null,this._dragStartEvent=null,this._dragEndEvent=null,this._dragMoveEvent=null,this._dragPrevMoveEvent=null,this._scrollEvent=null,this._translateX=0,this._translateY=0,this._clientX=0,this._clientY=0,this._scrollDiffX=0,this._scrollDiffY=0,this._moveDiffX=0,this._moveDiffY=0,this._containerDiffX=0,this._containerDiffY=0,this._preStartCheck=this._preStartCheck.bind(this),this._preEndCheck=this._preEndCheck.bind(this),this._onScroll=this._onScroll.bind(this),this._prepareStart=this._prepareStart.bind(this),this._applyStart=this._applyStart.bind(this),this._prepareMove=this._prepareMove.bind(this),this._applyMove=this._applyMove.bind(this),this._prepareScroll=this._prepareScroll.bind(this),this._applyScroll=this._applyScroll.bind(this),this._handleSort=this._handleSort.bind(this),this._handleSortDelayed=this._handleSortDelayed.bind(this),this.dragger=new we("string"==typeof s.dragHandle&&e.querySelector(s.dragHandle)||e,s.dragCssProps,s.dragEventListenerOptions),this.dragger.on("start",this._preStartCheck),this.dragger.on("move",this._preStartCheck),this.dragger.on("cancel",this._preEndCheck),this.dragger.on("end",this._preEndCheck)}isActive(){return this._isActive}getOriginGrid(){return Ct.get(this._originGridId)||null}stop(){if(!this.item||!this.isActive())return;if(this._isMigrated)return void this._finishMigration();const{item:t}=this;if(Be.autoScroll.removeItem(t),G(t.id),N(t.id),B(t.id),this._cancelSort(),this._isStarted){const e=t.element,i=t.getGrid(),{itemDraggingClass:s}=i.settings;this._unbindScrollHandler(),e.parentNode!==i.element&&(i.element.appendChild(e),t._setTranslate(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY),t._containerDiffX=this._containerDiffX=0,t._containerDiffY=this._containerDiffY=0,s&&e.clientWidth),Ge(e,s)}this._reset()}sort(t=!1){this.item&&this.isActive()&&this.item.isActive()&&this._dragMoveEvent&&(t?this._handleSort():z(this.item.id,this._handleSort))}destroy(){this.item&&(this._isMigrated=!1,this.stop(),this.dragger.destroy(),this.item=null)}_startPredicate(t,e){const{dragStartPredicate:i}=t.getGrid().settings;return s(i)?i(t,e):Be.defaultStartPredicate(t,e)}_reset(){this._isActive=!1,this._isStarted=!1,this._container=null,this._containingBlock=null,this._dragStartEvent=null,this._dragEndEvent=null,this._dragMoveEvent=null,this._dragPrevMoveEvent=null,this._scrollEvent=null,this._translateX=0,this._translateY=0,this._clientX=0,this._clientY=0,this._scrollDiffX=0,this._scrollDiffY=0,this._moveDiffX=0,this._moveDiffY=0,this._containerDiffX=0,this._containerDiffY=0}_bindScrollHandler(){window.addEventListener("scroll",this._onScroll,We)}_unbindScrollHandler(){window.removeEventListener("scroll",this._onScroll,We)}_resetHeuristics(t,e){this._blockedSortIndex=null,this._sortX1=this._sortX2=t,this._sortY1=this._sortY2=e}_checkHeuristics(t,e){if(!this.item)return!1;const{settings:i}=this.item.getGrid(),{minDragDistance:s,minBounceBackAngle:n}=i.dragSortHeuristics;if(s<=0)return this._blockedSortIndex=null,!0;const r=t-this._sortX2,o=e-this._sortY2,h=s>3&&n>0;if(h||(this._blockedSortIndex=null),Math.abs(r)>s||Math.abs(o)>s){if(h){const t=Math.atan2(r,o),e=Math.atan2(this._sortX2-this._sortX1,this._sortY2-this._sortY1),i=Math.atan2(Math.sin(t-e),Math.cos(t-e));Math.abs(i)>n&&(this._blockedSortIndex=null)}return this._sortX1=this._sortX2,this._sortY1=this._sortY2,this._sortX2=t,this._sortY2=e,!0}return!1}_resetDefaultStartPredicate(){const{_startPredicateData:t}=this;t&&(t.delayTimer&&(t.delayTimer=void window.clearTimeout(t.delayTimer)),this._startPredicateData=null)}_handleSort(){if(!this.item||!this.isActive())return;const{item:t}=this,{dragSort:e,dragSortHeuristics:i,dragAutoScroll:s}=t.getGrid().settings;if(!e||!s.sortDuringScroll&&Be.autoScroll.isItemScrolling(t))return this._sortX1=this._sortX2=this._translateX-t._containerDiffX,this._sortY1=this._sortY2=this._translateY-t._containerDiffY,this._isSortNeeded=!0,void(void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)));const n=this._checkHeuristics(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY);if(!this._isSortNeeded&&!n)return;const r=i.sortInterval;r<=0||this._isSortNeeded?(this._isSortNeeded=!1,void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)),this._checkOverlap()):void 0===this._sortTimer&&(this._sortTimer=window.setTimeout(this._handleSortDelayed,r))}_handleSortDelayed(){this.item&&(this._isSortNeeded=!0,this._sortTimer=void 0,z(this.item.id,this._handleSort))}_cancelSort(){this.item&&(this._isSortNeeded=!1,void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)),F(this.item.id))}_finishSort(){if(!this.item)return;const{dragSort:t}=this.item.getGrid().settings,e=t&&(this._isSortNeeded||void 0!==this._sortTimer);this._cancelSort(),e&&this._checkOverlap(),t&&this._checkOverlap(!0)}_checkOverlap(t=!1){if(!this.item||!this.isActive())return;const{item:e}=this,i=e.element,n=e.getGrid(),{settings:r}=n;let o=null;if(s(r.dragSortPredicate)?o=r.dragSortPredicate(e,t?this._dragEndEvent:this._dragMoveEvent):t||(o=Be.defaultSortPredicate(e,r.dragSortPredicate)),!o||"number"!=typeof o.index)return;const h=o.action===Xt?Xt:Yt,a=o.grid||n,l=n!==a,d=n.items.indexOf(e),c=Te(a.items,o.index,l&&h===Yt?1:0);if(l||c!==this._blockedSortIndex)if(l){this._blockedSortIndex=null;const t=a.items[c],s=a.settings;if(n._hasListeners(Bt)&&n._emit(Bt,{item:e,fromGrid:n,fromIndex:d,toGrid:a,toIndex:c}),a._hasListeners(Ft)&&a._emit(Ft,{item:e,fromGrid:n,fromIndex:d,toGrid:a,toIndex:c}),!this.isActive()||n.isDestroyed()||a.isDestroyed())return;e._gridId=a.id,this._isMigrated=e._gridId!==this._originGridId,n.items.splice(d,1),De(a.items,e,c),e._sortData=null;const o=this._container,l=this._containingBlock,_=s.dragContainer||a.element,u=Ie(_);let m=qe(u,Ie(a.element));e._containerDiffX=this._containerDiffX=m.left,e._containerDiffY=this._containerDiffY=m.top,_!==o&&(m=qe(l,u),this._container=_,this._containingBlock=u,this._translateX-=m.left,this._translateY-=m.top,_.appendChild(i),e._setTranslate(this._translateX,this._translateY)),r.itemClass!==s.itemClass&&(Ge(i,r.itemClass),be(i,s.itemClass)),r.itemDraggingClass!==s.itemDraggingClass&&(Ge(i,r.itemDraggingClass),be(i,s.itemDraggingClass)),e.isActive()?(r.itemVisibleClass!==s.itemVisibleClass&&(Ge(i,r.itemVisibleClass),be(i,s.itemVisibleClass)),e._visibility.setStyles(s.visibleStyles)):(r.itemHiddenClass!==s.itemHiddenClass&&(Ge(i,r.itemHiddenClass),be(i,s.itemHiddenClass)),e._visibility.setStyles(s.hiddenStyles)),e._dragPlaceholder.updateClassName(s.itemPlaceholderClass),e._updateDimensions(),n._hasListeners(Vt)&&n._emit(Vt,{item:e,fromGrid:n,fromIndex:d,toGrid:a,toIndex:c}),a._hasListeners(zt)&&a._emit(zt,{item:e,fromGrid:n,fromIndex:d,toGrid:a,toIndex:c}),h===Xt&&t&&t.isActive()&&a.items.indexOf(t)>-1&&a.send(t,n,d,{appendTo:o||document.body,layoutSender:!1,layoutReceiver:!1}),n.layout(),a.layout()}else d!==c&&(this._blockedSortIndex=d,(h===Xt?ke:Ae)(n.items,d,c),n._hasListeners(Nt)&&n._emit(Nt,{item:e,fromIndex:d,toIndex:c,action:h}),n.layout())}_finishMigration(){if(!this.item)return;const{item:t}=this,{dragEnabled:e}=t.getGrid().settings;this.destroy(),t._drag=e?new Be(t):null,t._dragRelease.start()}_preStartCheck(t){if(0===this._startPredicateState&&(this._startPredicateState=1),1===this._startPredicateState){const e=this._startPredicate(this.item,t);!0===e?(this._startPredicateState=2,this._onStart(t)):!1===e&&(this._startPredicateState=0,this.dragger.reset())}else 2===this._startPredicateState&&this.isActive()&&this._onMove(t)}_preEndCheck(t){const e=2===this._startPredicateState;this._startPredicate(this.item,t),this._resetDefaultStartPredicate(),this._startPredicateState=0,e&&this.isActive()&&(this._isStarted?this._onEnd(t):this.stop())}_onStart(t){this.item&&this.item.isActive()&&(this._isActive=!0,this._dragStartEvent=t,Be.autoScroll.addItem(this.item,this._translateX,this._translateY),q(this.item.id,this._prepareStart,this._applyStart))}_prepareStart(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.element,i=t.getGrid(),s=i.settings.dragContainer||i.element,n=Ie(s),r=t._getTranslate(),o=e.getBoundingClientRect();if(this._container=s,this._containingBlock=n,this._clientX=o.left,this._clientY=o.top,this._translateX=r.x,this._translateY=r.y,this._scrollDiffX=this._scrollDiffY=0,this._moveDiffX=this._moveDiffY=0,this._containerDiffX=this._containerDiffY=0,s!==i.element){const{left:t,top:e}=qe(n,i.element);this._containerDiffX=t,this._containerDiffY=e}this._resetHeuristics(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY)}_applyStart(){if(!this.item||!this.isActive())return;const{item:t}=this;if(!t.isActive())return;t.isPositioning()&&t._layout.stop(!0,this._translateX,this._translateY);const e=t._migrate;e.isActive()&&(this._translateX-=t._containerDiffX,this._translateY-=t._containerDiffY,e.stop(!0,this._translateX,this._translateY));const i=t._dragRelease;t.isReleasing()&&i.reset();const s=t.getGrid(),n=t.element;s.settings.dragPlaceholder.enabled&&t._dragPlaceholder.create(),this._isStarted=!0,this._dragStartEvent&&s._emit("dragInit",t,this._dragStartEvent),n.parentNode!==this._container&&(this._translateX+=this._containerDiffX,this._translateY+=this._containerDiffY,this._container.appendChild(n),t._setTranslate(this._translateX,this._translateY)),t._containerDiffX=this._containerDiffX,t._containerDiffY=this._containerDiffY,be(n,s.settings.itemDraggingClass),this._bindScrollHandler(),this._dragStartEvent&&s._emit("dragStart",t,this._dragStartEvent)}_onMove(t){if(!this.item)return;if(!this.item.isActive())return void this.stop();const e=this.item.id;this._dragMoveEvent=t,W(e,this._prepareMove,this._applyMove),z(e,this._handleSort)}_prepareMove(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{dragAxis:t}=this.item.getGrid().settings,e=this._dragMoveEvent,i=this._dragPrevMoveEvent||this._dragStartEvent||e;if("y"!==t){const t=e.clientX-i.clientX;this._translateX=this._translateX-this._moveDiffX+t,this._clientX=this._clientX-this._moveDiffX+t,this._moveDiffX=t}if("x"!==t){const t=e.clientY-i.clientY;this._translateY=this._translateY-this._moveDiffY+t,this._clientY=this._clientY-this._moveDiffY+t,this._moveDiffY=t}this._dragPrevMoveEvent=e}_applyMove(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();this._moveDiffX=this._moveDiffY=0,t._setTranslate(this._translateX,this._translateY),this._dragMoveEvent&&e._emit("dragMove",t,this._dragMoveEvent),Be.autoScroll.updateItem(t,this._translateX,this._translateY)}_onScroll(t){if(!this.item)return;if(!this.item.isActive())return void this.stop();const e=this.item.id;this._scrollEvent=t,V(e,this._prepareScroll,this._applyScroll),z(e,this._handleSort)}_prepareScroll(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();if(this._container!==e.element){const{left:i,top:s}=qe(this._containingBlock,e.element);t._containerDiffX=this._containerDiffX=i,t._containerDiffY=this._containerDiffY=s}const{dragAxis:i}=e.settings,{left:s,top:n}=t.element.getBoundingClientRect();if("y"!==i){const t=this._clientX-this._moveDiffX-this._scrollDiffX-s;this._translateX=this._translateX-this._scrollDiffX+t,this._scrollDiffX=t}if("x"!==i){const t=this._clientY-this._moveDiffY-this._scrollDiffY-n;this._translateY=this._translateY-this._scrollDiffY+t,this._scrollDiffY=t}}_applyScroll(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();this._scrollDiffX=this._scrollDiffY=0,t._setTranslate(this._translateX,this._translateY),this._scrollEvent&&e._emit("dragScroll",t,this._scrollEvent)}_onEnd(t){if(!this.item)return;const{item:e}=this;if(!e.isActive())return void this.stop();const i=e.getGrid();this._dragEndEvent=t,G(e.id),N(e.id),B(e.id),this._finishSort(),this._unbindScrollHandler(),this._reset(),Ge(e.element,i.settings.itemDraggingClass),Be.autoScroll.removeItem(e),i._emit("dragEnd",e,t),this._isMigrated?this._finishMigration():e._dragRelease.start()}}function ze(t,e,i=!1){return i?"translate3d("+t+"px, "+e+"px, 0px)":"translateX("+t+"px) translateY("+e+"px)"}Be.autoScroll=new Et,Be.defaultStartPredicate=function(t,e,i){if(e.isFinal)return;const s=t._drag;if(e.isFirst&&e.srcEvent.button)return s._resetDefaultStartPredicate(),!1;if(!te&&e.isFirst&&!0===e.srcEvent.isTrusted&&!1===e.srcEvent.defaultPrevented&&!1===e.srcEvent.cancelable)return s._resetDefaultStartPredicate(),!1;let n=s._startPredicateData;if(!n){n=s._startPredicateData={distance:0,delay:0};const{dragStartPredicate:e}=t.getGrid().settings,r=i||e;"object"==typeof r&&(n.distance=Math.max(r.distance||0,0),n.delay=Math.max(r.delay||0,0))}return n.delay?(n.event=e,void(n.delayTimer||(n.delayTimer=window.setTimeout((function(){s._startPredicateData===n&&(s.item?n&&(n.delay=0,1===s._startPredicateState&&n.event&&n.event.distance>=n.distance&&(s._resetDefaultStartPredicate(),s._startPredicateState=2,s._onStart(n.event))):s._resetDefaultStartPredicate())}),n.delay)))):!(e.distance<n.distance)||void 0},Be.defaultSortPredicate=function(t,e){const i=t._drag,n=e&&e.action===Xt?Xt:Yt,r=e&&e.migrateAction===Xt?Xt:Yt,o=Math.min(Math.max(e&&"number"==typeof e.threshold?e.threshold:50,1),100),h=function(t,e){const i=t.getGrid(),{dragSort:n}=i.settings,r=!0===n?[i]:s(n)?n(t):void 0;let o=null;if(!r||!Array.isArray(r)||!r.length)return o;const h=Ne,a=Ve;let l,d,c=-1,_=0,u=null,m=0,f=0,g=0,p=0,y=0;const v=t._drag;for(h.width=t.width,h.height=t.height,h.left=v._clientX,h.top=v._clientY;y<r.length;y++)if(l=r[y],!l.isDestroyed()){for(l._updateBoundingRect(),m=Math.max(0,l._rect.left),f=Math.max(0,l._rect.top),g=Math.min(window.innerWidth,l._rect.right),p=Math.min(window.innerHeight,l._rect.bottom),u=l.element.parentNode;u&&u!==document&&u!==document.documentElement&&u!==document.body;)if(u.getRootNode&&u instanceof DocumentFragment)u=u.getRootNode().host;else{if("visible"!==lt(u,"overflow")&&(d=u.getBoundingClientRect(),m=Math.max(m,d.left),f=Math.max(f,d.top),g=Math.min(g,d.right),p=Math.min(p,d.bottom)),"fixed"===lt(u,"position"))break;u=u.parentNode}m>=g||f>=p||(a.left=m,a.top=f,a.width=g-m,a.height=p-f,_=nt(h,a),_>e&&_>c&&(c=_,o=l))}return o}(t,o);if(!h)return null;const a=t.getGrid()!==h,l=Ne,d=Ve;l.width=t.width,l.height=t.height,a?(h._updateBorders(!0,!1,!0,!1),l.left=i._clientX-(h._rect.left+h._borderLeft),l.top=i._clientY-(h._rect.top+h._borderTop)):(l.left=i._translateX-t._containerDiffX+t.marginLeft,l.top=i._translateY-t._containerDiffY+t.marginTop);let c=0,_=-1,u=!1;for(let e=0;e<h.items.length;e++){const i=h.items[e];if(!i.isActive()||i===t)continue;u=!0,d.width=i.width,d.height=i.height,d.left=i.left+i.marginLeft,d.top=i.top+i.marginTop;const s=nt(l,d);s>c&&(_=e,c=s)}return a&&c<o&&(_=u?_:0,c=o),c>=o?{grid:h,index:_,action:a?r:n}:null};const Fe={x:0,y:0},je=/^matrix3d/,Qe=/([^,]*,){4}/,Ue=/([^,]*,){12}/,Ze=/[^,]*,/;function $e(t){Fe.x=0,Fe.y=0;const e=lt(t,Xe);if(!e||"none"===e)return Fe;const i=je.test(e),s=e.replace(i?Ue:Qe,""),n=s.replace(Ze,"");return Fe.x=parseFloat(s)||0,Fe.y=parseFloat(n)||0,Fe}const Je={},Ke={};class ti{constructor(t){this.item=t,this.element=null,this.animator=new h,this.left=0,this.top=0,this._className="",this._didMigrate=!1,this._resetAfterLayout=!1,this._transX=0,this._transY=0,this._nextTransX=0,this._nextTransY=0,this._setupAnimation=this._setupAnimation.bind(this),this._startAnimation=this._startAnimation.bind(this),this._updateDimensions=this._updateDimensions.bind(this),this._onLayoutStart=this._onLayoutStart.bind(this),this._onLayoutEnd=this._onLayoutEnd.bind(this),this._onReleaseEnd=this._onReleaseEnd.bind(this),this._onMigrate=this._onMigrate.bind(this),this._onHide=this._onHide.bind(this)}create(){if(!this.item)return;if(this.element)return void(this._resetAfterLayout=!1);const{item:t}=this,e=t.getGrid(),{settings:i}=e;let r;this.left=t.left,this.top=t.top,r=s(i.dragPlaceholder.createElement)?i.dragPlaceholder.createElement(t):document.createElement("div"),this.element=r,this.animator.element=r,this._className=i.itemPlaceholderClass||"",this._className&&be(r,this._className),n(r,{position:"absolute",left:"0px",top:"0px",width:t.width+"px",height:t.height+"px"}),r.style[Re]=ze(t.left+t.marginLeft,t.top+t.marginTop,i.translate3d),e.on(Pt,this._onLayoutStart),e.on(jt,this._onReleaseEnd),e.on(Bt,this._onMigrate),e.on(qt,this._onHide),s(i.dragPlaceholder.onCreate)&&i.dragPlaceholder.onCreate(t,r),e.element.appendChild(r)}reset(){var t;if(!this.item||!this.element)return;const{item:e,element:i,animator:n}=this,r=e.getGrid();this._resetAfterLayout=!1,Z(e.id),J(e.id),n.stop(),n.element=null,r.off(jt,this._onReleaseEnd),r.off(Pt,this._onLayoutStart),r.off(Bt,this._onMigrate),r.off(qt,this._onHide),this._className&&(Ge(i,this._className),this._className=""),null===(t=i.parentNode)||void 0===t||t.removeChild(i),this.element=null;const{onRemove:o}=r.settings.dragPlaceholder;s(o)&&o(e,i)}isActive(){return!!this.element}updateDimensions(){this.item&&this.isActive()&&$(this.item.id,this._updateDimensions)}updateClassName(t){this.element&&(Ge(this.element,this._className),this._className=t,be(this.element,t))}destroy(){this.reset(),this.animator&&this.animator.destroy(),this.item=null}_updateDimensions(){this.item&&this.element&&n(this.element,{width:this.item.width+"px",height:this.item.height+"px"})}_onLayoutStart(t,e){if(!this.item||!this.element)return;const{item:i}=this;if(-1===t.indexOf(i))return void this.reset();const s=i.left,n=i.top,r=this.left,o=this.top;if(this.left=s,this.top=n,!e&&!this._didMigrate&&r===s&&o===n)return;const h=s+i.marginLeft,a=n+i.marginTop,l=i.getGrid();if(!(!e&&l.settings.layoutDuration>0)||this._didMigrate)return Z(i.id),this.element.style[Re]=ze(h,a,l.settings.translate3d),this.animator.stop(),void(this._didMigrate&&(l.element.appendChild(this.element),this._didMigrate=!1));this.animator.animation&&(this.animator.animation.onfinish=null),this._nextTransX=h,this._nextTransY=a,U(i.id,this._setupAnimation,this._startAnimation)}_setupAnimation(){if(!this.element)return;const{x:t,y:e}=$e(this.element);this._transX=t,this._transY=e}_startAnimation(){if(!this.item||!this.element)return;const{animator:t}=this,e=this._transX,i=this._transY,s=this._nextTransX,n=this._nextTransY,{layoutDuration:r,layoutEasing:o,translate3d:h}=this.item.getGrid().settings;e!==s||i!==n?(Je[Re]=ze(e,i,h),Ke[Re]=ze(s,n,h),t.start(Je,Ke,{duration:r,easing:o,onFinish:this._onLayoutEnd})):t.isAnimating()&&(this.element.style[Re]=ze(s,n,h),t.stop())}_onLayoutEnd(){this._resetAfterLayout&&this.reset()}_onReleaseEnd(t){if(this.item&&this.item.id===t.id){if(!this.animator.isAnimating())return void this.reset();this._resetAfterLayout=!0}}_onMigrate(t){if(!this.item||this.item!==t.item)return;const e=this.item.getGrid();e.off(jt,this._onReleaseEnd),e.off(Pt,this._onLayoutStart),e.off(Bt,this._onMigrate),e.off(qt,this._onHide);const i=t.toGrid;i.on(jt,this._onReleaseEnd),i.on(Pt,this._onLayoutStart),i.on(Bt,this._onMigrate),i.on(qt,this._onHide),this._didMigrate=!0}_onHide(t){this.item&&t.indexOf(this.item)>-1&&this.reset()}}const ei=!ie||{capture:!0,passive:!0};class ii{constructor(t){this.item=t,this._isActive=!1,this._isPositioning=!1,this._onScroll=this._onScroll.bind(this)}isActive(){return this._isActive}isPositioning(){return this._isPositioning}start(){if(!this.item||this.isActive())return;const{item:t}=this,e=t.getGrid(),{settings:i}=e;this._isActive=!0,be(t.element,i.itemReleasingClass),i.dragRelease.useDragContainer?t.element.parentNode!==e.element&&window.addEventListener("scroll",this._onScroll,ei):this._placeToGrid(),e._emit("dragReleaseStart",t),e._nextLayoutData||t._layout.start(!1)}stop(t=!1,e,i){if(!this.item||!this.isActive())return;const{item:s}=this;t||void 0!==e&&void 0!==i||(e=s.left,i=s.top);const n=this._placeToGrid(e,i);if(this.reset(n),!t){s.getGrid()._emit(jt,s)}}reset(t=!1){if(!this.item)return;const{item:e}=this,{itemReleasingClass:i}=e.getGrid().settings;this._isActive=!1,this._isPositioning=!1,Q(e.id),window.removeEventListener("scroll",this._onScroll,ei),i&&(t&&e.element.clientWidth,Ge(e.element,i))}destroy(){this.item&&(this.stop(!0),this.item=null)}_placeToGrid(t,e){if(!this.item)return!1;const{item:i}=this,s=i.getGrid().element;if(i.element.parentNode!==s){if(void 0===t||void 0===e){const{x:s,y:n}=i._getTranslate();t=s-i._containerDiffX,e=n-i._containerDiffY}return s.appendChild(i.element),i._setTranslate(t,e),i._containerDiffX=0,i._containerDiffY=0,!0}return!1}_onScroll(){if(!this.item||!this.isActive())return;const{item:t}=this;let e=0,i=0;j(t.id,(()=>{if(!this.isActive())return;const s=t.element.parentNode;if(s){const n=t.getGrid().element,{left:r,top:o}=qe(s,n,!0);e=r,i=o}}),(()=>{this.isActive()&&(Math.abs(e-t._containerDiffX)>.1||Math.abs(i-t._containerDiffY)>.1)&&(t._containerDiffX=e,t._containerDiffY=i,t._dragPlaceholder.reset(),t._layout.stop(!0,t.left,t.top),this.stop(!1,t.left,t.top))}))}}const si={},ni={},ri={duration:0,easing:"",onFinish:void 0};class oi{constructor(t){this.item=t,this.animator=new h(t.element),this._skipNextAnimation=!1,this._isActive=!1,this._isInterrupted=!1,this._easing="",this._duration=0,this._tX=0,this._tY=0,this._queue="layout-"+t.id,this._setupAnimation=this._setupAnimation.bind(this),this._startAnimation=this._startAnimation.bind(this),this._finish=this._finish.bind(this);const{style:e}=t.element;e.left="0px",e.top="0px",this.item._setTranslate(0,0)}isActive(){return this._isActive}start(t,e){if(!this.item)return;const{item:i,animator:n}=this,r=i.getGrid(),o=i._dragRelease,{settings:h}=r,a=this.isActive(),l=o.isActive()&&!o.isPositioning(),d=l?h.dragRelease.duration:h.layoutDuration,c=l?h.dragRelease.easing:h.layoutEasing,_=!t&&!this._skipNextAnimation&&d>0;if(a&&(M(i.id),i._emitter.emit(this._queue,!0,i)),l&&(o._isPositioning=!0),e&&s(e)&&i._emitter.once(this._queue,e),this._skipNextAnimation=!1,!_)return i._setTranslate(i.left+i._containerDiffX,i.top+i._containerDiffY),n.stop(),void this._finish();n.animation&&(n.animation.onfinish=null),r._layoutNeedsDimensionsRefresh=!0,this._isActive=!0,this._easing=c,this._duration=d,this._isInterrupted=a,P(i.id,this._setupAnimation,this._startAnimation)}stop(t,e,i){if(!this.item||!this.isActive())return;const{item:s}=this;if(M(s.id),this.animator.isAnimating()){if(void 0===e||void 0===i){const{x:t,y:e}=$e(s.element);s._setTranslate(t,e)}else s._setTranslate(e,i);this.animator.stop()}const{itemPositioningClass:n}=s.getGrid().settings;Ge(s.element,n),this._isActive=!1,t&&s._emitter.emit(this._queue,!0,s)}destroy(){if(!this.item)return;this.stop(!0,0,0),this.item._emitter.off(this._queue),this.animator.destroy();const{style:t}=this.item.element;t[Re]="",t.left="",t.top="",this.item=null}_finish(){if(!this.item)return;const{item:t}=this;if(t._translateX=t.left+t._containerDiffX,t._translateY=t.top+t._containerDiffY,this.isActive()){this._isActive=!1;const{itemPositioningClass:e}=t.getGrid().settings;Ge(t.element,e)}t._dragRelease.isActive()&&t._dragRelease.stop(),t._migrate.isActive()&&t._migrate.stop(),t._emitter.emit(this._queue,!1,t)}_setupAnimation(){if(!this.item||!this.isActive())return;const{item:t}=this,{x:e,y:i}=t._getTranslate();this._tX=e,this._tY=i;const s=t.getGrid();s.settings._animationWindowing&&s._layoutNeedsDimensionsRefresh&&(s._layoutNeedsDimensionsRefresh=!1,s._updateBoundingRect(),s._updateBorders(!0,!1,!0,!1))}_startAnimation(){if(!this.item||!this.isActive())return;const{item:t}=this,{settings:e}=t.getGrid(),i=this._duration<=0,s=t.left+t._containerDiffX,n=t.top+t._containerDiffY,r=Math.abs(t.left-(this._tX-t._containerDiffX)),o=Math.abs(t.top-(this._tY-t._containerDiffY));if(i||r<2&&o<2||e._animationWindowing&&!t._isInViewport(this._tX,this._tY,ee)&&!t._isInViewport(s,n,ee))return(this._isInterrupted||r>.1||o>.1)&&t._setTranslate(s,n),this.animator.stop(),void this._finish();this._isInterrupted||be(t.element,e.itemPositioningClass),si[Re]=ze(this._tX,this._tY,e.translate3d),ni[Re]=ze(s,n,e.translate3d),ri.duration=this._duration,ri.easing=this._easing,ri.onFinish=this._finish,t._translateX=t._translateY=void 0,this.animator.start(si,ni,ri),ri.onFinish=void 0}}class hi{constructor(t){this.item=t,this.container=null,this._isActive=!1}isActive(){return this._isActive}start(t,e,i){if(!this.item)return;const s=this.item,n=s.getGrid(),r=s.element,o=s.isActive(),h=s.isVisible(),a=n.settings,l=n.items.indexOf(s),d=t.element,c=t.settings,_=t.items,u=i||document.body;let m=0;if("number"==typeof e)m=Te(_,e,1);else{const i=t.getItem(e);if(!i)return;m=_.indexOf(i)}if(s._drag&&s._drag.stop(),this.isActive()||s.isPositioning()||s.isReleasing()){let{x:t,y:e}=s._getTranslate();s.isPositioning()&&s._layout.stop(!0,t,e),t-=s._containerDiffX,e-=s._containerDiffY,this.isActive()?this.stop(!0,t,e):s.isReleasing()&&s._dragRelease.stop(!0,t,e)}if(s._visibility.stop(!0),n._hasListeners(Bt)&&n._emit(Bt,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:m}),t._hasListeners(Ft)&&t._emit(Ft,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:m}),s.isDestroyed()||n.isDestroyed()||t.isDestroyed())return;s._drag&&(s._drag.destroy(),s._drag=null),a.itemClass!==c.itemClass&&(Ge(r,a.itemClass),be(r,c.itemClass));const f=h?a.itemVisibleClass:a.itemHiddenClass,g=h?c.itemVisibleClass:c.itemHiddenClass;if(f!==g&&(Ge(r,f),be(r,g)),n.items.splice(l,1),De(_,s,m),s._gridId=t.id,o){const t=r.parentNode;if(u!==t){u.appendChild(r);const e=qe(u,t,!0),i=s._getTranslate();s._setTranslate(i.x+e.left,i.y+e.top)}}else d.appendChild(r);if(s._visibility.setStyles(h?c.visibleStyles:c.hiddenStyles),o){const{left:t,top:e}=qe(u,d,!0);s._containerDiffX=t,s._containerDiffY=e}s._updateDimensions(),s._sortData=null,c.dragEnabled&&(s._drag=new Be(s)),o?(this._isActive=!0,this.container=u):(this._isActive=!1,this.container=null),n._hasListeners(Vt)&&n._emit(Vt,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:m}),t._hasListeners(zt)&&t._emit(zt,{item:s,fromGrid:n,fromIndex:l,toGrid:t,toIndex:m})}stop(t=!1,e,i){if(!this.item||!this.isActive())return;const{item:s}=this,n=s.getGrid();if(this.container!==n.element){if(void 0===e||void 0===i)if(t){const t=s._getTranslate();e=t.x-s._containerDiffX,i=t.y-s._containerDiffY}else e=s.left,i=s.top;n.element.appendChild(s.element),s._setTranslate(e,i),s._containerDiffX=0,s._containerDiffY=0}this._isActive=!1,this.container=null}destroy(){this.item&&(this.stop(!0),this.item=null)}}class ai{constructor(t){const e=t.element.children[0];if(!e)throw new Error("No valid child element found within item element.");const i=t.isActive();this.item=t,this.element=e,this.animator=new h(e),this._isHidden=!i,this._isHiding=!1,this._isShowing=!1,this._currentStyleProps=[],this._queue="visibility-"+t.id,this._finishShow=this._finishShow.bind(this),this._finishHide=this._finishHide.bind(this),t.element.style.display=i?"":"none";const{settings:s}=t.getGrid();be(t.element,i?s.itemVisibleClass:s.itemHiddenClass),this.setStyles(i?s.visibleStyles:s.hiddenStyles)}isHidden(){return this._isHidden}isHiding(){return this._isHiding}isShowing(){return this._isShowing}show(t,e){if(!this.item)return;const{item:i}=this,n=s(e)?e:null;if(this._isShowing||this._isHidden)if(!this._isShowing||t){if(!this._isShowing){i._emitter.emit(this._queue,!0,i);const{settings:t}=i.getGrid();t&&(Ge(i.element,t.itemHiddenClass),be(i.element,t.itemVisibleClass)),this._isHiding||(i.element.style.display="")}n&&i._emitter.once(this._queue,n),this._isShowing=!0,this._isHiding=this._isHidden=!1,this._startAnimation(!0,t,this._finishShow)}else n&&i._emitter.once(this._queue,n);else n&&n(!1,i)}hide(t,e){if(!this.item)return;const{item:i}=this,n=s(e)?e:null;if(this._isHiding||!this._isHidden)if(!this._isHiding||t){if(!this._isHiding){i._emitter.emit(this._queue,!0,i);const{settings:t}=i.getGrid();be(i.element,t.itemHiddenClass),Ge(i.element,t.itemVisibleClass)}n&&i._emitter.once(this._queue,n),this._isHidden=this._isHiding=!0,this._isShowing=!1,this._startAnimation(!1,t,this._finishHide)}else n&&i._emitter.once(this._queue,n);else n&&n(!1,i)}stop(t){if(!this.item||!this._isHiding&&!this._isShowing)return;const{item:e}=this;H(e.id),this.animator.stop(),t&&e._emitter.emit(this._queue,!0,e)}setStyles(t){if(!this.element)return;const{element:e,_currentStyleProps:i}=this;let s;for(s in this._removeCurrentStyles(),t)i.push(s),e.style[s]=t[s]}destroy(){if(!this.item)return;const{item:t}=this,e=t.element,{settings:i}=t.getGrid();this.stop(!0),t._emitter.off(this._queue),this.animator.destroy(),this._removeCurrentStyles(),i&&(Ge(e,i.itemVisibleClass),Ge(e,i.itemHiddenClass)),e.style.display="",this._isHiding=this._isShowing=!1,this._isHidden=!0,this.item=null}_startAnimation(t,e,i){if(!this.item||!this.element)return;const{item:s,element:r,animator:o}=this,h=s.getGrid(),{settings:a}=h,l=t?a.visibleStyles:a.hiddenStyles,d=t?a.showDuration:a.hideDuration,c=t?a.showEasing:a.hideEasing,_=e||d<=0;if(!l)return o.stop(),void(i&&i());if(H(s.id),_)return n(r,l),o.stop(),void(i&&i());let u;o.animation&&(o.animation.onfinish=null);let m=0,f=0;h._visibilityNeedsDimensionsRefresh=!0,O(s.id,(()=>{if(!this.item||(t?!this._isShowing:!this._isHiding))return;u=function(t,e){const i={};let s;if(Array.isArray(e)){let n=0;for(;n<e.length;n++)s=e[n],i[s]=lt(t,Le(s))}else for(s in e)i[s]=lt(t,Le(s));return i}(r,l);const{x:e,y:i}=s._getTranslate();m=e,f=i,a._animationWindowing&&h._visibilityNeedsDimensionsRefresh&&(h._visibilityNeedsDimensionsRefresh=!1,h._updateBoundingRect(),h._updateBorders(!0,!1,!0,!1))}),(()=>{if(this.item&&(t?this._isShowing:this._isHiding))return!a._animationWindowing||s._isInViewport(m,f,ee)||s.isActive()&&s._isInViewport(s.left+s._containerDiffX,s.top+s._containerDiffY,ee)?void(u&&o.start(u,l,{duration:d,easing:c,onFinish:i})):(n(r,l),o.stop(),void(i&&i()))}))}_finishShow(){this.item&&!this._isHidden&&(this._isShowing=!1,this.item._emitter.emit(this._queue,!1,this.item))}_finishHide(){if(!this.item||!this._isHidden)return;const{item:t}=this;this._isHiding=!1,t._layout.stop(!0,0,0),t.element.style.display="none",t._emitter.emit(this._queue,!1,t)}_removeCurrentStyles(){if(!this.element)return;const{element:t,_currentStyleProps:e}=this;let i=0;for(;i<e.length;i++)t.style[e[i]]="";e.length=0}}let li=0;function di(){return++li}const ci={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",(function(){ci.width=window.innerWidth,ci.height=window.innerHeight}));const _i={left:0,top:0,width:0,height:0},ui={left:0,top:0,width:0,height:0};const mi={x:0,y:0},fi={left:0,top:0};class gi{constructor(t,e,s){const{settings:n,element:r,id:o}=t;if(Lt){if(Lt.has(e))throw new Error("You can only create one Muuri Item per element!");Lt.set(e,this)}this.id=di(),this.element=e,this.left=0,this.top=0,this.width=0,this.height=0,this.marginLeft=0,this.marginRight=0,this.marginTop=0,this.marginBottom=0,this._gridId=o,this._isDestroyed=!1,this._translateX=void 0,this._translateY=void 0,this._containerDiffX=0,this._containerDiffY=0,this._sortData=null,this._emitter=new i.Emitter,r&&e.parentNode!==r&&r.appendChild(e),be(e,n.itemClass),"boolean"!=typeof s&&(s="none"!==lt(e,"display")),this._isActive=s,this._visibility=new ai(this),this._layout=new oi(this),this._migrate=new hi(this),this._drag=n.dragEnabled?new Be(this):null,this._dragRelease=new ii(this),this._dragPlaceholder=new ti(this)}getGrid(){return Ct.get(this._gridId)||null}isActive(){return this._isActive}isVisible(){return!this._visibility.isHidden()}isShowing(){return!!this._visibility.isShowing()}isHiding(){return!!this._visibility.isHiding()}isPositioning(){return!!this._layout.isActive()}isDragging(){var t;return!!(null===(t=this._drag)||void 0===t?void 0:t.isActive())}isReleasing(){return!!this._dragRelease.isActive()}isDestroyed(){return this._isDestroyed}_updateDimensions(t){if(this._isDestroyed)return;if(!0!==t&&!this.isVisible()&&!this.isHiding())return;const e=this.element,{width:i,height:s}=e.getBoundingClientRect();this.width=i,this.height=s,this.marginLeft=Math.max(0,dt(e,"margin-left")),this.marginRight=Math.max(0,dt(e,"margin-right")),this.marginTop=Math.max(0,dt(e,"margin-top")),this.marginBottom=Math.max(0,dt(e,"margin-bottom")),this._dragPlaceholder.updateDimensions()}_updateSortData(){if(this._isDestroyed)return;const{settings:t}=this.getGrid(),{sortData:e}=t;if(this._sortData={},e){let t;for(t in e)this._sortData[t]=e[t](this,this.element)}}_addToLayout(t=0,e=0){this.isActive()||(this._isActive=!0,this.left=t,this.top=e)}_removeFromLayout(){this.isActive()&&(this._isActive=!1,this.left=0,this.top=0)}_canSkipLayout(t,e){return this.left===t&&this.top===e&&!this._migrate.isActive()&&!this._dragRelease.isActive()&&!this._layout._skipNextAnimation}_setTranslate(t,e){this._translateX===t&&this._translateY===e||(this._translateX=t,this._translateY=e,this.element.style[Re]=ze(t,e,this.getGrid().settings.translate3d))}_getTranslate(){if(void 0===this._translateX||void 0===this._translateY){const t=$e(this.element);mi.x=t.x,mi.y=t.y}else mi.x=this._translateX,mi.y=this._translateY;return mi}_getClientRootPosition(){const t=this.getGrid();return fi.left=t._rect.left+t._borderLeft-this._containerDiffX,fi.top=t._rect.top+t._borderTop-this._containerDiffY,fi}_isInViewport(t,e,i=0){const s=this._getClientRootPosition();return n=this.width,r=this.height,o=s.left+this.marginLeft+t,h=s.top+this.marginTop+e,a=(a=i||0)||0,_i.left=o,_i.top=h,_i.width=n,_i.height=r,ui.left=0-a,ui.top=0-a,ui.width=ci.width+a+a,ui.height=ci.height+a+a,st(_i,ui);var n,r,o,h,a}_destroy(t=!1){var e;if(this._isDestroyed)return;const i=this.element,{settings:s}=this.getGrid();this._dragPlaceholder.destroy(),this._dragRelease.destroy(),this._migrate.destroy(),this._layout.destroy(),this._visibility.destroy(),this._drag&&this._drag.destroy(),this._emitter.off(),Ge(i,s.itemClass),t&&(null===(e=i.parentNode)||void 0===e||e.removeChild(i)),Lt&&Lt.delete(i),this._isActive=!1,this._isDestroyed=!0}}function pi(t=!1){const e=1,i=2,s=4,n=8,r=16,o=.001,h=.5;function a(t){return((1e3*t+.5<<0)/10<<0)/100}const l=new class{constructor(){this._currentRects=[],this._nextRects=[],this._rectStore=[],this._slotSizes=[],this._shards=[],this._rectTarget={left:0,top:0,width:0,height:0},this._tempRectA={left:0,top:0,width:0,height:0},this._tempRectB={left:0,top:0,width:0,height:0},this._rectId=0,this._slotIndex=-1,this._slot={left:0,top:0,width:0,height:0},this._sortRectsLeftTop=this._sortRectsLeftTop.bind(this),this._sortRectsTopLeft=this._sortRectsTopLeft.bind(this)}computeLayout(t,o){const h=t.items;if(!h.length)return t;const l=t.slots,d=!!(o&e),c=!!(o&i),_=!!(o&s),u=!!(o&n),m=!!(o&r),f="number"==typeof h[0],g=f?2:1;let p,y,v=0,S=0,w=0;for(v=0;v<h.length;v+=g)f?(S=h[v],w=h[v+1]):(y=h[v],S=y.width+(y.marginLeft||0)+(y.marginRight||0),w=y.height+(y.marginTop||0)+(y.marginBottom||0)),m&&(S=a(S),w=a(w)),p=this._computeNextSlot(t,S,w,d,c),c?p.left+p.width>t.width&&(t.width=p.left+p.width):p.top+p.height>t.height&&(t.height=p.top+p.height),l[++this._slotIndex]=p.left,l[++this._slotIndex]=p.top,(_||u)&&this._slotSizes.push(p.width,p.height);if(_)for(v=0;v<l.length;v+=2)l[v]=t.width-(l[v]+this._slotSizes[v]);if(u)for(v=1;v<l.length;v+=2)l[v]=t.height-(l[v]+this._slotSizes[v]);return this._slotSizes.length=0,this._currentRects.length=0,this._nextRects.length=0,this._shards.length=0,this._rectId=0,this._slotIndex=-1,t}_computeNextSlot(t,e,i,s,n){const{_slot:r,_currentRects:a,_nextRects:l}=this;let d,c,_=!1,u=!1,m=0,f=0;for(l.length=0,r.left=0,r.top=0,r.width=e,r.height=i,m=0;m<a.length;m++)if(c=a[m],c&&(d=this._getRect(c),r.width<=d.width+o&&r.height<=d.height+o)){u=!0,r.left=d.left,r.top=d.top;break}if(u||(n?(r.left=t.width,r.top=0):(r.left=0,r.top=t.height),s||(_=!0)),!n&&r.top+r.height>t.height+o&&(r.left>h&&l.push(this._addRect(0,t.height,r.left,1/0)),r.left+r.width<t.width-h&&l.push(this._addRect(r.left+r.width,t.height,t.width-r.left-r.width,1/0)),t.height=r.top+r.height),n&&r.left+r.width>t.width+o&&(r.top>h&&l.push(this._addRect(t.width,0,1/0,r.top)),r.top+r.height<t.height-h&&l.push(this._addRect(t.width,r.top+r.height,1/0,t.height-r.top-r.height)),t.width=r.left+r.width),!_)for(s&&(m=0);m<a.length;m++){if(c=a[m],!c)continue;d=this._getRect(c);const e=this._splitRect(d,r);for(f=0;f<e.length;f++)c=e[f],d=this._getRect(c),(n?d.left+o<t.width-o:d.top+o<t.height-o)&&l.push(c)}return l.length>1&&this._purgeRects(l).sort(n?this._sortRectsLeftTop:this._sortRectsTopLeft),this._currentRects=l,this._nextRects=a,r}_addRect(t,e,i,s){const n=++this._rectId;return this._rectStore[n]=t||0,this._rectStore[++this._rectId]=e||0,this._rectStore[++this._rectId]=i||0,this._rectStore[++this._rectId]=s||0,n}_getRect(t,e){return(e=e||this._rectTarget).left=this._rectStore[t]||0,e.top=this._rectStore[++t]||0,e.width=this._rectStore[++t]||0,e.height=this._rectStore[++t]||0,e}_splitRect(t,e){const{_shards:i}=this;let s=0,n=0;return i.length=0,t.left+t.width<=e.left+o||e.left+e.width<=t.left+o||t.top+t.height<=e.top+o||e.top+e.height<=t.top+o?(i.push(this._addRect(t.left,t.top,t.width,t.height)),i):(s=e.left-t.left,s>=h&&i.push(this._addRect(t.left,t.top,s,t.height)),s=t.left+t.width-(e.left+e.width),s>=h&&i.push(this._addRect(e.left+e.width,t.top,s,t.height)),n=e.top-t.top,n>=h&&i.push(this._addRect(t.left,t.top,t.width,n)),n=t.top+t.height-(e.top+e.height),n>=h&&i.push(this._addRect(t.left,e.top+e.height,t.width,n)),i)}_isRectAWithinRectB(t,e){return t.left+o>=e.left&&t.top+o>=e.top&&t.left+t.width-o<=e.left+e.width&&t.top+t.height-o<=e.top+e.height}_purgeRects(t){const{_tempRectA:e,_tempRectB:i}=this;let s=t.length,n=0;for(;s--;)if(n=t.length,t[s])for(this._getRect(t[s],e);n--;)if(t[n]&&s!==n&&(this._getRect(t[n],i),this._isRectAWithinRectB(e,i))){t[s]=0;break}return t}_sortRectsTopLeft(t,e){const{_tempRectA:i,_tempRectB:s}=this;return this._getRect(t,i),this._getRect(e,s),i.top<s.top&&i.top+o<s.top?-1:i.top>s.top&&i.top-o>s.top?1:i.left<s.left&&i.left+o<s.left?-1:i.left>s.left&&i.left-o>s.left?1:0}_sortRectsLeftTop(t,e){const{_tempRectA:i,_tempRectB:s}=this;return this._getRect(t,i),this._getRect(e,s),i.left<s.left&&i.left+o<s.left?-1:i.left>s.left&&i.left-o<s.left?1:i.top<s.top&&i.top+o<s.top?-1:i.top>s.top&&i.top-o>s.top?1:0}};if(t){const t=self,e=1,i=2,s=3,n=4;t.onmessage=function(r){const o=new Float32Array(r.data),h=o.subarray(n,o.length),a=new Float32Array(h.length),d=o[s],c={items:h,slots:a,width:o[e],height:o[i]};l.computeLayout(c,d),o[e]=c.width,o[i]=c.height,o.set(c.slots,n),t.postMessage(o.buffer,[o.buffer])}}return l}let yi="";const vi=new Set;const Si=1,wi=2,bi=4,Di=8,Ti=16,Ai=0,ki=1,Ri=2,xi=3,Ei=4,Ci=pi();class Li{constructor(t=0,e){this._settings=0,this._asyncMode=!0,this._workers=[],this._layoutWorkerQueue=[],this._layoutsProcessing=new Set,this._layoutWorkerData=new Map,this._onWorkerMessage=this._onWorkerMessage.bind(this),e&&this.updateSettings(e);try{this._workers=function(t,e){const i=[];if(t>0){yi||(yi=URL.createObjectURL(new Blob(["("+pi.toString()+")(true)"],{type:"application/javascript"})));let s=0;for(;s<t;s++){const t=new Worker(yi);t.onmessage=e,i.push(t),vi.add(t)}}return i}(t,this._onWorkerMessage),this._asyncMode=!!this._workers.length}catch(t){}}updateSettings(t){let e=this._settings&Si;"boolean"==typeof t.fillGaps&&(e=t.fillGaps?Si:0);let i=this._settings&wi;"boolean"==typeof t.horizontal&&(i=t.horizontal?wi:0);let s=this._settings&bi;"boolean"==typeof t.alignRight&&(s=t.alignRight?bi:0);let n=this._settings&Di;"boolean"==typeof t.alignBottom&&(n=t.alignBottom?Di:0);let r=this._settings&Ti;"boolean"==typeof t.rounding&&(r=t.rounding?Ti:0),this._settings=e|i|s|n|r}createLayout(t,e,i,s){if(this._layoutWorkerData.has(t))throw new Error("A layout with the provided id is currently being processed.");const n=!this._asyncMode||!e.length,r=this._settings&wi,o={id:t,items:e,slots:new Float32Array(n?2*e.length:0),width:r?0:i.width,height:r?i.height:0,styles:{}};if(n)return e.length&&Ci.computeLayout(o,this._settings),this._setContainerStyles(o,i,this._settings),void s(o);const h=new Float32Array(Ei+2*e.length);h[Ai]=t,h[ki]=o.width,h[Ri]=o.height,h[xi]=this._settings;let a=0,l=Ei-1;for(;a<e.length;a++){const t=e[a];h[++l]=t.width+(t.marginLeft||0)+(t.marginRight||0),h[++l]=t.height+(t.marginTop||0)+(t.marginBottom||0)}return this._layoutWorkerQueue.push(t),this._layoutWorkerData.set(t,Object.assign(Object.assign({},o),{container:i,settings:this._settings,callback:s,packet:h,aborted:!1})),this._sendToWorker(),this.cancelLayout.bind(this,t)}cancelLayout(t){const e=this._layoutWorkerData.get(t);if(e&&!e.aborted)if(e.worker)e.aborted=!0;else{const e=this._layoutWorkerQueue.indexOf(t);this._layoutWorkerQueue.splice(e,1),this._layoutWorkerData.delete(t)}}destroy(){this._layoutWorkerData.forEach((t=>{this.cancelLayout(t.id),t.worker&&this._workers.push(t.worker)})),this._layoutWorkerData.clear(),this._layoutsProcessing.clear(),this._layoutWorkerQueue.length=0,function(t){let e=0;for(;e<t.length;e++){const i=t[e];i.onmessage=null,i.onerror=null,i.onmessageerror=null,i.terminate(),vi.delete(i)}yi&&!vi.size&&(URL.revokeObjectURL(yi),yi="")}(this._workers),this._workers.length=0}_sendToWorker(){if(!this._layoutWorkerQueue.length||!this._workers.length)return;const t=this._workers.pop(),e=this._layoutWorkerQueue.shift(),i=this._layoutWorkerData.get(e);i.worker=t,this._layoutsProcessing.add(e);const{buffer:s}=i.packet;t.postMessage(s,[s])}_onWorkerMessage(t){const e=new Float32Array(t.data),i=e[Ai],s=this._layoutWorkerData.get(i);if(this._layoutWorkerData.delete(i),this._layoutsProcessing.delete(i),!s)return;const{worker:n}=s;if(n&&this._workers.push(n),!s.aborted){const t={id:i,items:s.items,slots:e.subarray(Ei,e.length),width:e[ki],height:e[Ri],styles:{}};this._setContainerStyles(t,s.container,s.settings),s.callback(t)}n&&this._sendToWorker()}_setContainerStyles(t,e,i){const s=!!(i&wi),n="border-box"===e.boxSizing,{borderLeft:r=0,borderRight:o=0,borderTop:h=0,borderBottom:a=0}=e,{styles:l,width:d,height:c}=t;s?l.width=(n?d+r+o:d)+"px":l.height=(n?c+h+a:c)+"px"}}let Xi=0;function Yi(t){const e=Object.prototype.toString.call(t);return"[object HTMLCollection]"===e||"[object NodeList]"===e}const Ii=Object.prototype.toString;function Pi(t){return"object"==typeof t&&"[object Object]"===Ii.call(t)}let Mi=0;function Oi(t,e={}){let i=Hi({},t);return i=Hi(i,e),e.visibleStyles?i.visibleStyles=Object.assign({},e.visibleStyles):t.visibleStyles&&(i.visibleStyles=Object.assign({},t.visibleStyles)),e.hiddenStyles?i.hiddenStyles=Object.assign({},e.hiddenStyles):t.hiddenStyles&&(i.hiddenStyles=Object.assign({},t.hiddenStyles)),i}function Hi(t,e){const i=Object.keys(e),s=i.length;let n=0;for(;n<s;n++){const s=i[n],r=Pi(e[s]);Pi(t[s])&&r?t[s]=Hi(Hi({},t[s]),e[s]):r?t[s]=Hi({},e[s]):Array.isArray(e[s])?t[s]=e[s].slice(0):t[s]=e[s]}return t}function qi(t){const e={},i=document.documentElement.style;let s,n;for(s in t)t[s]&&(n=re(i,s),n&&(e[n]=t[s]));return e}function Gi(t){const e={};let i=0;for(;i<t.length;i++)e[t[i].id]=i;return e}function Wi(t,e,i){return t[e.id]-t[i.id]}function Ni(t,e){let i;for(i in t)if(t[i]!==e[i])return!1;return Object.keys(t).length===Object.keys(e).length}class Vi{constructor(t,e={}){if("string"==typeof t){const e=document.querySelector(t);if(!e)throw new Error("No container element found.");t=e}if(!t.isConnected||t===document.documentElement)throw new Error("Container element must be an existing DOM element.");const s=Oi(Vi.defaultOptions,e);s.visibleStyles=qi(s.visibleStyles),s.hiddenStyles=qi(s.hiddenStyles),this.id=di(),this.element=t,this.settings=s,this.items=[],this._isDestroyed=!1,this._layoutNeedsDimensionsRefresh=!1,this._visibilityNeedsDimensionsRefresh=!1,this._rect={width:0,height:0,left:0,right:0,top:0,bottom:0},this._borderLeft=0,this._borderRight=0,this._borderTop=0,this._borderBottom=0,this._boxSizing="",this._layout={id:0,items:[],slots:[]},this._isLayoutFinished=!0,this._nextLayoutData=null,this._resizeHandler=null,this._emitter=new i.Emitter,Ct.set(this.id,this),be(t,s.containerClass),this._bindLayoutOnResize(s.layoutOnResize),this.add(function(t,e){if("*"===e)return t.children;if("string"==typeof e){const i=[],s=t.children;let n=0;for(;n<s.length;n++)s[n].matches(e)&&i.push(s[n]);return i}return Array.isArray(e)||Yi(e)?e:[]}(t,s.items),{layout:!1}),s.layoutOnInit&&this.layout(!0)}on(t,e){return this._emitter.on(t,e),this}off(t,e){return this._emitter.off(t,e),this}isDestroyed(){return this._isDestroyed}getItem(t){if(this._isDestroyed||!t&&0!==t)return null;if("number"==typeof t)return this.items[t>-1?t:this.items.length+t]||null;if(t instanceof gi)return t._gridId===this.id?t:null;const e=Lt.get(t);return e&&e._gridId===this.id?e:null}getItems(t){if(this._isDestroyed||void 0===t)return this.items.slice(0);const e=[];if(Array.isArray(t)||Yi(t)){let i,s=0;for(;s<t.length;s++)i=this.getItem(t[s]),i&&e.push(i)}else{const i=this.getItem(t);i&&e.push(i)}return e}updateSettings(t){if(this._isDestroyed||!t)return this;const{settings:e,items:i}=this,s=[];let n=!1,r=!1,o=!1,h=!1,a=!1,l=!1;const d=Oi(e,t);d.visibleStyles=qi(d.visibleStyles),d.hiddenStyles=qi(d.hiddenStyles),this.settings=d;for(let i in t)switch(i){case"visibleStyles":a=!Ni(e[i],d[i]);break;case"hiddenStyles":l=!Ni(e[i],d[i]);break;case"dragEnabled":n=e[i]!==d[i];break;case"dragHandle":r=e[i]!==d[i];break;case"dragCssProps":o=!Ni(e[i],d[i]);break;case"dragEventListenerOptions":h=!Ni(e[i],d[i]);break;case"layoutOnResize":e[i]!==d[i]&&(this._unbindLayoutOnResize(),this._bindLayoutOnResize(d[i]));break;case"containerClass":e[i]!==d[i]&&(Ge(this.element,e[i]),be(this.element,d[i]));break;case"itemClass":case"itemVisibleClass":case"itemHiddenClass":case"itemPositioningClass":case"itemDraggingClass":case"itemReleasingClass":case"itemPlaceholderClass":e[i]!==d[i]&&s.push(i,e[i],d[i])}if(s.length||a||l||n||r||o||h){let t,e;for(t=0;t<i.length;t++){const c=i[t];for(e=0;e<s.length;e+=3){const t=s[e],i=s[e+1],n=s[e+2];let r=!1;switch(t){case"itemClass":r=!0;break;case"itemVisibleClass":r=c.isVisible();break;case"itemHiddenClass":r=!c.isVisible();break;case"itemPositioningClass":r=c.isPositioning();break;case"itemDraggingClass":r=c.isDragging();break;case"itemReleasingClass":r=c.isReleasing();break;case"itemPlaceholderClass":c._dragPlaceholder.updateClassName(n)}r&&(Ge(c.element,i),be(c.element,n))}c.isActive()?a&&(c._visibility.setStyles(d.visibleStyles),c._visibility.stop(!0)):l&&(c._visibility.setStyles(d.hiddenStyles),c._visibility.stop(!0)),(r||n)&&c._drag&&c._drag.getOriginGrid()===this&&(c._drag.destroy(),c._drag=null),d.dragEnabled&&(c._drag?c._drag.getOriginGrid()===this&&(o&&c._drag.dragger.setCssProps(d.dragCssProps),h&&c._drag.dragger.setListenerOptions(d.dragEventListenerOptions)):c._drag=new Be(c))}}return"sortData"in t&&this.refreshSortData(),this}refreshItems(t,e=!1){if(this._isDestroyed)return this;const i=t||this.items;let s,n,r,o;if(!0===e)for(o=[],s=0;s<i.length;s++)n=i[s],n.isVisible()||n.isHiding()||(r=n.element.style,r.visibility="hidden",r.display="",o.push(r));for(s=0;s<i.length;s++)i[s]._updateDimensions(e);if(o){for(s=0;s<o.length;s++)r=o[s],r.visibility="",r.display="none";o.length=0}return this}refreshSortData(t){if(this._isDestroyed)return this;const e=t||this.items;let i=0;for(;i<e.length;i++)e[i]._updateSortData();return this}synchronize(){if(this._isDestroyed)return this;const{items:t}=this;if(!t.length)return this;let e,i,s=0;for(;s<t.length;s++)i=t[s].element,i.parentNode===this.element&&(e||(e=document.createDocumentFragment()),e.appendChild(i));return e?(this.element.appendChild(e),this._emit("synchronize"),this):this}layout(t=!1,e){if(this._isDestroyed)return this;const i=this._nextLayoutData;i&&s(i.cancel)&&i.cancel();const n=Mi=Mi%16777216+1;this._nextLayoutData={id:n,instant:t,onFinish:e,cancel:null};const{items:r}=this,o=[];let h=0;for(;h<r.length;h++)r[h].isActive()&&o.push(r[h]);this._updateDimensions();const a={width:this._rect.width-this._borderLeft-this._borderRight,height:this._rect.height-this._borderTop-this._borderBottom,borderLeft:this._borderLeft,borderRight:this._borderRight,borderTop:this._borderTop,borderBottom:this._borderBottom,boxSizing:this._boxSizing},{layout:l}=this.settings;let d;return s(l)?d=l(n,this,o,a,(t=>{this._onLayoutDataReceived(t)})):(Vi.defaultPacker.updateSettings(l),d=Vi.defaultPacker.createLayout(n,o,a,(t=>{this._onLayoutDataReceived(Object.assign(Object.assign({},t),{items:o}))}))),s(d)&&this._nextLayoutData&&this._nextLayoutData.id===n&&(this._nextLayoutData.cancel=d),this}add(t,e={}){if(this._isDestroyed||!t)return[];const i=Yi(n=t)?Array.prototype.slice.call(n):Array.prototype.concat(n);var n;if(!i.length)return[];const r=e.layout?e.layout:void 0===e.layout,{items:o}=this;let h,a,l,d,c=!1;for(d=0;d<i.length;d++)a=i[d],a.parentNode!==this.element&&(h=h||document.createDocumentFragment(),h.appendChild(a));h&&this.element.appendChild(h);const _=[];for(d=0;d<i.length;d++)a=i[d],l=_[d]=new gi(this,a,e.active),l.isActive()&&(c=!0,l._layout._skipNextAnimation=!0);for(d=0;d<_.length;d++)l=_[d],l._updateDimensions(),l._updateSortData();return De(o,_,e.index),this._hasListeners("add")&&this._emit("add",_.slice(0)),c&&r&&this.layout(r===It,s(r)?r:void 0),_}remove(t,e={}){if(this._isDestroyed||!t.length)return[];const i=e.layout?e.layout:void 0===e.layout,n=this.getItems(),r=[],o=[];let h,a,l,d=!1;for(l=0;l<t.length;l++)a=t[l],a.isDestroyed()||(h=this.items.indexOf(a),-1!==h&&(a.isActive()&&(d=!0),r.push(a),o.push(n.indexOf(a)),a._destroy(e.removeElements),this.items.splice(h,1)));return this._hasListeners(Ht)&&this._emit(Ht,r.slice(0),o),d&&i&&this.layout(i===It,s(i)?i:void 0),r}show(t,e={}){return!this._isDestroyed&&t.length&&this._setItemsVisibility(t,!0,e),this}hide(t,e={}){return!this._isDestroyed&&t.length&&this._setItemsVisibility(t,!1,e),this}filter(t,e={}){if(this._isDestroyed||!this.items.length)return this;const i=[],n=[];if(s(t)||"string"==typeof t){let e,r;for(r=0;r<this.items.length;r++)e=this.items[r],(s(t)?t(e):e.element.matches(t))?i.push(e):n.push(e)}const r=s(e.onFinish)?e.onFinish:void 0;let o=[],h=[],a=-1;if(i.length?this.show(i,{instant:!!e.instant,syncWithLayout:!!e.syncWithLayout,onFinish:r?t=>{o=t,++a&&r(o,h)}:void 0,layout:!1}):r&&++a&&r(o,h),n.length?this.hide(n,{instant:!!e.instant,syncWithLayout:!!e.syncWithLayout,onFinish:r?t=>{h=t,++a&&r(o,h)}:void 0,layout:!1}):r&&++a&&r(o,h),i.length||n.length){this._hasListeners(Gt)&&this._emit(Gt,i.slice(0),n.slice(0));const t=e.layout?e.layout:void 0===e.layout;t&&this.layout(t===It,s(t)?t:void 0)}return this}sort(t,e={}){if(this._isDestroyed||this.items.length<2)return this;const{items:i}=this,n=i.slice(0),r=e.layout?e.layout:void 0===e.layout,o=!!e.descending;let h=null;if(s(t))i.sort(((e,i)=>{let s=o?-t(e,i):t(e,i);return s||(h||(h=Gi(n)),s=o?Wi(h,i,e):Wi(h,e,i)),s}));else if("string"==typeof t){const e=t.trim().split(" ").filter((function(t){return t})).map((function(t){return t.split(":")}));i.sort(((t,i)=>{let s=0,r=0;for(;r<e.length;r++){const n=e[r][0],h=e[r][1];null===t._sortData&&t._updateSortData(),null===i._sortData&&i._updateSortData();const a=t._sortData[n],l=i._sortData[n];if(s="desc"===h||!h&&o?l<a?-1:l>a?1:0:a<l?-1:a>l?1:0,s)return s}return s||(h||(h=Gi(n)),s=o?Wi(h,i,t):Wi(h,t,i)),s}))}else{if(!Array.isArray(t))throw new Error("Invalid comparer argument provided.");i.length=0,i.push.apply(i,t)}return this._hasListeners(Wt)&&this._emit(Wt,i.slice(0),n),r&&this.layout(r===It,s(r)?r:void 0),this}move(t,e,i={}){if(this._isDestroyed||this.items.length<2)return this;const{items:n}=this,r=i.layout?i.layout:void 0===i.layout,o=i.action===Xt,h=o?Xt:Yt,a=this.getItem(t),l=this.getItem(e);if(a&&l&&a!==l){const t=n.indexOf(a),e=n.indexOf(l);o?ke(n,t,e):Ae(n,t,e),this._hasListeners(Nt)&&this._emit(Nt,{item:a,fromIndex:t,toIndex:e,action:h}),r&&this.layout(r===It,s(r)?r:void 0)}return this}send(t,e,i,n={}){if(this._isDestroyed||e._isDestroyed||this===e)return this;const r=this.getItem(t);if(!r)return this;if(r._migrate.start(e,i,n.appendTo||document.body),r._migrate.isActive()&&r.isActive()){const t=n.layoutSender?n.layoutSender:void 0===n.layoutSender,i=n.layoutReceiver?n.layoutReceiver:void 0===n.layoutReceiver;t&&this.layout(t===It,s(t)?t:void 0),i&&e.layout(i===It,s(i)?i:void 0)}return this}destroy(t=!1){if(this._isDestroyed)return this;const e=this.element,i=this.getItems(),s=this._layout&&this._layout.styles||{};this._unbindLayoutOnResize();let n,r=0;for(;r<i.length;r++)i[r]._destroy(t);for(n in this.items.length=0,Ge(e,this.settings.containerClass),s)e.style[n]="";return Ct.delete(this.id),this._isDestroyed=!0,this._emitter.emit("destroy"),this._emitter.off(),this}_emit(t,...e){this._isDestroyed||this._emitter.emit(t,...e)}_hasListeners(t){return!this._isDestroyed&&this._emitter.listenerCount(t)>0}_updateBoundingRect(){const{_rect:t}=this,{width:e,height:i,left:s,right:n,top:r,bottom:o}=this.element.getBoundingClientRect();t.width=e,t.height=i,t.left=s,t.right=n,t.top=r,t.bottom=o}_updateBorders(t,e,i,s){const{element:n}=this;t&&(this._borderLeft=dt(n,"border-left-width")),e&&(this._borderRight=dt(n,"border-right-width")),i&&(this._borderTop=dt(n,"border-top-width")),s&&(this._borderBottom=dt(n,"border-bottom-width"))}_updateDimensions(){this._updateBoundingRect(),this._updateBorders(!0,!0,!0,!0),this._boxSizing=lt(this.element,"box-sizing")}_bindLayoutOnResize(t){"number"!=typeof t&&(t=!0===t?0:-1),t>=0&&(this._resizeHandler=function(t,e){let i=++Xi,s=0,n=0,r=!1,o=e=>{r||(n&&(s-=e-n),n=e,s>0?o&&et(i,o):(s=n=0,t()))};return function(h=!1){if(!r){if(!(e<=0))return!0===h?(r=!0,s=n=0,o=void 0,void it(i)):void(s<=0?(s=e,o&&o(0)):s=e);!0!==h&&t()}}}((()=>{this.refreshItems().layout()}),t),window.addEventListener("resize",this._resizeHandler))}_unbindLayoutOnResize(){const{_resizeHandler:t}=this;s(t)&&(t(!0),window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null)}_onLayoutDataReceived(t){if(this._isDestroyed||!this._nextLayoutData||this._nextLayoutData.id!==t.id)return;const{instant:e,onFinish:i}=this._nextLayoutData,r=t.items.length;let o,h,a,l,d=r;this._nextLayoutData=null,!this._isLayoutFinished&&this._hasListeners(Ot)&&this._emit(Ot,this._layout.items.slice(0)),this._layout=t;const c=[];for(l=0;l<r;l++)o=t.items[l],o?(h=t.slots[2*l],a=t.slots[2*l+1],o._canSkipLayout(h,a)?--d:(o.left=h,o.top=a,o.isActive()&&!o.isDragging()?c.push(o):--d)):--d;if(t.styles&&n(this.element,t.styles),this._hasListeners(Pt)&&(this._emit(Pt,t.items.slice(0),e),this._layout.id!==t.id))return;const _=()=>{if(--d>0)return;const e=this._layout.id!==t.id;e||(this._isLayoutFinished=!0),s(i)&&i(t.items.slice(0),e),!e&&this._hasListeners(Mt)&&this._emit(Mt,t.items.slice(0))};if(c.length)for(this._isLayoutFinished=!1,l=0;l<c.length&&this._layout.id===t.id;l++)c[l]._layout.start(e,_);else _()}_setItemsVisibility(t,e,i={}){const n=t.slice(0),r=!0===i.instant,o=i.onFinish,h=i.layout?i.layout:void 0===i.layout,a=e?"showStart":qt,l=e?"showEnd":"hideEnd",d=e?"show":"hide",c=[],_=[];let u,m,f=!1,g=n.length;if(!g)return void(s(o)&&o(n));for(m=0;m<n.length;m++)u=n[m],(e&&!u.isActive()||!e&&u.isActive())&&(f=!0),u._layout._skipNextAnimation=!(!e||u.isActive()),!e||u.isVisible()||u.isHiding()||_.push(u),e?u._addToLayout():u._removeFromLayout();_.length&&(this.refreshItems(_,!0),_.length=0);const p=()=>{for(f&&!1!==i.syncWithLayout&&this.off(Pt,p),this._hasListeners(a)&&this._emit(a,n.slice(0)),m=0;m<n.length;m++)u=n[m],u._gridId===this.id?u._visibility[d](r,((t,e)=>{t||c.push(e),--g<1&&(s(o)&&o(c.slice(0)),this._hasListeners(l)&&this._emit(l,c.slice(0)))})):--g<1&&(s(o)&&o(c.slice(0)),this._hasListeners(l)&&this._emit(l,c.slice(0)))};f&&!1!==i.syncWithLayout?this.on(Pt,p):p(),f&&h&&this.layout(h===It,s(h)?h:void 0)}}Vi.defaultPacker=new Li,Vi.defaultOptions={items:"*",showDuration:300,showEasing:"ease",hideDuration:300,hideEasing:"ease",visibleStyles:{opacity:"1",transform:"scale(1)"},hiddenStyles:{opacity:"0",transform:"scale(0.5)"},layout:{fillGaps:!1,horizontal:!1,alignRight:!1,alignBottom:!1,rounding:!1},layoutOnResize:150,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",sortData:null,translate3d:!1,dragEnabled:!1,dragContainer:null,dragHandle:null,dragStartPredicate:{distance:0,delay:0},dragAxis:"xy",dragSort:!0,dragSortHeuristics:{sortInterval:100,minDragDistance:10,minBounceBackAngle:1},dragSortPredicate:{threshold:50,action:Yt,migrateAction:Yt},dragRelease:{duration:300,easing:"ease",useDragContainer:!0},dragCssProps:{touchAction:"none",userSelect:"none",userDrag:"none",tapHighlightColor:"rgba(0, 0, 0, 0)",touchCallout:"none",contentZooming:"none"},dragEventListenerOptions:{passive:!0,capture:!1},dragPlaceholder:{enabled:!1,createElement:null,onCreate:null,onRemove:null},dragAutoScroll:{targets:[],handle:null,threshold:50,safeZone:.2,speed:Et.smoothSpeed(1e3,2e3,2500),sortDuringScroll:!0,smoothStop:!1,onStart:null,onStop:null},containerClass:"muuri",itemClass:"muuri-item",itemVisibleClass:"muuri-item-shown",itemHiddenClass:"muuri-item-hidden",itemPositioningClass:"muuri-item-positioning",itemDraggingClass:"muuri-item-dragging",itemReleasingClass:"muuri-item-releasing",itemPlaceholderClass:"muuri-item-placeholder",_animationWindowing:!1},t.Animator=h,t.AutoScroller=Et,t.Dragger=we,t.Grid=Vi,t.Item=gi,t.ItemDrag=Be,t.ItemDragPlaceholder=ti,t.ItemDragRelease=ii,t.ItemLayout=oi,t.ItemMigrate=hi,t.ItemVisibility=ai,t.PHASE_READ=l,t.PHASE_READ_TAIL=d,t.PHASE_SETUP=a,t.PHASE_WRITE=c,t.Packer=Li,t.addAutoScrollTick=K,t.addDebounceTick=et,t.addDragMoveTick=W,t.addDragScrollTick=V,t.addDragSortTick=z,t.addDragStartTick=q,t.addLayoutTick=P,t.addPlaceholderLayoutTick=U,t.addPlaceholderResizeTick=$,t.addReleaseScrollTick=j,t.addVisibilityTick=O,t.cancelAutoScrollTick=tt,t.cancelDebounceTick=it,t.cancelDragMoveTick=N,t.cancelDragScrollTick=B,t.cancelDragSortTick=F,t.cancelDragStartTick=G,t.cancelLayoutTick=M,t.cancelPlaceholderLayoutTick=Z,t.cancelPlaceholderResizeTick=J,t.cancelReleaseScrollTick=Q,t.cancelVisibilityTick=H,t.ticker=I,Object.defineProperty(t,"__esModule",{value:!0})}));