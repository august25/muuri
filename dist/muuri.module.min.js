import{Ticker}from"tikki";import{Emitter}from"eventti";function isFunction(t){return"function"==typeof t}const nativeCode="[native code]";function isNative(t){return!!(t&&isFunction(window.Symbol)&&isFunction(window.Symbol.toString)&&window.Symbol(t).toString().indexOf(nativeCode)>-1)}function setStyles(t,e){let i;for(i in e)t.style[i]=e[i]||""}const HAS_WEB_ANIMATIONS=isNative(Element.prototype.animate);class Animator{constructor(t){this.element=t||null,this.animation=null,this._finishCallback=null,this._onFinish=this._onFinish.bind(this)}start(t,e,i){if(!this.element)return;const{element:s}=this,{duration:n,easing:r,onFinish:o}=i||{};if(!HAS_WEB_ANIMATIONS)return setStyles(s,e),this._finishCallback=isFunction(o)?o:null,void this._onFinish();this.animation&&this.animation.cancel(),this.animation=s.animate([Object.assign({},t),Object.assign({},e)],{duration:n||300,easing:r||"ease"}),this._finishCallback=isFunction(o)?o:null,this.animation.onfinish=this._onFinish,setStyles(s,e)}stop(){this.element&&this.animation&&(this.animation.cancel(),this.animation=this._finishCallback=null)}isAnimating(){return!!this.animation}destroy(){this.element&&(this.stop(),this.element=null)}_onFinish(){const{_finishCallback:t}=this;this.animation=this._finishCallback=null,t&&t()}}const PHASE_SETUP=Symbol(),PHASE_READ=Symbol(),PHASE_READ_TAIL=Symbol(),PHASE_WRITE=Symbol(),LAYOUT_READ="layoutRead",LAYOUT_WRITE="layoutWrite",VISIBILITY_READ="visibilityRead",VISIBILITY_WRITE="visibilityWrite",DRAG_START_READ="dragStartRead",DRAG_START_WRITE="dragStartWrite",DRAG_MOVE_READ="dragMoveRead",DRAG_MOVE_WRITE="dragMoveWrite",DRAG_SCROLL_READ="dragScrollRead",DRAG_SCROLL_WRITE="dragScrollWrite",DRAG_SORT_READ="dragSortRead",RELEASE_SCROLL_READ="releaseScrollRead",RELEASE_SCROLL_WRITE="releaseScrollWrite",PLACEHOLDER_LAYOUT_READ="placeholderLayoutRead",PLACEHOLDER_LAYOUT_WRITE="placeholderLayoutWrite",PLACEHOLDER_RESIZE_WRITE="placeholderResizeWrite",AUTO_SCROLL_READ="autoScrollRead",AUTO_SCROLL_WRITE="autoScrollWrite",DEBOUNCE_READ="debounceRead",LISTENER_ID_MAP=new Map;function addUniqueListener(t,e,i){LISTENER_ID_MAP.size||ticker.once(PHASE_SETUP,(()=>{LISTENER_ID_MAP.clear()}));let s=LISTENER_ID_MAP.get(e);s&&ticker.off(t,s),s=ticker.once(t,i),LISTENER_ID_MAP.set(e,s)}function removeUniqueListener(t,e){const i=LISTENER_ID_MAP.get(e);i&&(LISTENER_ID_MAP.delete(e),ticker.off(t,i))}const ticker=new Ticker({phases:[PHASE_SETUP,PHASE_READ,PHASE_READ_TAIL,PHASE_WRITE]});function addLayoutTick(t,e,i){addUniqueListener(PHASE_READ,LAYOUT_READ+t,e),addUniqueListener(PHASE_WRITE,LAYOUT_WRITE+t,i)}function cancelLayoutTick(t){removeUniqueListener(PHASE_READ,LAYOUT_READ+t),removeUniqueListener(PHASE_WRITE,LAYOUT_WRITE+t)}function addVisibilityTick(t,e,i){addUniqueListener(PHASE_READ,VISIBILITY_READ+t,e),addUniqueListener(PHASE_WRITE,VISIBILITY_WRITE+t,i)}function cancelVisibilityTick(t){removeUniqueListener(PHASE_READ,VISIBILITY_READ+t),removeUniqueListener(PHASE_WRITE,VISIBILITY_WRITE+t)}function addDragStartTick(t,e,i){addUniqueListener(PHASE_READ,"dragStartRead"+t,e),addUniqueListener(PHASE_WRITE,"dragStartWrite"+t,i)}function cancelDragStartTick(t){removeUniqueListener(PHASE_READ,"dragStartRead"+t),removeUniqueListener(PHASE_WRITE,"dragStartWrite"+t)}function addDragMoveTick(t,e,i){addUniqueListener(PHASE_READ,"dragMoveRead"+t,e),addUniqueListener(PHASE_WRITE,"dragMoveWrite"+t,i)}function cancelDragMoveTick(t){removeUniqueListener(PHASE_READ,"dragMoveRead"+t),removeUniqueListener(PHASE_WRITE,"dragMoveWrite"+t)}function addDragScrollTick(t,e,i){addUniqueListener(PHASE_READ,"dragScrollRead"+t,e),addUniqueListener(PHASE_WRITE,"dragScrollWrite"+t,i)}function cancelDragScrollTick(t){removeUniqueListener(PHASE_READ,"dragScrollRead"+t),removeUniqueListener(PHASE_WRITE,"dragScrollWrite"+t)}function addDragSortTick(t,e){addUniqueListener(PHASE_READ_TAIL,"dragSortRead"+t,e)}function cancelDragSortTick(t){removeUniqueListener(PHASE_READ_TAIL,"dragSortRead"+t)}function addReleaseScrollTick(t,e,i){addUniqueListener(PHASE_READ,"releaseScrollRead"+t,e),addUniqueListener(PHASE_WRITE,"releaseScrollWrite"+t,i)}function cancelReleaseScrollTick(t){removeUniqueListener(PHASE_READ,"releaseScrollRead"+t),removeUniqueListener(PHASE_WRITE,"releaseScrollWrite"+t)}function addPlaceholderLayoutTick(t,e,i){addUniqueListener(PHASE_READ,"placeholderLayoutRead"+t,e),addUniqueListener(PHASE_WRITE,"placeholderLayoutWrite"+t,i)}function cancelPlaceholderLayoutTick(t){removeUniqueListener(PHASE_READ,"placeholderLayoutRead"+t),removeUniqueListener(PHASE_WRITE,"placeholderLayoutWrite"+t)}function addPlaceholderResizeTick(t,e){addUniqueListener(PHASE_WRITE,"placeholderResizeWrite"+t,e)}function cancelPlaceholderResizeTick(t){removeUniqueListener(PHASE_WRITE,"placeholderResizeWrite"+t)}function addAutoScrollTick(t,e){addUniqueListener(PHASE_READ,"autoScrollRead",t),addUniqueListener(PHASE_WRITE,"autoScrollWrite",e)}function cancelAutoScrollTick(){removeUniqueListener(PHASE_READ,"autoScrollRead"),removeUniqueListener(PHASE_WRITE,"autoScrollWrite")}function addDebounceTick(t,e){addUniqueListener(PHASE_READ,DEBOUNCE_READ+t,e)}function cancelDebounceTick(t){removeUniqueListener(PHASE_READ,DEBOUNCE_READ+t)}function isOverlapping(t,e){return!(t.left+t.width<=e.left||e.left+e.width<=t.left||t.top+t.height<=e.top||e.top+e.height<=t.top)}function getIntersectionArea(t,e){return isOverlapping(t,e)?(Math.min(t.left+t.width,e.left+e.width)-Math.max(t.left,e.left))*(Math.min(t.top+t.height,e.top+e.height)-Math.max(t.top,e.top)):0}function getIntersectionScore(t,e){const i=getIntersectionArea(t,e);if(!i)return 0;return i/(Math.min(t.width,e.width)*Math.min(t.height,e.height))*100}let cache$1=new WeakMap,cacheTimer=null,canClearCache=!0;const cacheTime=1e3,clearCache=function(){canClearCache?canClearCache=!0:(null!==cacheTimer&&(window.clearInterval(cacheTimer),cacheTimer=null),cache$1=new WeakMap)};function getStyle(t,e){if(!e)return"";let i=cache$1.get(t);return i||(i=window.getComputedStyle(t,null),cache$1.set(t,i)),cacheTimer?canClearCache=!1:cacheTimer=window.setInterval(clearCache,1e3),i.getPropertyValue(e)}function getStyleAsFloat(t,e){return parseFloat(getStyle(t,e))||0}const R1={width:0,height:0,left:0,right:0,top:0,bottom:0},R2=Object.assign({},R1),SPEED_DATA={direction:0,threshold:0,distance:0,value:0,maxValue:0,duration:0,speed:0,deltaTime:0,isEnding:!1},AXIS_X=1,AXIS_Y=2,FORWARD=4,BACKWARD=8,LEFT=9,RIGHT=5,UP=10,DOWN=6;function pointerHandle(t){const e={left:0,top:0,width:0,height:0},i=t||1;return function(t,s,n,r,o,a,l){return e.left=a-.5*i,e.top=l-.5*i,e.width=i,e.height=i,e}}function smoothSpeed(t,e,i){return function(s,n,r){let o=0;if(!r.isEnding)if(r.threshold>0){const e=r.threshold-Math.max(0,r.distance);o=t/r.threshold*e}else o=t;const a=r.speed;if(a===o)return o;let l=o;return a<o?(l=a+e*(r.deltaTime/1e3),Math.min(o,l)):(l=a-i*(r.deltaTime/1e3),Math.max(o,l))}}function isWindow(t){return t===window}function getScrollElement(t){return isWindow(t)||t===document.documentElement||t===document.body?window:t}function getScrollLeft(t){return isWindow(t)?t.pageXOffset:t.scrollLeft}function getScrollTop(t){return isWindow(t)?t.pageYOffset:t.scrollTop}function getScrollLeftMax(t){return isWindow(t)?document.documentElement.scrollWidth-document.documentElement.clientWidth:t.scrollWidth-t.clientWidth}function getScrollTopMax(t){return isWindow(t)?document.documentElement.scrollHeight-document.documentElement.clientHeight:t.scrollHeight-t.clientHeight}function getContentRect(t,e={width:0,height:0,left:0,right:0,top:0,bottom:0}){if(isWindow(t))e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight,e.left=0,e.right=e.width,e.top=0,e.bottom=e.height;else{const{left:i,top:s}=t.getBoundingClientRect(),n=t.clientLeft||getStyleAsFloat(t,"border-left-width"),r=t.clientTop||getStyleAsFloat(t,"border-top-width");e.width=t.clientWidth,e.height=t.clientHeight,e.left=i+n,e.right=e.left+e.width,e.top=s+r,e.bottom=e.top+e.height}return e}function getItemAutoScrollSettings(t){return t.getGrid().settings.dragAutoScroll}function prepareItemScrollSync(t){const e=t._drag;e&&e._prepareScroll()}function applyItemScrollSync(t){if(!t.isActive())return;const e=t._drag;e&&(e._scrollDiffX=e._scrollDiffY=0,t._setTranslate(e._translateX,e._translateY))}function computeThreshold(t,e){return Math.min(e/2,t)}function computeEdgeOffset(t,e,i,s){return Math.max(0,i+2*t+s*e-s)/2}class ObjectPool{constructor(t,e){this._pool=[],this._createObject=t,this._onRelease=e}pick(){return this._pool.pop()||this._createObject()}release(t){-1===this._pool.indexOf(t)&&(this._onRelease&&this._onRelease(t),this._pool.push(t))}reset(){this._pool.length=0}}class ScrollAction{constructor(){this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}reset(){this.requestX&&(this.requestX.action=null),this.requestY&&(this.requestY.action=null),this.element=null,this.requestX=null,this.requestY=null,this.scrollLeft=0,this.scrollTop=0}addRequest(t){1&t.direction?(this.requestX&&this.removeRequest(this.requestX),this.requestX=t):(this.requestY&&this.removeRequest(this.requestY),this.requestY=t),t.action=this}removeRequest(t){this.requestX===t?(this.requestX=null,t.action=null):this.requestY===t&&(this.requestY=null,t.action=null)}computeScrollValues(){this.element&&(this.scrollLeft=this.requestX?this.requestX.value:getScrollLeft(this.element),this.scrollTop=this.requestY?this.requestY.value:getScrollTop(this.element))}scroll(){this.element&&(this.element.scrollTo?this.element.scrollTo(this.scrollLeft,this.scrollTop):(this.element.scrollLeft=this.scrollLeft,this.element.scrollTop=this.scrollTop))}}class ScrollRequest{constructor(){this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}reset(){this.isActive&&this.onStop(),this.item=null,this.element=null,this.isActive=!1,this.isEnding=!1,this.direction=0,this.value=NaN,this.maxValue=0,this.threshold=0,this.distance=0,this.deltaTime=0,this.speed=0,this.duration=0,this.action=null}hasReachedEnd(){return 4&this.direction?this.value>=this.maxValue:this.value<=0}computeCurrentScrollValue(){return this.element?this.value!=this.value?1&this.direction?getScrollLeft(this.element):getScrollTop(this.element):Math.max(0,Math.min(this.value,this.maxValue)):0}computeNextScrollValue(){const t=this.speed*(this.deltaTime/1e3),e=4&this.direction?this.value+t:this.value-t;return Math.max(0,Math.min(e,this.maxValue))}computeSpeed(){if(!this.item||!this.element)return 0;const t=getItemAutoScrollSettings(this.item).speed;return isFunction(t)?(SPEED_DATA.direction=this.direction,SPEED_DATA.threshold=this.threshold,SPEED_DATA.distance=this.distance,SPEED_DATA.value=this.value,SPEED_DATA.maxValue=this.maxValue,SPEED_DATA.duration=this.duration,SPEED_DATA.speed=this.speed,SPEED_DATA.deltaTime=this.deltaTime,SPEED_DATA.isEnding=this.isEnding,t(this.item,this.element,SPEED_DATA)):t}tick(t){return this.isActive||(this.isActive=!0,this.onStart()),this.deltaTime=t,this.value=this.computeCurrentScrollValue(),this.speed=this.computeSpeed(),this.value=this.computeNextScrollValue(),this.duration+=t,this.value}onStart(){if(!this.item||!this.element)return;const{onStart:t}=getItemAutoScrollSettings(this.item);isFunction(t)&&t(this.item,this.element,this.direction)}onStop(){if(!this.item||!this.element)return;const{onStop:t}=getItemAutoScrollSettings(this.item);isFunction(t)&&t(this.item,this.element,this.direction);const e=this.item._drag;e&&e.sort()}}class AutoScroller{constructor(){this._isDestroyed=!1,this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,this._items=[],this._actions=[],this._requests={1:new Map,2:new Map},this._requestOverlapCheck=new Map,this._dragPositions=new Map,this._dragDirections=new Map,this._overlapCheckInterval=150,this._requestPool=new ObjectPool((()=>new ScrollRequest),(t=>t.reset())),this._actionPool=new ObjectPool((()=>new ScrollAction),(t=>t.reset())),this._readTick=this._readTick.bind(this),this._writeTick=this._writeTick.bind(this)}isDestroyed(){return this._isDestroyed}addItem(t,e,i){if(this._isDestroyed)return;-1===this._items.indexOf(t)&&(this._items.push(t),this._requestOverlapCheck.set(t.id,this._tickTime),this._dragDirections.set(t.id,[0,0]),this._dragPositions.set(t.id,[e,i]),this._isTicking||this._startTicking())}updateItem(t,e,i){if(this._isDestroyed)return;const s=this._dragPositions.get(t.id),n=this._dragDirections.get(t.id);if(!s||!n)return;const r=s[0],o=s[1];n[0]=e>r?5:e<r?9:n[0]||0,n[1]=i>o?6:i<o?10:n[1]||0,s[0]=e,s[1]=i,this._requestOverlapCheck.set(t.id,this._requestOverlapCheck.get(t.id)||this._tickTime)}removeItem(t){if(this._isDestroyed)return;const e=this._items.indexOf(t);if(-1===e)return;const i=t.id;this._requests[1].get(i)&&(this._cancelItemScroll(t,1),this._requests[1].delete(i));this._requests[2].get(i)&&(this._cancelItemScroll(t,2),this._requests[2].delete(i)),this._requestOverlapCheck.delete(i),this._dragPositions.delete(i),this._dragDirections.delete(i),this._items.splice(e,1),this._isTicking&&!this._items.length&&this._stopTicking()}isItemScrollingX(t){const e=this._requests[1].get(t.id);return!(!e||!e.isActive)}isItemScrollingY(t){const e=this._requests[2].get(t.id);return!(!e||!e.isActive)}isItemScrolling(t){return this.isItemScrollingX(t)||this.isItemScrollingY(t)}destroy(){if(this._isDestroyed)return;const t=this._items.slice(0);let e=0;for(;e<t.length;e++)this.removeItem(t[e]);this._actions.length=0,this._requestPool.reset(),this._actionPool.reset(),this._isDestroyed=!0}_readTick(t){this._isDestroyed||(t&&this._tickTime?(this._tickDeltaTime=t-this._tickTime,this._tickTime=t,this._updateRequests(),this._updateActions()):(this._tickTime=t,this._tickDeltaTime=0))}_writeTick(){this._isDestroyed||(this._applyActions(),addAutoScrollTick(this._readTick,this._writeTick))}_startTicking(){this._isTicking=!0,addAutoScrollTick(this._readTick,this._writeTick)}_stopTicking(){this._isTicking=!1,this._tickTime=0,this._tickDeltaTime=0,cancelAutoScrollTick()}_getItemHandleRect(t,e,i={width:0,height:0,left:0,right:0,top:0,bottom:0}){const s=t._drag;if(e){const n=s._dragMoveEvent||s._dragStartEvent,r=e(t,s._clientX,s._clientY,t.width,t.height,n.clientX,n.clientY);i.left=r.left,i.top=r.top,i.width=r.width,i.height=r.height}else i.left=s._clientX,i.top=s._clientY,i.width=t.width,i.height=t.height;return i.right=i.left+i.width,i.bottom=i.top+i.height,i}_requestItemScroll(t,e,i,s,n,r,o){const a=this._requests[e];let l=a.get(t.id);l?l.element===i&&l.direction===s||l.reset():l=this._requestPool.pick(),l.item=t,l.element=i,l.direction=s,l.threshold=n,l.distance=r,l.maxValue=o,a.set(t.id,l)}_cancelItemScroll(t,e){const i=this._requests[e],s=i.get(t.id);s&&(s.action&&s.action.removeRequest(s),this._requestPool.release(s),i.delete(t.id))}_checkItemOverlap(t,e,i){const s=getItemAutoScrollSettings(t),{threshold:n,safeZone:r,handle:o,targets:a}=s,l=isFunction(a)?a(t):a;if(!l||!l.length)return e&&this._cancelItemScroll(t,1),void(i&&this._cancelItemScroll(t,2));const h=this._dragDirections.get(t.id),c=h&&h[0]||0,d=h&&h[1]||0;if(!c&&!d)return e&&this._cancelItemScroll(t,1),void(i&&this._cancelItemScroll(t,2));const _=this._getItemHandleRect(t,o,R1);let u=null,g=-1/0,m=0,f=0,S=0,p=0,E=0,T=null,y=-1/0,v=0,A=0,D=0,R=0,I=0,w=0;for(;w<l.length;w++){const t=l[w],s=t.threshold||n,o=!(!e||!c||2===t.axis),a=!(!i||!d||1===t.axis),h=t.priority||0;if((!o||h<g)&&(!a||h<y))continue;const b=getScrollElement(t.element||t),P=o?getScrollLeftMax(b):-1,L=a?getScrollTopMax(b):-1;if(!P&&!L)continue;const C=getContentRect(b,R2),k=getIntersectionScore(_,C);if(!(k<=0)){if(o&&h>=g&&P>0&&(h>g||k>f)){let t=0,e=0;const i=computeThreshold(s,C.width),n=computeEdgeOffset(i,r,_.width,C.width);5===c?(t=C.right+n-_.right,t<=i&&getScrollLeft(b)<P&&(e=5)):9===c&&(t=_.left-(C.left-n),t<=i&&getScrollLeft(b)>0&&(e=9)),e&&(u=b,g=h,m=i,f=k,S=e,p=t,E=P)}if(a&&h>=y&&L>0&&(h>y||k>A)){let t=0,e=0;const i=computeThreshold(s,C.height),n=computeEdgeOffset(i,r,_.height,C.height);6===d?(t=C.bottom+n-_.bottom,t<=i&&getScrollTop(b)<L&&(e=6)):10===d&&(t=_.top-(C.top-n),t<=i&&getScrollTop(b)>0&&(e=10)),e&&(T=b,y=h,v=i,A=k,D=e,R=t,I=L)}}}e&&(u&&S?this._requestItemScroll(t,1,u,S,m,p,E):this._cancelItemScroll(t,1)),i&&(T&&D?this._requestItemScroll(t,2,T,D,v,R,I):this._cancelItemScroll(t,2))}_updateScrollRequest(t){const e=t.item,{threshold:i,safeZone:s,smoothStop:n,handle:r,targets:o}=getItemAutoScrollSettings(e),a=isFunction(o)?o(e):o,l=a&&a.length||0,h=this._getItemHandleRect(e,r,R1);let c=null,d=0;for(;d<l;d++){const e=a[d],n=getScrollElement(e.element||e);if(n!==t.element)continue;const r=!!(1&t.direction);if(r){if(2===e.axis)continue}else if(1===e.axis)continue;const o=r?getScrollLeftMax(n):getScrollTopMax(n);if(o<=0)break;const l=getContentRect(n,R2);if(getIntersectionScore(h,l)<=0)break;const _=computeThreshold("number"==typeof e.threshold?e.threshold:i,r?l.width:l.height),u=computeEdgeOffset(_,s,r?h.width:h.height,r?l.width:l.height);let g=0;if(g=9===t.direction?h.left-(l.left-u):5===t.direction?l.right+u-h.right:10===t.direction?h.top-(l.top-u):l.bottom+u-h.bottom,g>_)break;const m=r?getScrollLeft(n):getScrollTop(n);if(c=4&t.direction?m>=o:m<=0,c)break;return t.maxValue=o,t.threshold=_,t.distance=g,t.isEnding=!1,!0}return!0===n&&t.speed>0?(null===c&&(c=t.hasReachedEnd()),t.isEnding=!c):t.isEnding=!1,t.isEnding}_updateRequests(){const t=this._items,e=this._requests[1],i=this._requests[2];let s=0;for(;s<t.length;s++){const n=t[s],r=this._requestOverlapCheck.get(n.id)||0;let o=r>0&&this._tickTime-r>this._overlapCheckInterval,a=!0;const l=e.get(n.id);l&&l.isActive&&(a=!this._updateScrollRequest(l),a&&(o=!0,this._cancelItemScroll(n,1)));let h=!0;const c=i.get(n.id);c&&c.isActive&&(h=!this._updateScrollRequest(c),h&&(o=!0,this._cancelItemScroll(n,2))),o&&(this._requestOverlapCheck.set(n.id,0),this._checkItemOverlap(n,a,h))}}_requestAction(t,e){const i=this._actions,s=1===e;let n=null,r=0;for(;r<i.length;r++){if(n=i[r],t.element===n.element){if(s?n.requestX:n.requestY)return void this._cancelItemScroll(t.item,e);break}n=null}n||(n=this._actionPool.pick()),n.element=t.element,n.addRequest(t),t.tick(this._tickDeltaTime),i.push(n)}_updateActions(){const t=this._items,e=this._requests,i=this._actions;let s=0;for(s=0;s<t.length;s++){const i=e[1].get(t[s].id),n=e[2].get(t[s].id);i&&this._requestAction(i,1),n&&this._requestAction(n,2)}for(s=0;s<i.length;s++)i[s].computeScrollValues()}_applyActions(){const t=this._actions;if(!t.length)return;let e=0;for(e=0;e<t.length;e++)t[e].scroll(),this._actionPool.release(t[e]);t.length=0;const i=this._items;for(e=0;e<i.length;e++)prepareItemScrollSync(i[e]);for(e=0;e<i.length;e++)applyItemScrollSync(i[e])}}AutoScroller.AXIS_X=1,AutoScroller.AXIS_Y=2,AutoScroller.LEFT=9,AutoScroller.RIGHT=5,AutoScroller.UP=10,AutoScroller.DOWN=6,AutoScroller.smoothSpeed=smoothSpeed,AutoScroller.pointerHandle=pointerHandle;const GRID_INSTANCES=new Map,ITEM_ELEMENT_MAP=new Map,ACTION_SWAP="swap",ACTION_MOVE="move",INSTANT_LAYOUT="instant",EVENT_SYNCHRONIZE="synchronize",EVENT_LAYOUT_START="layoutStart",EVENT_LAYOUT_END="layoutEnd",EVENT_LAYOUT_ABORT="layoutAbort",EVENT_ADD="add",EVENT_REMOVE="remove",EVENT_SHOW_START="showStart",EVENT_SHOW_END="showEnd",EVENT_HIDE_START="hideStart",EVENT_HIDE_END="hideEnd",EVENT_FILTER="filter",EVENT_SORT="sort",EVENT_MOVE="move",EVENT_SEND="send",EVENT_BEFORE_SEND="beforeSend",EVENT_RECEIVE="receive",EVENT_BEFORE_RECEIVE="beforeReceive",EVENT_DRAG_INIT="dragInit",EVENT_DRAG_START="dragStart",EVENT_DRAG_MOVE="dragMove",EVENT_DRAG_SCROLL="dragScroll",EVENT_DRAG_END="dragEnd",EVENT_DRAG_RELEASE_START="dragReleaseStart",EVENT_DRAG_RELEASE_END="dragReleaseEnd",EVENT_DESTROY="destroy",HAS_TOUCH_EVENTS="ontouchstart"in window,HAS_POINTER_EVENTS=!!window.PointerEvent,UA=window.navigator.userAgent.toLowerCase(),IS_FIREFOX=UA.indexOf("firefox")>-1,IS_SAFARI=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),IS_ANDROID=UA.indexOf("android")>-1,IS_IOS=/^(iPad|iPhone|iPod)/.test(window.navigator.platform)||/^Mac/.test(window.navigator.platform)&&window.navigator.maxTouchPoints>1,MAX_SAFE_FLOAT32_INTEGER=16777216,VIEWPORT_THRESHOLD=100,HAS_PASSIVE_EVENTS=(()=>{let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t})(),vendorPrefixes=["","webkit","moz","ms","o","Webkit","Moz","MS","O"],cache=new Map;function getPrefixedPropName(t,e){let i=cache.get(e);if(i)return i;const s=e[0].toUpperCase()+e.slice(1);let n=0;for(;n<vendorPrefixes.length;){if(i=vendorPrefixes[n]?vendorPrefixes[n]+s:e,i in t)return cache.set(e,i),i;++n}return""}const POINTER_EVENTS={start:"pointerdown",move:"pointermove",cancel:"pointercancel",end:"pointerup"},TOUCH_EVENTS={start:"touchstart",move:"touchmove",cancel:"touchcancel",end:"touchend"},MOUSE_EVENTS={start:"mousedown",move:"mousemove",cancel:"",end:"mouseup"},SOURCE_EVENTS=Object.assign({},HAS_TOUCH_EVENTS?TOUCH_EVENTS:HAS_POINTER_EVENTS?POINTER_EVENTS:MOUSE_EVENTS),DRAGGER_EVENTS={start:"start",move:"move",cancel:"cancel",end:"end"},CAPTURE=1,PASSIVE=2,TA_AUTO="auto",TA_PROP="touchAction",TA_PROP_PREFIXED=getPrefixedPropName(document.documentElement.style,TA_PROP);function preventDefault(t){t.preventDefault&&!1!==t.cancelable&&t.preventDefault()}function getListenerType(t,e){return(t?1:0)|(HAS_PASSIVE_EVENTS&&e?2:0)}function getListenerOptions(t){return HAS_PASSIVE_EVENTS?{capture:!!(1&t),passive:!!(2&t)}:!!(1&t)}function getPointerType(t){return"pointerType"in t?t.pointerType:"touches"in t?"touch":"mouse"}function getEventPointerId(t){return"pointerId"in t?t.pointerId:"changedTouches"in t?t.changedTouches[0]?t.changedTouches[0].identifier:null:1}function getTouchById(t,e){if("pointerId"in t)return t.pointerId===e?t:null;if("changedTouches"in t){let i=0;for(;i<t.changedTouches.length;i++)if(t.changedTouches[i].identifier===e)return t.changedTouches[i];return null}return t}class DragProxy{constructor(t){this._emitter=new Emitter,this._listenerOptions=getListenerOptions(t),this._draggers=new Set,this._onMove=this._onMove.bind(this),this._onCancel=this._onCancel.bind(this),this._onEnd=this._onEnd.bind(this)}hasDragger(t){return this._draggers.has(t)}addDragger(t){this._draggers.has(t)||(this._draggers.add(t),this._emitter.on(DRAGGER_EVENTS.move,t.onMove),this._emitter.on(DRAGGER_EVENTS.cancel,t.onCancel),this._emitter.on(DRAGGER_EVENTS.end,t.onEnd),1===this._draggers.size&&this._activate())}removeDragger(t){this._draggers.has(t)&&(this._draggers.delete(t),this._emitter.off(DRAGGER_EVENTS.move,t.onMove),this._emitter.off(DRAGGER_EVENTS.cancel,t.onCancel),this._emitter.off(DRAGGER_EVENTS.end,t.onEnd),0===this._draggers.size&&this._deactivate())}destroy(){this._draggers.size&&this._deactivate(),this._draggers.clear(),this._emitter.off()}_activate(){window.addEventListener(SOURCE_EVENTS.move,this._onMove,this._listenerOptions),window.addEventListener(SOURCE_EVENTS.end,this._onEnd,this._listenerOptions),SOURCE_EVENTS.cancel&&window.addEventListener(SOURCE_EVENTS.cancel,this._onCancel,this._listenerOptions)}_deactivate(){window.removeEventListener(SOURCE_EVENTS.move,this._onMove,this._listenerOptions),window.removeEventListener(SOURCE_EVENTS.end,this._onEnd,this._listenerOptions),SOURCE_EVENTS.cancel&&window.removeEventListener(SOURCE_EVENTS.cancel,this._onCancel,this._listenerOptions)}_onMove(t){this._emitter.emit(DRAGGER_EVENTS.move,t)}_onCancel(t){this._emitter.emit(DRAGGER_EVENTS.cancel,t)}_onEnd(t){this._emitter.emit(DRAGGER_EVENTS.end,t)}}const dragProxies=[new DragProxy(0),new DragProxy(1)];HAS_PASSIVE_EVENTS&&dragProxies.push(new DragProxy(2),new DragProxy(3));class Dragger{constructor(t,e,i={}){const{capture:s=!0,passive:n=!0}=i;this.element=t,this._emitter=new Emitter,this._cssProps={},this._touchAction="",this._listenerType=getListenerType(s,n),this._isActive=!1,this._pointerId=null,this._startTime=0,this._startX=0,this._startY=0,this._currentX=0,this._currentY=0,this.onStart=this.onStart.bind(this),this.onMove=this.onMove.bind(this),this.onCancel=this.onCancel.bind(this),this.onEnd=this.onEnd.bind(this),e&&this.setCssProps(e),this._touchAction||this.setTouchAction("auto"),t.addEventListener("dragstart",preventDefault,!1),t.addEventListener(SOURCE_EVENTS.start,this.onStart,getListenerOptions(this._listenerType))}getTrackedTouch(t){return null===this._pointerId?null:getTouchById(t,this._pointerId)}onStart(t){if(!this.element)return;if(null!==this._pointerId)return;if(this._pointerId=getEventPointerId(t),null===this._pointerId)return;const e=this.getTrackedTouch(t);if(e&&(this._startX=this._currentX=e.clientX,this._startY=this._currentY=e.clientY,this._startTime=Date.now(),this._isActive=!0,this._emit(DRAGGER_EVENTS.start,t),this._isActive)){const t=dragProxies[this._listenerType];t&&t.addDragger(this)}}onMove(t){const e=this.getTrackedTouch(t);e&&(this._currentX=e.clientX,this._currentY=e.clientY,this._emit(DRAGGER_EVENTS.move,t))}onCancel(t){this.getTrackedTouch(t)&&(this._emit(DRAGGER_EVENTS.cancel,t),this.reset())}onEnd(t){this.getTrackedTouch(t)&&(this._emit(DRAGGER_EVENTS.end,t),this.reset())}isActive(){return this._isActive}setTouchAction(t){this.element&&t&&(this._touchAction=t,TA_PROP_PREFIXED&&(this._cssProps[TA_PROP_PREFIXED]="",this.element.style[TA_PROP_PREFIXED]=t),HAS_TOUCH_EVENTS&&(this.element.removeEventListener(TOUCH_EVENTS.start,preventDefault,!0),"auto"!==t&&(this.element.style[TA_PROP_PREFIXED]!==t||IS_FIREFOX&&IS_ANDROID)&&this.element.addEventListener(TOUCH_EVENTS.start,preventDefault,!0)))}setCssProps(t){if(!this.element)return;const e=this._cssProps,{element:i}=this;let s,n="";for(n in e)i.style[n]=e[n],delete e[n];for(s in t){const n=t[s]||"";if(!n)continue;if(s===TA_PROP){this.setTouchAction(n);continue}const r=getPrefixedPropName(i.style,s);r&&(e[r]="",i.style[r]=n)}}setListenerOptions(t){if(!this.element)return;const{capture:e=!0,passive:i=!0}=t,s=this._listenerType,n=getListenerType(e,i);if(s!==n){this.element.removeEventListener(SOURCE_EVENTS.start,this.onStart,getListenerOptions(this._listenerType));const t=dragProxies[this._listenerType],e=!!t&&t.hasDragger(this);if(e&&t.removeDragger(this),this._listenerType=n,this.element.addEventListener(SOURCE_EVENTS.start,this.onStart,getListenerOptions(this._listenerType)),e){const t=dragProxies[this._listenerType];t&&t.addDragger(this)}}}getDeltaX(){return this._currentX-this._startX}getDeltaY(){return this._currentY-this._startY}getDistance(){const t=this.getDeltaX(),e=this.getDeltaY();return Math.sqrt(t*t+e*e)}getDeltaTime(){return this._startTime?Date.now()-this._startTime:0}on(t,e){this._emitter.on(t,e)}off(t,e){this._emitter.off(t,e)}reset(){this._pointerId=null,this._startTime=0,this._startX=0,this._startY=0,this._currentX=0,this._currentY=0,this._isActive=!1;const t=dragProxies[this._listenerType];t&&t.removeDragger(this)}destroy(){const{element:t}=this;if(!t)return;let e;for(e in this.reset(),this._emitter.off(),t.removeEventListener(SOURCE_EVENTS.start,this.onStart,getListenerOptions(this._listenerType)),t.removeEventListener("dragstart",preventDefault,!1),t.removeEventListener(TOUCH_EVENTS.start,preventDefault,!0),this._cssProps)t.style[e]="";this._cssProps={},this.element=null}_createEvent(t,e){const i=this.getTrackedTouch(e);return i&&null!==this._pointerId?{type:t,srcEvent:e,distance:this.getDistance(),deltaX:this.getDeltaX(),deltaY:this.getDeltaY(),deltaTime:t===DRAGGER_EVENTS.start?0:this.getDeltaTime(),isFirst:t===DRAGGER_EVENTS.start,isFinal:t===DRAGGER_EVENTS.end||t===DRAGGER_EVENTS.cancel,pointerType:getPointerType(e),identifier:this._pointerId,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,target:i.target}:null}_emit(t,e){this._emitter.emit(t,this._createEvent(t,e))}}function addClass(t,e){e&&t.classList.add(e)}function arrayInsert(t,e,i=-1){i<0&&(i=t.length-i+1),Array.isArray(e)?t.splice(i,0,...e):t.splice(i,0,e)}function normalizeArrayIndex(t,e,i=0){const s=Math.max(0,t.length-1+i);return e>s?s:e<0?Math.max(s+e+1,0):e}function arrayMove(t,e,i){if(t.length<2)return;const s=normalizeArrayIndex(t,e),n=normalizeArrayIndex(t,i);s!==n&&t.splice(n,0,t.splice(s,1)[0])}function arraySwap(t,e,i){if(t.length<2)return;const s=normalizeArrayIndex(t,e),n=normalizeArrayIndex(t,i);if(s!==n){const e=t[s];t[s]=t[n],t[n]=e}}const transformProp=getPrefixedPropName(document.documentElement.style,"transform")||"transform",styleNameRegEx=/([A-Z])/g,prefixRegex=/^(webkit-|moz-|ms-|o-)/,msPrefixRegex=/^(-m-s-)/;function getStyleName(t){let e=t.replace(styleNameRegEx,"-$1").toLowerCase();return e=e.replace(prefixRegex,"-$1"),e=e.replace(msPrefixRegex,"-ms-"),e}const transformStyle=getStyleName(transformProp);function isContainingBlock(t){if("static"!==getStyle(t,"position"))return!0;const e=getStyle(t,"display");if("inline"===e||"none"===e)return!1;const i=getStyle(t,transformStyle);if(i&&"none"!==i)return!0;const s=getStyle(t,"perspective");if(s&&"none"!==s)return!0;const n=getStyle(t,"content-visibility");if(n&&("auto"===n||"hidden"===n))return!0;const r=getStyle(t,"contain");if(r&&("strict"===r||"content"===r||r.indexOf("paint")>-1||r.indexOf("layout")>-1))return!0;if(!IS_SAFARI){const e=getStyle(t,"filter");if(e&&"none"!==e)return!0;const i=getStyle(t,"will-change");if(i&&(i.indexOf("transform")>-1||i.indexOf("perspective")>-1))return!0}return!1}function getContainingBlock(t){let e=t||document;for(;e&&e!==document&&!isContainingBlock(t);)e=e.parentElement||document;return e}const offsetA={left:0,top:0},offsetB={left:0,top:0},offsetDiff={left:0,top:0};function getOffset(t,e={left:0,top:0}){if(e.left=0,e.top=0,t===document)return e;if(e.left=window.pageXOffset||0,e.top=window.pageYOffset||0,"self"in t&&t.self===window.self)return e;const{left:i,top:s}=t.getBoundingClientRect();return e.left+=i,e.top+=s,e.left+=getStyleAsFloat(t,"border-left-width"),e.top+=getStyleAsFloat(t,"border-top-width"),e}function getOffsetDiff(t,e,i=!1){return offsetDiff.left=0,offsetDiff.top=0,t===e||i&&(t=getContainingBlock(t))===(e=getContainingBlock(e))||(getOffset(t,offsetA),getOffset(e,offsetB),offsetDiff.left=offsetB.left-offsetA.left,offsetDiff.top=offsetB.top-offsetA.top),offsetDiff}function removeClass(t,e){e&&t.classList.remove(e)}const START_PREDICATE_INACTIVE=0,START_PREDICATE_PENDING=1,START_PREDICATE_RESOLVED=2,SCROLL_LISTENER_OPTIONS$1=!HAS_PASSIVE_EVENTS||{capture:!0,passive:!0},RECT_A={left:0,top:0,width:0,height:0},RECT_B={left:0,top:0,width:0,height:0},defaultStartPredicate=function(t,e,i){if(e.isFinal)return;const s=t._drag;if(e.isFirst&&e.srcEvent.button)return s._resetDefaultStartPredicate(),!1;if(!IS_IOS&&e.isFirst&&!0===e.srcEvent.isTrusted&&!1===e.srcEvent.defaultPrevented&&!1===e.srcEvent.cancelable)return s._resetDefaultStartPredicate(),!1;let n=s._startPredicateData;if(!n){n=s._startPredicateData={distance:0,delay:0};const{dragStartPredicate:e}=t.getGrid().settings,r=i||e;"object"==typeof r&&(n.distance=Math.max(r.distance||0,0),n.delay=Math.max(r.delay||0,0))}return n.delay?(n.event=e,void(n.delayTimer||(n.delayTimer=window.setTimeout((function(){s._startPredicateData===n&&(s.item?n&&(n.delay=0,1===s._startPredicateState&&n.event&&n.event.distance>=n.distance&&(s._resetDefaultStartPredicate(),s._startPredicateState=2,s._onStart(n.event))):s._resetDefaultStartPredicate())}),n.delay)))):!(e.distance<n.distance)||void 0},getTargetGrid=function(t,e){const i=t.getGrid(),{dragSort:s}=i.settings,n=!0===s?[i]:isFunction(s)?s(t):void 0;let r=null;if(!n||!Array.isArray(n)||!n.length)return r;const o=RECT_A,a=RECT_B;let l,h,c=-1,d=0,_=null,u=0,g=0,m=0,f=0,S=0;const p=t._drag;for(o.width=t.width,o.height=t.height,o.left=p._clientX,o.top=p._clientY;S<n.length;S++)if(l=n[S],!l.isDestroyed()){for(l._updateBoundingRect(),u=Math.max(0,l._rect.left),g=Math.max(0,l._rect.top),m=Math.min(window.innerWidth,l._rect.right),f=Math.min(window.innerHeight,l._rect.bottom),_=l.element.parentNode;_&&_!==document&&_!==document.documentElement&&_!==document.body;)if(_.getRootNode&&_ instanceof DocumentFragment)_=_.getRootNode().host;else{if("visible"!==getStyle(_,"overflow")&&(h=_.getBoundingClientRect(),u=Math.max(u,h.left),g=Math.max(g,h.top),m=Math.min(m,h.right),f=Math.min(f,h.bottom)),"fixed"===getStyle(_,"position"))break;_=_.parentNode}u>=m||g>=f||(a.left=u,a.top=g,a.width=m-u,a.height=f-g,d=getIntersectionScore(o,a),d>e&&d>c&&(c=d,r=l))}return r},defaultSortPredicate=function(t,e){const i=t._drag,s=e&&"swap"===e.action?"swap":"move",n=e&&"swap"===e.migrateAction?"swap":"move",r=Math.min(Math.max(e&&"number"==typeof e.threshold?e.threshold:50,1),100),o=getTargetGrid(t,r);if(!o)return null;const a=t.getGrid()!==o,l=RECT_A,h=RECT_B;l.width=t.width,l.height=t.height,a?(o._updateBorders(!0,!1,!0,!1),l.left=i._clientX-(o._rect.left+o._borderLeft),l.top=i._clientY-(o._rect.top+o._borderTop)):(l.left=i._translateX-t._containerDiffX+t.marginLeft,l.top=i._translateY-t._containerDiffY+t.marginTop);let c=0,d=-1,_=!1;for(let e=0;e<o.items.length;e++){const i=o.items[e];if(!i.isActive()||i===t)continue;_=!0,h.width=i.width,h.height=i.height,h.left=i.left+i.marginLeft,h.top=i.top+i.marginTop;const s=getIntersectionScore(l,h);s>c&&(d=e,c=s)}return a&&c<r&&(d=_?d:0,c=r),c>=r?{grid:o,index:d,action:a?n:s}:null};class ItemDrag{constructor(t){const e=t.element,i=t.getGrid(),{settings:s}=i;this.item=t,this._originGridId=i.id,this._isMigrated=!1,this._isActive=!1,this._isStarted=!1,this._startPredicateState=0,this._startPredicateData=null,this._isSortNeeded=!1,this._sortTimer=void 0,this._blockedSortIndex=null,this._sortX1=0,this._sortX2=0,this._sortY1=0,this._sortY2=0,this._container=null,this._containingBlock=null,this._dragStartEvent=null,this._dragEndEvent=null,this._dragMoveEvent=null,this._dragPrevMoveEvent=null,this._scrollEvent=null,this._translateX=0,this._translateY=0,this._clientX=0,this._clientY=0,this._scrollDiffX=0,this._scrollDiffY=0,this._moveDiffX=0,this._moveDiffY=0,this._containerDiffX=0,this._containerDiffY=0,this._preStartCheck=this._preStartCheck.bind(this),this._preEndCheck=this._preEndCheck.bind(this),this._onScroll=this._onScroll.bind(this),this._prepareStart=this._prepareStart.bind(this),this._applyStart=this._applyStart.bind(this),this._prepareMove=this._prepareMove.bind(this),this._applyMove=this._applyMove.bind(this),this._prepareScroll=this._prepareScroll.bind(this),this._applyScroll=this._applyScroll.bind(this),this._handleSort=this._handleSort.bind(this),this._handleSortDelayed=this._handleSortDelayed.bind(this),this.dragger=new Dragger("string"==typeof s.dragHandle&&e.querySelector(s.dragHandle)||e,s.dragCssProps,s.dragEventListenerOptions),this.dragger.on("start",this._preStartCheck),this.dragger.on("move",this._preStartCheck),this.dragger.on("cancel",this._preEndCheck),this.dragger.on("end",this._preEndCheck)}isActive(){return this._isActive}getOriginGrid(){return GRID_INSTANCES.get(this._originGridId)||null}stop(){if(!this.item||!this.isActive())return;if(this._isMigrated)return void this._finishMigration();const{item:t}=this;if(ItemDrag.autoScroll.removeItem(t),cancelDragStartTick(t.id),cancelDragMoveTick(t.id),cancelDragScrollTick(t.id),this._cancelSort(),this._isStarted){const e=t.element,i=t.getGrid(),{itemDraggingClass:s}=i.settings;this._unbindScrollHandler(),e.parentNode!==i.element&&(i.element.appendChild(e),t._setTranslate(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY),t._containerDiffX=this._containerDiffX=0,t._containerDiffY=this._containerDiffY=0,s&&e.clientWidth),removeClass(e,s)}this._reset()}sort(t=!1){this.item&&this.isActive()&&this.item.isActive()&&this._dragMoveEvent&&(t?this._handleSort():addDragSortTick(this.item.id,this._handleSort))}destroy(){this.item&&(this._isMigrated=!1,this.stop(),this.dragger.destroy(),this.item=null)}_startPredicate(t,e){const{dragStartPredicate:i}=t.getGrid().settings;return isFunction(i)?i(t,e):ItemDrag.defaultStartPredicate(t,e)}_reset(){this._isActive=!1,this._isStarted=!1,this._container=null,this._containingBlock=null,this._dragStartEvent=null,this._dragEndEvent=null,this._dragMoveEvent=null,this._dragPrevMoveEvent=null,this._scrollEvent=null,this._translateX=0,this._translateY=0,this._clientX=0,this._clientY=0,this._scrollDiffX=0,this._scrollDiffY=0,this._moveDiffX=0,this._moveDiffY=0,this._containerDiffX=0,this._containerDiffY=0}_bindScrollHandler(){window.addEventListener("scroll",this._onScroll,SCROLL_LISTENER_OPTIONS$1)}_unbindScrollHandler(){window.removeEventListener("scroll",this._onScroll,SCROLL_LISTENER_OPTIONS$1)}_resetHeuristics(t,e){this._blockedSortIndex=null,this._sortX1=this._sortX2=t,this._sortY1=this._sortY2=e}_checkHeuristics(t,e){if(!this.item)return!1;const{settings:i}=this.item.getGrid(),{minDragDistance:s,minBounceBackAngle:n}=i.dragSortHeuristics;if(s<=0)return this._blockedSortIndex=null,!0;const r=t-this._sortX2,o=e-this._sortY2,a=s>3&&n>0;if(a||(this._blockedSortIndex=null),Math.abs(r)>s||Math.abs(o)>s){if(a){const t=Math.atan2(r,o),e=Math.atan2(this._sortX2-this._sortX1,this._sortY2-this._sortY1),i=Math.atan2(Math.sin(t-e),Math.cos(t-e));Math.abs(i)>n&&(this._blockedSortIndex=null)}return this._sortX1=this._sortX2,this._sortY1=this._sortY2,this._sortX2=t,this._sortY2=e,!0}return!1}_resetDefaultStartPredicate(){const{_startPredicateData:t}=this;t&&(t.delayTimer&&(t.delayTimer=void window.clearTimeout(t.delayTimer)),this._startPredicateData=null)}_handleSort(){if(!this.item||!this.isActive())return;const{item:t}=this,{dragSort:e,dragSortHeuristics:i,dragAutoScroll:s}=t.getGrid().settings;if(!e||!s.sortDuringScroll&&ItemDrag.autoScroll.isItemScrolling(t))return this._sortX1=this._sortX2=this._translateX-t._containerDiffX,this._sortY1=this._sortY2=this._translateY-t._containerDiffY,this._isSortNeeded=!0,void(void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)));const n=this._checkHeuristics(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY);if(!this._isSortNeeded&&!n)return;const r=i.sortInterval;r<=0||this._isSortNeeded?(this._isSortNeeded=!1,void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)),this._checkOverlap()):void 0===this._sortTimer&&(this._sortTimer=window.setTimeout(this._handleSortDelayed,r))}_handleSortDelayed(){this.item&&(this._isSortNeeded=!0,this._sortTimer=void 0,addDragSortTick(this.item.id,this._handleSort))}_cancelSort(){this.item&&(this._isSortNeeded=!1,void 0!==this._sortTimer&&(this._sortTimer=void window.clearTimeout(this._sortTimer)),cancelDragSortTick(this.item.id))}_finishSort(){if(!this.item)return;const{dragSort:t}=this.item.getGrid().settings,e=t&&(this._isSortNeeded||void 0!==this._sortTimer);this._cancelSort(),e&&this._checkOverlap(),t&&this._checkOverlap(!0)}_checkOverlap(t=!1){if(!this.item||!this.isActive())return;const{item:e}=this,i=e.element,s=e.getGrid(),{settings:n}=s;let r=null;if(isFunction(n.dragSortPredicate)?r=n.dragSortPredicate(e,t?this._dragEndEvent:this._dragMoveEvent):t||(r=ItemDrag.defaultSortPredicate(e,n.dragSortPredicate)),!r||"number"!=typeof r.index)return;const o="swap"===r.action?"swap":"move",a=r.grid||s,l=s!==a,h=s.items.indexOf(e),c=normalizeArrayIndex(a.items,r.index,l&&"move"===o?1:0);if(l||c!==this._blockedSortIndex)if(l){this._blockedSortIndex=null;const t=a.items[c],r=a.settings;if(s._hasListeners("beforeSend")&&s._emit("beforeSend",{item:e,fromGrid:s,fromIndex:h,toGrid:a,toIndex:c}),a._hasListeners("beforeReceive")&&a._emit("beforeReceive",{item:e,fromGrid:s,fromIndex:h,toGrid:a,toIndex:c}),!this.isActive()||s.isDestroyed()||a.isDestroyed())return;e._gridId=a.id,this._isMigrated=e._gridId!==this._originGridId,s.items.splice(h,1),arrayInsert(a.items,e,c),e._sortData=null;const l=this._container,d=this._containingBlock,_=r.dragContainer||a.element,u=getContainingBlock(_);let g=getOffsetDiff(u,getContainingBlock(a.element));e._containerDiffX=this._containerDiffX=g.left,e._containerDiffY=this._containerDiffY=g.top,_!==l&&(g=getOffsetDiff(d,u),this._container=_,this._containingBlock=u,this._translateX-=g.left,this._translateY-=g.top,_.appendChild(i),e._setTranslate(this._translateX,this._translateY)),n.itemClass!==r.itemClass&&(removeClass(i,n.itemClass),addClass(i,r.itemClass)),n.itemDraggingClass!==r.itemDraggingClass&&(removeClass(i,n.itemDraggingClass),addClass(i,r.itemDraggingClass)),e.isActive()?(n.itemVisibleClass!==r.itemVisibleClass&&(removeClass(i,n.itemVisibleClass),addClass(i,r.itemVisibleClass)),e._visibility.setStyles(r.visibleStyles)):(n.itemHiddenClass!==r.itemHiddenClass&&(removeClass(i,n.itemHiddenClass),addClass(i,r.itemHiddenClass)),e._visibility.setStyles(r.hiddenStyles)),e._dragPlaceholder.updateClassName(r.itemPlaceholderClass),e._updateDimensions(),s._hasListeners("send")&&s._emit("send",{item:e,fromGrid:s,fromIndex:h,toGrid:a,toIndex:c}),a._hasListeners("receive")&&a._emit("receive",{item:e,fromGrid:s,fromIndex:h,toGrid:a,toIndex:c}),"swap"===o&&t&&t.isActive()&&a.items.indexOf(t)>-1&&a.send(t,s,h,{appendTo:l||document.body,layoutSender:!1,layoutReceiver:!1}),s.layout(),a.layout()}else h!==c&&(this._blockedSortIndex=h,("swap"===o?arraySwap:arrayMove)(s.items,h,c),s._hasListeners("move")&&s._emit("move",{item:e,fromIndex:h,toIndex:c,action:o}),s.layout())}_finishMigration(){if(!this.item)return;const{item:t}=this,{dragEnabled:e}=t.getGrid().settings;this.destroy(),t._drag=e?new ItemDrag(t):null,t._dragRelease.start()}_preStartCheck(t){if(0===this._startPredicateState&&(this._startPredicateState=1),1===this._startPredicateState){const e=this._startPredicate(this.item,t);!0===e?(this._startPredicateState=2,this._onStart(t)):!1===e&&(this._startPredicateState=0,this.dragger.reset())}else 2===this._startPredicateState&&this.isActive()&&this._onMove(t)}_preEndCheck(t){const e=2===this._startPredicateState;this._startPredicate(this.item,t),this._resetDefaultStartPredicate(),this._startPredicateState=0,e&&this.isActive()&&(this._isStarted?this._onEnd(t):this.stop())}_onStart(t){this.item&&this.item.isActive()&&(this._isActive=!0,this._dragStartEvent=t,ItemDrag.autoScroll.addItem(this.item,this._translateX,this._translateY),addDragStartTick(this.item.id,this._prepareStart,this._applyStart))}_prepareStart(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.element,i=t.getGrid(),s=i.settings.dragContainer||i.element,n=getContainingBlock(s),r=t._getTranslate(),o=e.getBoundingClientRect();if(this._container=s,this._containingBlock=n,this._clientX=o.left,this._clientY=o.top,this._translateX=r.x,this._translateY=r.y,this._scrollDiffX=this._scrollDiffY=0,this._moveDiffX=this._moveDiffY=0,this._containerDiffX=this._containerDiffY=0,s!==i.element){const{left:t,top:e}=getOffsetDiff(n,i.element);this._containerDiffX=t,this._containerDiffY=e}this._resetHeuristics(this._translateX-t._containerDiffX,this._translateY-t._containerDiffY)}_applyStart(){if(!this.item||!this.isActive())return;const{item:t}=this;if(!t.isActive())return;t.isPositioning()&&t._layout.stop(!0,this._translateX,this._translateY);const e=t._migrate;e.isActive()&&(this._translateX-=t._containerDiffX,this._translateY-=t._containerDiffY,e.stop(!0,this._translateX,this._translateY));const i=t._dragRelease;t.isReleasing()&&i.reset();const s=t.getGrid(),n=t.element;s.settings.dragPlaceholder.enabled&&t._dragPlaceholder.create(),this._isStarted=!0,this._dragStartEvent&&s._emit("dragInit",t,this._dragStartEvent),n.parentNode!==this._container&&(this._translateX+=this._containerDiffX,this._translateY+=this._containerDiffY,this._container.appendChild(n),t._setTranslate(this._translateX,this._translateY)),t._containerDiffX=this._containerDiffX,t._containerDiffY=this._containerDiffY,addClass(n,s.settings.itemDraggingClass),this._bindScrollHandler(),this._dragStartEvent&&s._emit("dragStart",t,this._dragStartEvent)}_onMove(t){if(!this.item)return;if(!this.item.isActive())return void this.stop();const e=this.item.id;this._dragMoveEvent=t,addDragMoveTick(e,this._prepareMove,this._applyMove),addDragSortTick(e,this._handleSort)}_prepareMove(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{dragAxis:t}=this.item.getGrid().settings,e=this._dragMoveEvent,i=this._dragPrevMoveEvent||this._dragStartEvent||e;if("y"!==t){const t=e.clientX-i.clientX;this._translateX=this._translateX-this._moveDiffX+t,this._clientX=this._clientX-this._moveDiffX+t,this._moveDiffX=t}if("x"!==t){const t=e.clientY-i.clientY;this._translateY=this._translateY-this._moveDiffY+t,this._clientY=this._clientY-this._moveDiffY+t,this._moveDiffY=t}this._dragPrevMoveEvent=e}_applyMove(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();this._moveDiffX=this._moveDiffY=0,t._setTranslate(this._translateX,this._translateY),this._dragMoveEvent&&e._emit("dragMove",t,this._dragMoveEvent),ItemDrag.autoScroll.updateItem(t,this._translateX,this._translateY)}_onScroll(t){if(!this.item)return;if(!this.item.isActive())return void this.stop();const e=this.item.id;this._scrollEvent=t,addDragScrollTick(e,this._prepareScroll,this._applyScroll),addDragSortTick(e,this._handleSort)}_prepareScroll(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();if(this._container!==e.element){const{left:i,top:s}=getOffsetDiff(this._containingBlock,e.element);t._containerDiffX=this._containerDiffX=i,t._containerDiffY=this._containerDiffY=s}const{dragAxis:i}=e.settings,{left:s,top:n}=t.element.getBoundingClientRect();if("y"!==i){const t=this._clientX-this._moveDiffX-this._scrollDiffX-s;this._translateX=this._translateX-this._scrollDiffX+t,this._scrollDiffX=t}if("x"!==i){const t=this._clientY-this._moveDiffY-this._scrollDiffY-n;this._translateY=this._translateY-this._scrollDiffY+t,this._scrollDiffY=t}}_applyScroll(){if(!this.item||!this.isActive()||!this.item.isActive())return;const{item:t}=this,e=t.getGrid();this._scrollDiffX=this._scrollDiffY=0,t._setTranslate(this._translateX,this._translateY),this._scrollEvent&&e._emit("dragScroll",t,this._scrollEvent)}_onEnd(t){if(!this.item)return;const{item:e}=this;if(!e.isActive())return void this.stop();const i=e.getGrid();this._dragEndEvent=t,cancelDragStartTick(e.id),cancelDragMoveTick(e.id),cancelDragScrollTick(e.id),this._finishSort(),this._unbindScrollHandler(),this._reset(),removeClass(e.element,i.settings.itemDraggingClass),ItemDrag.autoScroll.removeItem(e),i._emit("dragEnd",e,t),this._isMigrated?this._finishMigration():e._dragRelease.start()}}function createTranslate(t,e,i=!1){return i?"translate3d("+t+"px, "+e+"px, 0px)":"translateX("+t+"px) translateY("+e+"px)"}ItemDrag.autoScroll=new AutoScroller,ItemDrag.defaultStartPredicate=defaultStartPredicate,ItemDrag.defaultSortPredicate=defaultSortPredicate;const translateValue={x:0,y:0},transformNone="none",rxMat3d=/^matrix3d/,rxMatTx=/([^,]*,){4}/,rxMat3dTx=/([^,]*,){12}/,rxNextItem=/[^,]*,/;function getTranslate(t){translateValue.x=0,translateValue.y=0;const e=getStyle(t,transformStyle);if(!e||"none"===e)return translateValue;const i=rxMat3d.test(e),s=e.replace(i?rxMat3dTx:rxMatTx,""),n=s.replace(rxNextItem,"");return translateValue.x=parseFloat(s)||0,translateValue.y=parseFloat(n)||0,translateValue}const CURRENT_STYLES$1={},TARGET_STYLES$1={};class ItemDragPlaceholder{constructor(t){this.item=t,this.element=null,this.animator=new Animator,this.left=0,this.top=0,this._className="",this._didMigrate=!1,this._resetAfterLayout=!1,this._transX=0,this._transY=0,this._nextTransX=0,this._nextTransY=0,this._setupAnimation=this._setupAnimation.bind(this),this._startAnimation=this._startAnimation.bind(this),this._updateDimensions=this._updateDimensions.bind(this),this._onLayoutStart=this._onLayoutStart.bind(this),this._onLayoutEnd=this._onLayoutEnd.bind(this),this._onReleaseEnd=this._onReleaseEnd.bind(this),this._onMigrate=this._onMigrate.bind(this),this._onHide=this._onHide.bind(this)}create(){if(!this.item)return;if(this.element)return void(this._resetAfterLayout=!1);const{item:t}=this,e=t.getGrid(),{settings:i}=e;let s;this.left=t.left,this.top=t.top,s=isFunction(i.dragPlaceholder.createElement)?i.dragPlaceholder.createElement(t):document.createElement("div"),this.element=s,this.animator.element=s,this._className=i.itemPlaceholderClass||"",this._className&&addClass(s,this._className),setStyles(s,{position:"absolute",left:"0px",top:"0px",width:t.width+"px",height:t.height+"px"}),s.style[transformProp]=createTranslate(t.left+t.marginLeft,t.top+t.marginTop,i.translate3d),e.on("layoutStart",this._onLayoutStart),e.on("dragReleaseEnd",this._onReleaseEnd),e.on("beforeSend",this._onMigrate),e.on("hideStart",this._onHide),isFunction(i.dragPlaceholder.onCreate)&&i.dragPlaceholder.onCreate(t,s),e.element.appendChild(s)}reset(){var t;if(!this.item||!this.element)return;const{item:e,element:i,animator:s}=this,n=e.getGrid();this._resetAfterLayout=!1,cancelPlaceholderLayoutTick(e.id),cancelPlaceholderResizeTick(e.id),s.stop(),s.element=null,n.off("dragReleaseEnd",this._onReleaseEnd),n.off("layoutStart",this._onLayoutStart),n.off("beforeSend",this._onMigrate),n.off("hideStart",this._onHide),this._className&&(removeClass(i,this._className),this._className=""),null===(t=i.parentNode)||void 0===t||t.removeChild(i),this.element=null;const{onRemove:r}=n.settings.dragPlaceholder;isFunction(r)&&r(e,i)}isActive(){return!!this.element}updateDimensions(){this.item&&this.isActive()&&addPlaceholderResizeTick(this.item.id,this._updateDimensions)}updateClassName(t){this.element&&(removeClass(this.element,this._className),this._className=t,addClass(this.element,t))}destroy(){this.reset(),this.animator&&this.animator.destroy(),this.item=null}_updateDimensions(){this.item&&this.element&&setStyles(this.element,{width:this.item.width+"px",height:this.item.height+"px"})}_onLayoutStart(t,e){if(!this.item||!this.element)return;const{item:i}=this;if(-1===t.indexOf(i))return void this.reset();const s=i.left,n=i.top,r=this.left,o=this.top;if(this.left=s,this.top=n,!e&&!this._didMigrate&&r===s&&o===n)return;const a=s+i.marginLeft,l=n+i.marginTop,h=i.getGrid();if(!(!e&&h.settings.layoutDuration>0)||this._didMigrate)return cancelPlaceholderLayoutTick(i.id),this.element.style[transformProp]=createTranslate(a,l,h.settings.translate3d),this.animator.stop(),void(this._didMigrate&&(h.element.appendChild(this.element),this._didMigrate=!1));this.animator.animation&&(this.animator.animation.onfinish=null),this._nextTransX=a,this._nextTransY=l,addPlaceholderLayoutTick(i.id,this._setupAnimation,this._startAnimation)}_setupAnimation(){if(!this.element)return;const{x:t,y:e}=getTranslate(this.element);this._transX=t,this._transY=e}_startAnimation(){if(!this.item||!this.element)return;const{animator:t}=this,e=this._transX,i=this._transY,s=this._nextTransX,n=this._nextTransY,{layoutDuration:r,layoutEasing:o,translate3d:a}=this.item.getGrid().settings;e!==s||i!==n?(CURRENT_STYLES$1[transformProp]=createTranslate(e,i,a),TARGET_STYLES$1[transformProp]=createTranslate(s,n,a),t.start(CURRENT_STYLES$1,TARGET_STYLES$1,{duration:r,easing:o,onFinish:this._onLayoutEnd})):t.isAnimating()&&(this.element.style[transformProp]=createTranslate(s,n,a),t.stop())}_onLayoutEnd(){this._resetAfterLayout&&this.reset()}_onReleaseEnd(t){if(this.item&&this.item.id===t.id){if(!this.animator.isAnimating())return void this.reset();this._resetAfterLayout=!0}}_onMigrate(t){if(!this.item||this.item!==t.item)return;const e=this.item.getGrid();e.off("dragReleaseEnd",this._onReleaseEnd),e.off("layoutStart",this._onLayoutStart),e.off("beforeSend",this._onMigrate),e.off("hideStart",this._onHide);const i=t.toGrid;i.on("dragReleaseEnd",this._onReleaseEnd),i.on("layoutStart",this._onLayoutStart),i.on("beforeSend",this._onMigrate),i.on("hideStart",this._onHide),this._didMigrate=!0}_onHide(t){this.item&&t.indexOf(this.item)>-1&&this.reset()}}const SCROLL_LISTENER_OPTIONS=!HAS_PASSIVE_EVENTS||{capture:!0,passive:!0};class ItemDragRelease{constructor(t){this.item=t,this._isActive=!1,this._isPositioning=!1,this._onScroll=this._onScroll.bind(this)}isActive(){return this._isActive}isPositioning(){return this._isPositioning}start(){if(!this.item||this.isActive())return;const{item:t}=this,e=t.getGrid(),{settings:i}=e;this._isActive=!0,addClass(t.element,i.itemReleasingClass),i.dragRelease.useDragContainer?t.element.parentNode!==e.element&&window.addEventListener("scroll",this._onScroll,SCROLL_LISTENER_OPTIONS):this._placeToGrid(),e._emit("dragReleaseStart",t),e._nextLayoutData||t._layout.start(!1)}stop(t=!1,e,i){if(!this.item||!this.isActive())return;const{item:s}=this;t||void 0!==e&&void 0!==i||(e=s.left,i=s.top);const n=this._placeToGrid(e,i);if(this.reset(n),!t){s.getGrid()._emit("dragReleaseEnd",s)}}reset(t=!1){if(!this.item)return;const{item:e}=this,{itemReleasingClass:i}=e.getGrid().settings;this._isActive=!1,this._isPositioning=!1,cancelReleaseScrollTick(e.id),window.removeEventListener("scroll",this._onScroll,SCROLL_LISTENER_OPTIONS),i&&(t&&e.element.clientWidth,removeClass(e.element,i))}destroy(){this.item&&(this.stop(!0),this.item=null)}_placeToGrid(t,e){if(!this.item)return!1;const{item:i}=this,s=i.getGrid().element;if(i.element.parentNode!==s){if(void 0===t||void 0===e){const{x:s,y:n}=i._getTranslate();t=s-i._containerDiffX,e=n-i._containerDiffY}return s.appendChild(i.element),i._setTranslate(t,e),i._containerDiffX=0,i._containerDiffY=0,!0}return!1}_onScroll(){if(!this.item||!this.isActive())return;const{item:t}=this;let e=0,i=0;addReleaseScrollTick(t.id,(()=>{if(!this.isActive())return;const s=t.element.parentNode;if(s){const n=t.getGrid().element,{left:r,top:o}=getOffsetDiff(s,n,!0);e=r,i=o}}),(()=>{this.isActive()&&(Math.abs(e-t._containerDiffX)>.1||Math.abs(i-t._containerDiffY)>.1)&&(t._containerDiffX=e,t._containerDiffY=i,t._dragPlaceholder.reset(),t._layout.stop(!0,t.left,t.top),this.stop(!1,t.left,t.top))}))}}const MIN_ANIMATION_DISTANCE=2,CURRENT_STYLES={},TARGET_STYLES={},ANIM_OPTIONS={duration:0,easing:"",onFinish:void 0};class ItemLayout{constructor(t){this.item=t,this.animator=new Animator(t.element),this._skipNextAnimation=!1,this._isActive=!1,this._isInterrupted=!1,this._easing="",this._duration=0,this._tX=0,this._tY=0,this._queue="layout-"+t.id,this._setupAnimation=this._setupAnimation.bind(this),this._startAnimation=this._startAnimation.bind(this),this._finish=this._finish.bind(this);const{style:e}=t.element;e.left="0px",e.top="0px",this.item._setTranslate(0,0)}isActive(){return this._isActive}start(t,e){if(!this.item)return;const{item:i,animator:s}=this,n=i.getGrid(),r=i._dragRelease,{settings:o}=n,a=this.isActive(),l=r.isActive()&&!r.isPositioning(),h=l?o.dragRelease.duration:o.layoutDuration,c=l?o.dragRelease.easing:o.layoutEasing,d=!t&&!this._skipNextAnimation&&h>0;if(a&&(cancelLayoutTick(i.id),i._emitter.emit(this._queue,!0,i)),l&&(r._isPositioning=!0),e&&isFunction(e)&&i._emitter.once(this._queue,e),this._skipNextAnimation=!1,!d)return i._setTranslate(i.left+i._containerDiffX,i.top+i._containerDiffY),s.stop(),void this._finish();s.animation&&(s.animation.onfinish=null),n._layoutNeedsDimensionsRefresh=!0,this._isActive=!0,this._easing=c,this._duration=h,this._isInterrupted=a,addLayoutTick(i.id,this._setupAnimation,this._startAnimation)}stop(t,e,i){if(!this.item||!this.isActive())return;const{item:s}=this;if(cancelLayoutTick(s.id),this.animator.isAnimating()){if(void 0===e||void 0===i){const{x:t,y:e}=getTranslate(s.element);s._setTranslate(t,e)}else s._setTranslate(e,i);this.animator.stop()}const{itemPositioningClass:n}=s.getGrid().settings;removeClass(s.element,n),this._isActive=!1,t&&s._emitter.emit(this._queue,!0,s)}destroy(){if(!this.item)return;this.stop(!0,0,0),this.item._emitter.off(this._queue),this.animator.destroy();const{style:t}=this.item.element;t[transformProp]="",t.left="",t.top="",this.item=null}_finish(){if(!this.item)return;const{item:t}=this;if(t._translateX=t.left+t._containerDiffX,t._translateY=t.top+t._containerDiffY,this.isActive()){this._isActive=!1;const{itemPositioningClass:e}=t.getGrid().settings;removeClass(t.element,e)}t._dragRelease.isActive()&&t._dragRelease.stop(),t._migrate.isActive()&&t._migrate.stop(),t._emitter.emit(this._queue,!1,t)}_setupAnimation(){if(!this.item||!this.isActive())return;const{item:t}=this,{x:e,y:i}=t._getTranslate();this._tX=e,this._tY=i;const s=t.getGrid();s.settings._animationWindowing&&s._layoutNeedsDimensionsRefresh&&(s._layoutNeedsDimensionsRefresh=!1,s._updateBoundingRect(),s._updateBorders(!0,!1,!0,!1))}_startAnimation(){if(!this.item||!this.isActive())return;const{item:t}=this,{settings:e}=t.getGrid(),i=this._duration<=0,s=t.left+t._containerDiffX,n=t.top+t._containerDiffY,r=Math.abs(t.left-(this._tX-t._containerDiffX)),o=Math.abs(t.top-(this._tY-t._containerDiffY));if(i||r<2&&o<2||e._animationWindowing&&!t._isInViewport(this._tX,this._tY,100)&&!t._isInViewport(s,n,100))return(this._isInterrupted||r>.1||o>.1)&&t._setTranslate(s,n),this.animator.stop(),void this._finish();this._isInterrupted||addClass(t.element,e.itemPositioningClass),CURRENT_STYLES[transformProp]=createTranslate(this._tX,this._tY,e.translate3d),TARGET_STYLES[transformProp]=createTranslate(s,n,e.translate3d),ANIM_OPTIONS.duration=this._duration,ANIM_OPTIONS.easing=this._easing,ANIM_OPTIONS.onFinish=this._finish,t._translateX=t._translateY=void 0,this.animator.start(CURRENT_STYLES,TARGET_STYLES,ANIM_OPTIONS),ANIM_OPTIONS.onFinish=void 0}}class ItemMigrate{constructor(t){this.item=t,this.container=null,this._isActive=!1}isActive(){return this._isActive}start(t,e,i){if(!this.item)return;const s=this.item,n=s.getGrid(),r=s.element,o=s.isActive(),a=s.isVisible(),l=n.settings,h=n.items.indexOf(s),c=t.element,d=t.settings,_=t.items,u=i||document.body;let g=0;if("number"==typeof e)g=normalizeArrayIndex(_,e,1);else{const i=t.getItem(e);if(!i)return;g=_.indexOf(i)}if(s._drag&&s._drag.stop(),this.isActive()||s.isPositioning()||s.isReleasing()){let{x:t,y:e}=s._getTranslate();s.isPositioning()&&s._layout.stop(!0,t,e),t-=s._containerDiffX,e-=s._containerDiffY,this.isActive()?this.stop(!0,t,e):s.isReleasing()&&s._dragRelease.stop(!0,t,e)}if(s._visibility.stop(!0),n._hasListeners("beforeSend")&&n._emit("beforeSend",{item:s,fromGrid:n,fromIndex:h,toGrid:t,toIndex:g}),t._hasListeners("beforeReceive")&&t._emit("beforeReceive",{item:s,fromGrid:n,fromIndex:h,toGrid:t,toIndex:g}),s.isDestroyed()||n.isDestroyed()||t.isDestroyed())return;s._drag&&(s._drag.destroy(),s._drag=null),l.itemClass!==d.itemClass&&(removeClass(r,l.itemClass),addClass(r,d.itemClass));const m=a?l.itemVisibleClass:l.itemHiddenClass,f=a?d.itemVisibleClass:d.itemHiddenClass;if(m!==f&&(removeClass(r,m),addClass(r,f)),n.items.splice(h,1),arrayInsert(_,s,g),s._gridId=t.id,o){const t=r.parentNode;if(u!==t){u.appendChild(r);const e=getOffsetDiff(u,t,!0),i=s._getTranslate();s._setTranslate(i.x+e.left,i.y+e.top)}}else c.appendChild(r);if(s._visibility.setStyles(a?d.visibleStyles:d.hiddenStyles),o){const{left:t,top:e}=getOffsetDiff(u,c,!0);s._containerDiffX=t,s._containerDiffY=e}s._updateDimensions(),s._sortData=null,d.dragEnabled&&(s._drag=new ItemDrag(s)),o?(this._isActive=!0,this.container=u):(this._isActive=!1,this.container=null),n._hasListeners("send")&&n._emit("send",{item:s,fromGrid:n,fromIndex:h,toGrid:t,toIndex:g}),t._hasListeners("receive")&&t._emit("receive",{item:s,fromGrid:n,fromIndex:h,toGrid:t,toIndex:g})}stop(t=!1,e,i){if(!this.item||!this.isActive())return;const{item:s}=this,n=s.getGrid();if(this.container!==n.element){if(void 0===e||void 0===i)if(t){const t=s._getTranslate();e=t.x-s._containerDiffX,i=t.y-s._containerDiffY}else e=s.left,i=s.top;n.element.appendChild(s.element),s._setTranslate(e,i),s._containerDiffX=0,s._containerDiffY=0}this._isActive=!1,this.container=null}destroy(){this.item&&(this.stop(!0),this.item=null)}}function getCurrentStyles(t,e){const i={};let s;if(Array.isArray(e)){let n=0;for(;n<e.length;n++)s=e[n],i[s]=getStyle(t,getStyleName(s))}else for(s in e)i[s]=getStyle(t,getStyleName(s));return i}class ItemVisibility{constructor(t){const e=t.element.children[0];if(!e)throw new Error("No valid child element found within item element.");const i=t.isActive();this.item=t,this.element=e,this.animator=new Animator(e),this._isHidden=!i,this._isHiding=!1,this._isShowing=!1,this._currentStyleProps=[],this._queue="visibility-"+t.id,this._finishShow=this._finishShow.bind(this),this._finishHide=this._finishHide.bind(this),t.element.style.display=i?"":"none";const{settings:s}=t.getGrid();addClass(t.element,i?s.itemVisibleClass:s.itemHiddenClass),this.setStyles(i?s.visibleStyles:s.hiddenStyles)}isHidden(){return this._isHidden}isHiding(){return this._isHiding}isShowing(){return this._isShowing}show(t,e){if(!this.item)return;const{item:i}=this,s=isFunction(e)?e:null;if(this._isShowing||this._isHidden)if(!this._isShowing||t){if(!this._isShowing){i._emitter.emit(this._queue,!0,i);const{settings:t}=i.getGrid();t&&(removeClass(i.element,t.itemHiddenClass),addClass(i.element,t.itemVisibleClass)),this._isHiding||(i.element.style.display="")}s&&i._emitter.once(this._queue,s),this._isShowing=!0,this._isHiding=this._isHidden=!1,this._startAnimation(!0,t,this._finishShow)}else s&&i._emitter.once(this._queue,s);else s&&s(!1,i)}hide(t,e){if(!this.item)return;const{item:i}=this,s=isFunction(e)?e:null;if(this._isHiding||!this._isHidden)if(!this._isHiding||t){if(!this._isHiding){i._emitter.emit(this._queue,!0,i);const{settings:t}=i.getGrid();addClass(i.element,t.itemHiddenClass),removeClass(i.element,t.itemVisibleClass)}s&&i._emitter.once(this._queue,s),this._isHidden=this._isHiding=!0,this._isShowing=!1,this._startAnimation(!1,t,this._finishHide)}else s&&i._emitter.once(this._queue,s);else s&&s(!1,i)}stop(t){if(!this.item||!this._isHiding&&!this._isShowing)return;const{item:e}=this;cancelVisibilityTick(e.id),this.animator.stop(),t&&e._emitter.emit(this._queue,!0,e)}setStyles(t){if(!this.element)return;const{element:e,_currentStyleProps:i}=this;let s;for(s in this._removeCurrentStyles(),t)i.push(s),e.style[s]=t[s]}destroy(){if(!this.item)return;const{item:t}=this,e=t.element,{settings:i}=t.getGrid();this.stop(!0),t._emitter.off(this._queue),this.animator.destroy(),this._removeCurrentStyles(),i&&(removeClass(e,i.itemVisibleClass),removeClass(e,i.itemHiddenClass)),e.style.display="",this._isHiding=this._isShowing=!1,this._isHidden=!0,this.item=null}_startAnimation(t,e,i){if(!this.item||!this.element)return;const{item:s,element:n,animator:r}=this,o=s.getGrid(),{settings:a}=o,l=t?a.visibleStyles:a.hiddenStyles,h=t?a.showDuration:a.hideDuration,c=t?a.showEasing:a.hideEasing,d=e||h<=0;if(!l)return r.stop(),void(i&&i());if(cancelVisibilityTick(s.id),d)return setStyles(n,l),r.stop(),void(i&&i());let _;r.animation&&(r.animation.onfinish=null);let u=0,g=0;o._visibilityNeedsDimensionsRefresh=!0,addVisibilityTick(s.id,(()=>{if(!this.item||(t?!this._isShowing:!this._isHiding))return;_=getCurrentStyles(n,l);const{x:e,y:i}=s._getTranslate();u=e,g=i,a._animationWindowing&&o._visibilityNeedsDimensionsRefresh&&(o._visibilityNeedsDimensionsRefresh=!1,o._updateBoundingRect(),o._updateBorders(!0,!1,!0,!1))}),(()=>{if(this.item&&(t?this._isShowing:this._isHiding))return!a._animationWindowing||s._isInViewport(u,g,100)||s.isActive()&&s._isInViewport(s.left+s._containerDiffX,s.top+s._containerDiffY,100)?void(_&&r.start(_,l,{duration:h,easing:c,onFinish:i})):(setStyles(n,l),r.stop(),void(i&&i()))}))}_finishShow(){this.item&&!this._isHidden&&(this._isShowing=!1,this.item._emitter.emit(this._queue,!1,this.item))}_finishHide(){if(!this.item||!this._isHidden)return;const{item:t}=this;this._isHiding=!1,t._layout.stop(!0,0,0),t.element.style.display="none",t._emitter.emit(this._queue,!1,t)}_removeCurrentStyles(){if(!this.element)return;const{element:t,_currentStyleProps:e}=this;let i=0;for(;i<e.length;i++)t.style[e[i]]="";e.length=0}}let id=0;function createUid(){return++id}const windowSize={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",(function(){windowSize.width=window.innerWidth,windowSize.height=window.innerHeight}));const targetRect={left:0,top:0,width:0,height:0},viewportRect={left:0,top:0,width:0,height:0};function isInViewport(t,e,i,s,n){return n=n||0,targetRect.left=i,targetRect.top=s,targetRect.width=t,targetRect.height=e,viewportRect.left=0-n,viewportRect.top=0-n,viewportRect.width=windowSize.width+n+n,viewportRect.height=windowSize.height+n+n,isOverlapping(targetRect,viewportRect)}const _getTranslateResult={x:0,y:0},_getClientRootPositionResult={left:0,top:0};class Item{constructor(t,e,i){const{settings:s,element:n,id:r}=t;if(ITEM_ELEMENT_MAP){if(ITEM_ELEMENT_MAP.has(e))throw new Error("You can only create one Muuri Item per element!");ITEM_ELEMENT_MAP.set(e,this)}this.id=createUid(),this.element=e,this.left=0,this.top=0,this.width=0,this.height=0,this.marginLeft=0,this.marginRight=0,this.marginTop=0,this.marginBottom=0,this._gridId=r,this._isDestroyed=!1,this._translateX=void 0,this._translateY=void 0,this._containerDiffX=0,this._containerDiffY=0,this._sortData=null,this._emitter=new Emitter,n&&e.parentNode!==n&&n.appendChild(e),addClass(e,s.itemClass),"boolean"!=typeof i&&(i="none"!==getStyle(e,"display")),this._isActive=i,this._visibility=new ItemVisibility(this),this._layout=new ItemLayout(this),this._migrate=new ItemMigrate(this),this._drag=s.dragEnabled?new ItemDrag(this):null,this._dragRelease=new ItemDragRelease(this),this._dragPlaceholder=new ItemDragPlaceholder(this)}getGrid(){return GRID_INSTANCES.get(this._gridId)||null}isActive(){return this._isActive}isVisible(){return!this._visibility.isHidden()}isShowing(){return!!this._visibility.isShowing()}isHiding(){return!!this._visibility.isHiding()}isPositioning(){return!!this._layout.isActive()}isDragging(){var t;return!!(null===(t=this._drag)||void 0===t?void 0:t.isActive())}isReleasing(){return!!this._dragRelease.isActive()}isDestroyed(){return this._isDestroyed}_updateDimensions(t){if(this._isDestroyed)return;if(!0!==t&&!this.isVisible()&&!this.isHiding())return;const e=this.element,{width:i,height:s}=e.getBoundingClientRect();this.width=i,this.height=s,this.marginLeft=Math.max(0,getStyleAsFloat(e,"margin-left")),this.marginRight=Math.max(0,getStyleAsFloat(e,"margin-right")),this.marginTop=Math.max(0,getStyleAsFloat(e,"margin-top")),this.marginBottom=Math.max(0,getStyleAsFloat(e,"margin-bottom")),this._dragPlaceholder.updateDimensions()}_updateSortData(){if(this._isDestroyed)return;const{settings:t}=this.getGrid(),{sortData:e}=t;if(this._sortData={},e){let t;for(t in e)this._sortData[t]=e[t](this,this.element)}}_addToLayout(t=0,e=0){this.isActive()||(this._isActive=!0,this.left=t,this.top=e)}_removeFromLayout(){this.isActive()&&(this._isActive=!1,this.left=0,this.top=0)}_canSkipLayout(t,e){return this.left===t&&this.top===e&&!this._migrate.isActive()&&!this._dragRelease.isActive()&&!this._layout._skipNextAnimation}_setTranslate(t,e){this._translateX===t&&this._translateY===e||(this._translateX=t,this._translateY=e,this.element.style[transformProp]=createTranslate(t,e,this.getGrid().settings.translate3d))}_getTranslate(){if(void 0===this._translateX||void 0===this._translateY){const t=getTranslate(this.element);_getTranslateResult.x=t.x,_getTranslateResult.y=t.y}else _getTranslateResult.x=this._translateX,_getTranslateResult.y=this._translateY;return _getTranslateResult}_getClientRootPosition(){const t=this.getGrid();return _getClientRootPositionResult.left=t._rect.left+t._borderLeft-this._containerDiffX,_getClientRootPositionResult.top=t._rect.top+t._borderTop-this._containerDiffY,_getClientRootPositionResult}_isInViewport(t,e,i=0){const s=this._getClientRootPosition();return isInViewport(this.width,this.height,s.left+this.marginLeft+t,s.top+this.marginTop+e,i||0)}_destroy(t=!1){var e;if(this._isDestroyed)return;const i=this.element,{settings:s}=this.getGrid();this._dragPlaceholder.destroy(),this._dragRelease.destroy(),this._migrate.destroy(),this._layout.destroy(),this._visibility.destroy(),this._drag&&this._drag.destroy(),this._emitter.off(),removeClass(i,s.itemClass),t&&(null===(e=i.parentNode)||void 0===e||e.removeChild(i)),ITEM_ELEMENT_MAP&&ITEM_ELEMENT_MAP.delete(i),this._isActive=!1,this._isDestroyed=!0}}function createPackerProcessor(t=!1){const e=1,i=2,s=4,n=8,r=16,o=.001,a=.5;function l(t){return((1e3*t+.5<<0)/10<<0)/100}const h=new class{constructor(){this._currentRects=[],this._nextRects=[],this._rectStore=[],this._slotSizes=[],this._shards=[],this._rectTarget={left:0,top:0,width:0,height:0},this._tempRectA={left:0,top:0,width:0,height:0},this._tempRectB={left:0,top:0,width:0,height:0},this._rectId=0,this._slotIndex=-1,this._slot={left:0,top:0,width:0,height:0},this._sortRectsLeftTop=this._sortRectsLeftTop.bind(this),this._sortRectsTopLeft=this._sortRectsTopLeft.bind(this)}computeLayout(t,o){const a=t.items;if(!a.length)return t;const h=t.slots,c=!!(o&e),d=!!(o&i),_=!!(o&s),u=!!(o&n),g=!!(o&r),m="number"==typeof a[0],f=m?2:1;let S,p,E=0,T=0,y=0;for(E=0;E<a.length;E+=f)m?(T=a[E],y=a[E+1]):(p=a[E],T=p.width+(p.marginLeft||0)+(p.marginRight||0),y=p.height+(p.marginTop||0)+(p.marginBottom||0)),g&&(T=l(T),y=l(y)),S=this._computeNextSlot(t,T,y,c,d),d?S.left+S.width>t.width&&(t.width=S.left+S.width):S.top+S.height>t.height&&(t.height=S.top+S.height),h[++this._slotIndex]=S.left,h[++this._slotIndex]=S.top,(_||u)&&this._slotSizes.push(S.width,S.height);if(_)for(E=0;E<h.length;E+=2)h[E]=t.width-(h[E]+this._slotSizes[E]);if(u)for(E=1;E<h.length;E+=2)h[E]=t.height-(h[E]+this._slotSizes[E]);return this._slotSizes.length=0,this._currentRects.length=0,this._nextRects.length=0,this._shards.length=0,this._rectId=0,this._slotIndex=-1,t}_computeNextSlot(t,e,i,s,n){const{_slot:r,_currentRects:l,_nextRects:h}=this;let c,d,_=!1,u=!1,g=0,m=0;for(h.length=0,r.left=0,r.top=0,r.width=e,r.height=i,g=0;g<l.length;g++)if(d=l[g],d&&(c=this._getRect(d),r.width<=c.width+o&&r.height<=c.height+o)){u=!0,r.left=c.left,r.top=c.top;break}if(u||(n?(r.left=t.width,r.top=0):(r.left=0,r.top=t.height),s||(_=!0)),!n&&r.top+r.height>t.height+o&&(r.left>a&&h.push(this._addRect(0,t.height,r.left,1/0)),r.left+r.width<t.width-a&&h.push(this._addRect(r.left+r.width,t.height,t.width-r.left-r.width,1/0)),t.height=r.top+r.height),n&&r.left+r.width>t.width+o&&(r.top>a&&h.push(this._addRect(t.width,0,1/0,r.top)),r.top+r.height<t.height-a&&h.push(this._addRect(t.width,r.top+r.height,1/0,t.height-r.top-r.height)),t.width=r.left+r.width),!_)for(s&&(g=0);g<l.length;g++){if(d=l[g],!d)continue;c=this._getRect(d);const e=this._splitRect(c,r);for(m=0;m<e.length;m++)d=e[m],c=this._getRect(d),(n?c.left+o<t.width-o:c.top+o<t.height-o)&&h.push(d)}return h.length>1&&this._purgeRects(h).sort(n?this._sortRectsLeftTop:this._sortRectsTopLeft),this._currentRects=h,this._nextRects=l,r}_addRect(t,e,i,s){const n=++this._rectId;return this._rectStore[n]=t||0,this._rectStore[++this._rectId]=e||0,this._rectStore[++this._rectId]=i||0,this._rectStore[++this._rectId]=s||0,n}_getRect(t,e){return(e=e||this._rectTarget).left=this._rectStore[t]||0,e.top=this._rectStore[++t]||0,e.width=this._rectStore[++t]||0,e.height=this._rectStore[++t]||0,e}_splitRect(t,e){const{_shards:i}=this;let s=0,n=0;return i.length=0,t.left+t.width<=e.left+o||e.left+e.width<=t.left+o||t.top+t.height<=e.top+o||e.top+e.height<=t.top+o?(i.push(this._addRect(t.left,t.top,t.width,t.height)),i):(s=e.left-t.left,s>=a&&i.push(this._addRect(t.left,t.top,s,t.height)),s=t.left+t.width-(e.left+e.width),s>=a&&i.push(this._addRect(e.left+e.width,t.top,s,t.height)),n=e.top-t.top,n>=a&&i.push(this._addRect(t.left,t.top,t.width,n)),n=t.top+t.height-(e.top+e.height),n>=a&&i.push(this._addRect(t.left,e.top+e.height,t.width,n)),i)}_isRectAWithinRectB(t,e){return t.left+o>=e.left&&t.top+o>=e.top&&t.left+t.width-o<=e.left+e.width&&t.top+t.height-o<=e.top+e.height}_purgeRects(t){const{_tempRectA:e,_tempRectB:i}=this;let s=t.length,n=0;for(;s--;)if(n=t.length,t[s])for(this._getRect(t[s],e);n--;)if(t[n]&&s!==n&&(this._getRect(t[n],i),this._isRectAWithinRectB(e,i))){t[s]=0;break}return t}_sortRectsTopLeft(t,e){const{_tempRectA:i,_tempRectB:s}=this;return this._getRect(t,i),this._getRect(e,s),i.top<s.top&&i.top+o<s.top?-1:i.top>s.top&&i.top-o>s.top?1:i.left<s.left&&i.left+o<s.left?-1:i.left>s.left&&i.left-o>s.left?1:0}_sortRectsLeftTop(t,e){const{_tempRectA:i,_tempRectB:s}=this;return this._getRect(t,i),this._getRect(e,s),i.left<s.left&&i.left+o<s.left?-1:i.left>s.left&&i.left-o<s.left?1:i.top<s.top&&i.top+o<s.top?-1:i.top>s.top&&i.top-o>s.top?1:0}};if(t){const t=self,e=1,i=2,s=3,n=4;t.onmessage=function(r){const o=new Float32Array(r.data),a=o.subarray(n,o.length),l=new Float32Array(a.length),c=o[s],d={items:a,slots:l,width:o[e],height:o[i]};h.computeLayout(d,c),o[e]=d.width,o[i]=d.height,o.set(d.slots,n),t.postMessage(o.buffer,[o.buffer])}}return h}let blobUrl="";const allWorkers=new Set;function createWorkerProcessors(t,e){const i=[];if(t>0){blobUrl||(blobUrl=URL.createObjectURL(new Blob(["("+createPackerProcessor.toString()+")(true)"],{type:"application/javascript"})));let s=0;for(;s<t;s++){const t=new Worker(blobUrl);t.onmessage=e,i.push(t),allWorkers.add(t)}}return i}function destroyWorkerProcessors(t){let e=0;for(;e<t.length;e++){const i=t[e];i.onmessage=null,i.onerror=null,i.onmessageerror=null,i.terminate(),allWorkers.delete(i)}blobUrl&&!allWorkers.size&&(URL.revokeObjectURL(blobUrl),blobUrl="")}const SETTINGS={fillGaps:1,horizontal:2,alignRight:4,alignBottom:8,rounding:16},PACKET_INDEX={id:0,width:1,height:2,settings:3,slots:4},PACKER_PROCESSOR=createPackerProcessor();class Packer{constructor(t=0,e){this._settings=0,this._asyncMode=!0,this._workers=[],this._layoutWorkerQueue=[],this._layoutsProcessing=new Set,this._layoutWorkerData=new Map,this._onWorkerMessage=this._onWorkerMessage.bind(this),e&&this.updateSettings(e);try{this._workers=createWorkerProcessors(t,this._onWorkerMessage),this._asyncMode=!!this._workers.length}catch(t){}}updateSettings(t){let e=this._settings&SETTINGS.fillGaps;"boolean"==typeof t.fillGaps&&(e=t.fillGaps?SETTINGS.fillGaps:0);let i=this._settings&SETTINGS.horizontal;"boolean"==typeof t.horizontal&&(i=t.horizontal?SETTINGS.horizontal:0);let s=this._settings&SETTINGS.alignRight;"boolean"==typeof t.alignRight&&(s=t.alignRight?SETTINGS.alignRight:0);let n=this._settings&SETTINGS.alignBottom;"boolean"==typeof t.alignBottom&&(n=t.alignBottom?SETTINGS.alignBottom:0);let r=this._settings&SETTINGS.rounding;"boolean"==typeof t.rounding&&(r=t.rounding?SETTINGS.rounding:0),this._settings=e|i|s|n|r}createLayout(t,e,i,s){if(this._layoutWorkerData.has(t))throw new Error("A layout with the provided id is currently being processed.");const n=!this._asyncMode||!e.length,r=this._settings&SETTINGS.horizontal,o={id:t,items:e,slots:new Float32Array(n?2*e.length:0),width:r?0:i.width,height:r?i.height:0,styles:{}};if(n)return e.length&&PACKER_PROCESSOR.computeLayout(o,this._settings),this._setContainerStyles(o,i,this._settings),void s(o);const a=new Float32Array(PACKET_INDEX.slots+2*e.length);a[PACKET_INDEX.id]=t,a[PACKET_INDEX.width]=o.width,a[PACKET_INDEX.height]=o.height,a[PACKET_INDEX.settings]=this._settings;let l=0,h=PACKET_INDEX.slots-1;for(;l<e.length;l++){const t=e[l];a[++h]=t.width+(t.marginLeft||0)+(t.marginRight||0),a[++h]=t.height+(t.marginTop||0)+(t.marginBottom||0)}return this._layoutWorkerQueue.push(t),this._layoutWorkerData.set(t,Object.assign(Object.assign({},o),{container:i,settings:this._settings,callback:s,packet:a,aborted:!1})),this._sendToWorker(),this.cancelLayout.bind(this,t)}cancelLayout(t){const e=this._layoutWorkerData.get(t);if(e&&!e.aborted)if(e.worker)e.aborted=!0;else{const e=this._layoutWorkerQueue.indexOf(t);this._layoutWorkerQueue.splice(e,1),this._layoutWorkerData.delete(t)}}destroy(){this._layoutWorkerData.forEach((t=>{this.cancelLayout(t.id),t.worker&&this._workers.push(t.worker)})),this._layoutWorkerData.clear(),this._layoutsProcessing.clear(),this._layoutWorkerQueue.length=0,destroyWorkerProcessors(this._workers),this._workers.length=0}_sendToWorker(){if(!this._layoutWorkerQueue.length||!this._workers.length)return;const t=this._workers.pop(),e=this._layoutWorkerQueue.shift(),i=this._layoutWorkerData.get(e);i.worker=t,this._layoutsProcessing.add(e);const{buffer:s}=i.packet;t.postMessage(s,[s])}_onWorkerMessage(t){const e=new Float32Array(t.data),i=e[PACKET_INDEX.id],s=this._layoutWorkerData.get(i);if(this._layoutWorkerData.delete(i),this._layoutsProcessing.delete(i),!s)return;const{worker:n}=s;if(n&&this._workers.push(n),!s.aborted){const t={id:i,items:s.items,slots:e.subarray(PACKET_INDEX.slots,e.length),width:e[PACKET_INDEX.width],height:e[PACKET_INDEX.height],styles:{}};this._setContainerStyles(t,s.container,s.settings),s.callback(t)}n&&this._sendToWorker()}_setContainerStyles(t,e,i){const s=!!(i&SETTINGS.horizontal),n="border-box"===e.boxSizing,{borderLeft:r=0,borderRight:o=0,borderTop:a=0,borderBottom:l=0}=e,{styles:h,width:c,height:d}=t;s?h.width=(n?c+r+o:c)+"px":h.height=(n?d+a+l:d)+"px"}}let debounceId=0;function debounce(t,e){let i=++debounceId,s=0,n=0,r=!1,o=e=>{r||(n&&(s-=e-n),n=e,s>0?o&&addDebounceTick(i,o):(s=n=0,t()))};return function(a=!1){if(!r){if(!(e<=0))return!0===a?(r=!0,s=n=0,o=void 0,void cancelDebounceTick(i)):void(s<=0?(s=e,o&&o(0)):s=e);!0!==a&&t()}}}const htmlCollectionType="[object HTMLCollection]",nodeListType="[object NodeList]";function isNodeListOrHTMLCollection(t){const e=Object.prototype.toString.call(t);return e===htmlCollectionType||e===nodeListType}const toString=Object.prototype.toString;function isPlainObject(t){return"object"==typeof t&&"[object Object]"===toString.call(t)}function toArray(t){return isNodeListOrHTMLCollection(t)?Array.prototype.slice.call(t):Array.prototype.concat(t)}let layoutId=0;function createSettings(t,e={}){let i=mergeObjects({},t);return i=mergeObjects(i,e),e.visibleStyles?i.visibleStyles=Object.assign({},e.visibleStyles):t.visibleStyles&&(i.visibleStyles=Object.assign({},t.visibleStyles)),e.hiddenStyles?i.hiddenStyles=Object.assign({},e.hiddenStyles):t.hiddenStyles&&(i.hiddenStyles=Object.assign({},t.hiddenStyles)),i}function mergeObjects(t,e){const i=Object.keys(e),s=i.length;let n=0;for(;n<s;n++){const s=i[n],r=isPlainObject(e[s]);isPlainObject(t[s])&&r?t[s]=mergeObjects(mergeObjects({},t[s]),e[s]):r?t[s]=mergeObjects({},e[s]):Array.isArray(e[s])?t[s]=e[s].slice(0):t[s]=e[s]}return t}function getInitialGridElements(t,e){if("*"===e)return t.children;if("string"==typeof e){const i=[],s=t.children;let n=0;for(;n<s.length;n++)s[n].matches(e)&&i.push(s[n]);return i}return Array.isArray(e)||isNodeListOrHTMLCollection(e)?e:[]}function normalizeStyles(t){const e={},i=document.documentElement.style;let s,n;for(s in t)t[s]&&(n=getPrefixedPropName(i,s),n&&(e[n]=t[s]));return e}function createIndexMap(t){const e={};let i=0;for(;i<t.length;i++)e[t[i].id]=i;return e}function compareIndexMap(t,e,i){return t[e.id]-t[i.id]}function isEqualObjects(t,e){let i;for(i in t)if(t[i]!==e[i])return!1;return Object.keys(t).length===Object.keys(e).length}class Grid{constructor(t,e={}){if("string"==typeof t){const e=document.querySelector(t);if(!e)throw new Error("No container element found.");t=e}if(!t.isConnected||t===document.documentElement)throw new Error("Container element must be an existing DOM element.");const i=createSettings(Grid.defaultOptions,e);i.visibleStyles=normalizeStyles(i.visibleStyles),i.hiddenStyles=normalizeStyles(i.hiddenStyles),this.id=createUid(),this.element=t,this.settings=i,this.items=[],this._isDestroyed=!1,this._layoutNeedsDimensionsRefresh=!1,this._visibilityNeedsDimensionsRefresh=!1,this._rect={width:0,height:0,left:0,right:0,top:0,bottom:0},this._borderLeft=0,this._borderRight=0,this._borderTop=0,this._borderBottom=0,this._boxSizing="",this._layout={id:0,items:[],slots:[]},this._isLayoutFinished=!0,this._nextLayoutData=null,this._resizeHandler=null,this._emitter=new Emitter,GRID_INSTANCES.set(this.id,this),addClass(t,i.containerClass),this._bindLayoutOnResize(i.layoutOnResize),this.add(getInitialGridElements(t,i.items),{layout:!1}),i.layoutOnInit&&this.layout(!0)}on(t,e){return this._emitter.on(t,e),this}off(t,e){return this._emitter.off(t,e),this}isDestroyed(){return this._isDestroyed}getItem(t){if(this._isDestroyed||!t&&0!==t)return null;if("number"==typeof t)return this.items[t>-1?t:this.items.length+t]||null;if(t instanceof Item)return t._gridId===this.id?t:null;const e=ITEM_ELEMENT_MAP.get(t);return e&&e._gridId===this.id?e:null}getItems(t){if(this._isDestroyed||void 0===t)return this.items.slice(0);const e=[];if(Array.isArray(t)||isNodeListOrHTMLCollection(t)){let i,s=0;for(;s<t.length;s++)i=this.getItem(t[s]),i&&e.push(i)}else{const i=this.getItem(t);i&&e.push(i)}return e}updateSettings(t){if(this._isDestroyed||!t)return this;const{settings:e,items:i}=this,s=[];let n=!1,r=!1,o=!1,a=!1,l=!1,h=!1;const c=createSettings(e,t);c.visibleStyles=normalizeStyles(c.visibleStyles),c.hiddenStyles=normalizeStyles(c.hiddenStyles),this.settings=c;for(let i in t)switch(i){case"visibleStyles":l=!isEqualObjects(e[i],c[i]);break;case"hiddenStyles":h=!isEqualObjects(e[i],c[i]);break;case"dragEnabled":n=e[i]!==c[i];break;case"dragHandle":r=e[i]!==c[i];break;case"dragCssProps":o=!isEqualObjects(e[i],c[i]);break;case"dragEventListenerOptions":a=!isEqualObjects(e[i],c[i]);break;case"layoutOnResize":e[i]!==c[i]&&(this._unbindLayoutOnResize(),this._bindLayoutOnResize(c[i]));break;case"containerClass":e[i]!==c[i]&&(removeClass(this.element,e[i]),addClass(this.element,c[i]));break;case"itemClass":case"itemVisibleClass":case"itemHiddenClass":case"itemPositioningClass":case"itemDraggingClass":case"itemReleasingClass":case"itemPlaceholderClass":e[i]!==c[i]&&s.push(i,e[i],c[i])}if(s.length||l||h||n||r||o||a){let t,e;for(t=0;t<i.length;t++){const d=i[t];for(e=0;e<s.length;e+=3){const t=s[e],i=s[e+1],n=s[e+2];let r=!1;switch(t){case"itemClass":r=!0;break;case"itemVisibleClass":r=d.isVisible();break;case"itemHiddenClass":r=!d.isVisible();break;case"itemPositioningClass":r=d.isPositioning();break;case"itemDraggingClass":r=d.isDragging();break;case"itemReleasingClass":r=d.isReleasing();break;case"itemPlaceholderClass":d._dragPlaceholder.updateClassName(n)}r&&(removeClass(d.element,i),addClass(d.element,n))}d.isActive()?l&&(d._visibility.setStyles(c.visibleStyles),d._visibility.stop(!0)):h&&(d._visibility.setStyles(c.hiddenStyles),d._visibility.stop(!0)),(r||n)&&d._drag&&d._drag.getOriginGrid()===this&&(d._drag.destroy(),d._drag=null),c.dragEnabled&&(d._drag?d._drag.getOriginGrid()===this&&(o&&d._drag.dragger.setCssProps(c.dragCssProps),a&&d._drag.dragger.setListenerOptions(c.dragEventListenerOptions)):d._drag=new ItemDrag(d))}}return"sortData"in t&&this.refreshSortData(),this}refreshItems(t,e=!1){if(this._isDestroyed)return this;const i=t||this.items;let s,n,r,o;if(!0===e)for(o=[],s=0;s<i.length;s++)n=i[s],n.isVisible()||n.isHiding()||(r=n.element.style,r.visibility="hidden",r.display="",o.push(r));for(s=0;s<i.length;s++)i[s]._updateDimensions(e);if(o){for(s=0;s<o.length;s++)r=o[s],r.visibility="",r.display="none";o.length=0}return this}refreshSortData(t){if(this._isDestroyed)return this;const e=t||this.items;let i=0;for(;i<e.length;i++)e[i]._updateSortData();return this}synchronize(){if(this._isDestroyed)return this;const{items:t}=this;if(!t.length)return this;let e,i,s=0;for(;s<t.length;s++)i=t[s].element,i.parentNode===this.element&&(e||(e=document.createDocumentFragment()),e.appendChild(i));return e?(this.element.appendChild(e),this._emit("synchronize"),this):this}layout(t=!1,e){if(this._isDestroyed)return this;const i=this._nextLayoutData;i&&isFunction(i.cancel)&&i.cancel();const s=layoutId=layoutId%16777216+1;this._nextLayoutData={id:s,instant:t,onFinish:e,cancel:null};const{items:n}=this,r=[];let o=0;for(;o<n.length;o++)n[o].isActive()&&r.push(n[o]);this._updateDimensions();const a={width:this._rect.width-this._borderLeft-this._borderRight,height:this._rect.height-this._borderTop-this._borderBottom,borderLeft:this._borderLeft,borderRight:this._borderRight,borderTop:this._borderTop,borderBottom:this._borderBottom,boxSizing:this._boxSizing},{layout:l}=this.settings;let h;return isFunction(l)?h=l(s,this,r,a,(t=>{this._onLayoutDataReceived(t)})):(Grid.defaultPacker.updateSettings(l),h=Grid.defaultPacker.createLayout(s,r,a,(t=>{this._onLayoutDataReceived(Object.assign(Object.assign({},t),{items:r}))}))),isFunction(h)&&this._nextLayoutData&&this._nextLayoutData.id===s&&(this._nextLayoutData.cancel=h),this}add(t,e={}){if(this._isDestroyed||!t)return[];const i=toArray(t);if(!i.length)return[];const s=e.layout?e.layout:void 0===e.layout,{items:n}=this;let r,o,a,l,h=!1;for(l=0;l<i.length;l++)o=i[l],o.parentNode!==this.element&&(r=r||document.createDocumentFragment(),r.appendChild(o));r&&this.element.appendChild(r);const c=[];for(l=0;l<i.length;l++)o=i[l],a=c[l]=new Item(this,o,e.active),a.isActive()&&(h=!0,a._layout._skipNextAnimation=!0);for(l=0;l<c.length;l++)a=c[l],a._updateDimensions(),a._updateSortData();return arrayInsert(n,c,e.index),this._hasListeners("add")&&this._emit("add",c.slice(0)),h&&s&&this.layout("instant"===s,isFunction(s)?s:void 0),c}remove(t,e={}){if(this._isDestroyed||!t.length)return[];const i=e.layout?e.layout:void 0===e.layout,s=this.getItems(),n=[],r=[];let o,a,l,h=!1;for(l=0;l<t.length;l++)a=t[l],a.isDestroyed()||(o=this.items.indexOf(a),-1!==o&&(a.isActive()&&(h=!0),n.push(a),r.push(s.indexOf(a)),a._destroy(e.removeElements),this.items.splice(o,1)));return this._hasListeners("remove")&&this._emit("remove",n.slice(0),r),h&&i&&this.layout("instant"===i,isFunction(i)?i:void 0),n}show(t,e={}){return!this._isDestroyed&&t.length&&this._setItemsVisibility(t,!0,e),this}hide(t,e={}){return!this._isDestroyed&&t.length&&this._setItemsVisibility(t,!1,e),this}filter(t,e={}){if(this._isDestroyed||!this.items.length)return this;const i=[],s=[];if(isFunction(t)||"string"==typeof t){let e,n;for(n=0;n<this.items.length;n++)e=this.items[n],(isFunction(t)?t(e):e.element.matches(t))?i.push(e):s.push(e)}const n=isFunction(e.onFinish)?e.onFinish:void 0;let r=[],o=[],a=-1;if(i.length?this.show(i,{instant:!!e.instant,syncWithLayout:!!e.syncWithLayout,onFinish:n?t=>{r=t,++a&&n(r,o)}:void 0,layout:!1}):n&&++a&&n(r,o),s.length?this.hide(s,{instant:!!e.instant,syncWithLayout:!!e.syncWithLayout,onFinish:n?t=>{o=t,++a&&n(r,o)}:void 0,layout:!1}):n&&++a&&n(r,o),i.length||s.length){this._hasListeners("filter")&&this._emit("filter",i.slice(0),s.slice(0));const t=e.layout?e.layout:void 0===e.layout;t&&this.layout("instant"===t,isFunction(t)?t:void 0)}return this}sort(t,e={}){if(this._isDestroyed||this.items.length<2)return this;const{items:i}=this,s=i.slice(0),n=e.layout?e.layout:void 0===e.layout,r=!!e.descending;let o=null;if(isFunction(t))i.sort(((e,i)=>{let n=r?-t(e,i):t(e,i);return n||(o||(o=createIndexMap(s)),n=r?compareIndexMap(o,i,e):compareIndexMap(o,e,i)),n}));else if("string"==typeof t){const e=t.trim().split(" ").filter((function(t){return t})).map((function(t){return t.split(":")}));i.sort(((t,i)=>{let n=0,a=0;for(;a<e.length;a++){const s=e[a][0],o=e[a][1];null===t._sortData&&t._updateSortData(),null===i._sortData&&i._updateSortData();const l=t._sortData[s],h=i._sortData[s];if(n="desc"===o||!o&&r?h<l?-1:h>l?1:0:l<h?-1:l>h?1:0,n)return n}return n||(o||(o=createIndexMap(s)),n=r?compareIndexMap(o,i,t):compareIndexMap(o,t,i)),n}))}else{if(!Array.isArray(t))throw new Error("Invalid comparer argument provided.");i.length=0,i.push.apply(i,t)}return this._hasListeners("sort")&&this._emit("sort",i.slice(0),s),n&&this.layout("instant"===n,isFunction(n)?n:void 0),this}move(t,e,i={}){if(this._isDestroyed||this.items.length<2)return this;const{items:s}=this,n=i.layout?i.layout:void 0===i.layout,r="swap"===i.action,o=r?"swap":"move",a=this.getItem(t),l=this.getItem(e);if(a&&l&&a!==l){const t=s.indexOf(a),e=s.indexOf(l);r?arraySwap(s,t,e):arrayMove(s,t,e),this._hasListeners("move")&&this._emit("move",{item:a,fromIndex:t,toIndex:e,action:o}),n&&this.layout("instant"===n,isFunction(n)?n:void 0)}return this}send(t,e,i,s={}){if(this._isDestroyed||e._isDestroyed||this===e)return this;const n=this.getItem(t);if(!n)return this;if(n._migrate.start(e,i,s.appendTo||document.body),n._migrate.isActive()&&n.isActive()){const t=s.layoutSender?s.layoutSender:void 0===s.layoutSender,i=s.layoutReceiver?s.layoutReceiver:void 0===s.layoutReceiver;t&&this.layout("instant"===t,isFunction(t)?t:void 0),i&&e.layout("instant"===i,isFunction(i)?i:void 0)}return this}destroy(t=!1){if(this._isDestroyed)return this;const e=this.element,i=this.getItems(),s=this._layout&&this._layout.styles||{};this._unbindLayoutOnResize();let n,r=0;for(;r<i.length;r++)i[r]._destroy(t);for(n in this.items.length=0,removeClass(e,this.settings.containerClass),s)e.style[n]="";return GRID_INSTANCES.delete(this.id),this._isDestroyed=!0,this._emitter.emit("destroy"),this._emitter.off(),this}_emit(t,...e){this._isDestroyed||this._emitter.emit(t,...e)}_hasListeners(t){return!this._isDestroyed&&this._emitter.listenerCount(t)>0}_updateBoundingRect(){const{_rect:t}=this,{width:e,height:i,left:s,right:n,top:r,bottom:o}=this.element.getBoundingClientRect();t.width=e,t.height=i,t.left=s,t.right=n,t.top=r,t.bottom=o}_updateBorders(t,e,i,s){const{element:n}=this;t&&(this._borderLeft=getStyleAsFloat(n,"border-left-width")),e&&(this._borderRight=getStyleAsFloat(n,"border-right-width")),i&&(this._borderTop=getStyleAsFloat(n,"border-top-width")),s&&(this._borderBottom=getStyleAsFloat(n,"border-bottom-width"))}_updateDimensions(){this._updateBoundingRect(),this._updateBorders(!0,!0,!0,!0),this._boxSizing=getStyle(this.element,"box-sizing")}_bindLayoutOnResize(t){"number"!=typeof t&&(t=!0===t?0:-1),t>=0&&(this._resizeHandler=debounce((()=>{this.refreshItems().layout()}),t),window.addEventListener("resize",this._resizeHandler))}_unbindLayoutOnResize(){const{_resizeHandler:t}=this;isFunction(t)&&(t(!0),window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null)}_onLayoutDataReceived(t){if(this._isDestroyed||!this._nextLayoutData||this._nextLayoutData.id!==t.id)return;const{instant:e,onFinish:i}=this._nextLayoutData,s=t.items.length;let n,r,o,a,l=s;this._nextLayoutData=null,!this._isLayoutFinished&&this._hasListeners("layoutAbort")&&this._emit("layoutAbort",this._layout.items.slice(0)),this._layout=t;const h=[];for(a=0;a<s;a++)n=t.items[a],n?(r=t.slots[2*a],o=t.slots[2*a+1],n._canSkipLayout(r,o)?--l:(n.left=r,n.top=o,n.isActive()&&!n.isDragging()?h.push(n):--l)):--l;if(t.styles&&setStyles(this.element,t.styles),this._hasListeners("layoutStart")&&(this._emit("layoutStart",t.items.slice(0),e),this._layout.id!==t.id))return;const c=()=>{if(--l>0)return;const e=this._layout.id!==t.id;e||(this._isLayoutFinished=!0),isFunction(i)&&i(t.items.slice(0),e),!e&&this._hasListeners("layoutEnd")&&this._emit("layoutEnd",t.items.slice(0))};if(h.length)for(this._isLayoutFinished=!1,a=0;a<h.length&&this._layout.id===t.id;a++)h[a]._layout.start(e,c);else c()}_setItemsVisibility(t,e,i={}){const s=t.slice(0),n=!0===i.instant,r=i.onFinish,o=i.layout?i.layout:void 0===i.layout,a=e?"showStart":"hideStart",l=e?"showEnd":"hideEnd",h=e?"show":"hide",c=[],d=[];let _,u,g=!1,m=s.length;if(!m)return void(isFunction(r)&&r(s));for(u=0;u<s.length;u++)_=s[u],(e&&!_.isActive()||!e&&_.isActive())&&(g=!0),_._layout._skipNextAnimation=!(!e||_.isActive()),!e||_.isVisible()||_.isHiding()||d.push(_),e?_._addToLayout():_._removeFromLayout();d.length&&(this.refreshItems(d,!0),d.length=0);const f=()=>{for(g&&!1!==i.syncWithLayout&&this.off("layoutStart",f),this._hasListeners(a)&&this._emit(a,s.slice(0)),u=0;u<s.length;u++)_=s[u],_._gridId===this.id?_._visibility[h](n,((t,e)=>{t||c.push(e),--m<1&&(isFunction(r)&&r(c.slice(0)),this._hasListeners(l)&&this._emit(l,c.slice(0)))})):--m<1&&(isFunction(r)&&r(c.slice(0)),this._hasListeners(l)&&this._emit(l,c.slice(0)))};g&&!1!==i.syncWithLayout?this.on("layoutStart",f):f(),g&&o&&this.layout("instant"===o,isFunction(o)?o:void 0)}}Grid.defaultPacker=new Packer,Grid.defaultOptions={items:"*",showDuration:300,showEasing:"ease",hideDuration:300,hideEasing:"ease",visibleStyles:{opacity:"1",transform:"scale(1)"},hiddenStyles:{opacity:"0",transform:"scale(0.5)"},layout:{fillGaps:!1,horizontal:!1,alignRight:!1,alignBottom:!1,rounding:!1},layoutOnResize:150,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",sortData:null,translate3d:!1,dragEnabled:!1,dragContainer:null,dragHandle:null,dragStartPredicate:{distance:0,delay:0},dragAxis:"xy",dragSort:!0,dragSortHeuristics:{sortInterval:100,minDragDistance:10,minBounceBackAngle:1},dragSortPredicate:{threshold:50,action:"move",migrateAction:"move"},dragRelease:{duration:300,easing:"ease",useDragContainer:!0},dragCssProps:{touchAction:"none",userSelect:"none",userDrag:"none",tapHighlightColor:"rgba(0, 0, 0, 0)",touchCallout:"none",contentZooming:"none"},dragEventListenerOptions:{passive:!0,capture:!1},dragPlaceholder:{enabled:!1,createElement:null,onCreate:null,onRemove:null},dragAutoScroll:{targets:[],handle:null,threshold:50,safeZone:.2,speed:AutoScroller.smoothSpeed(1e3,2e3,2500),sortDuringScroll:!0,smoothStop:!1,onStart:null,onStop:null},containerClass:"muuri",itemClass:"muuri-item",itemVisibleClass:"muuri-item-shown",itemHiddenClass:"muuri-item-hidden",itemPositioningClass:"muuri-item-positioning",itemDraggingClass:"muuri-item-dragging",itemReleasingClass:"muuri-item-releasing",itemPlaceholderClass:"muuri-item-placeholder",_animationWindowing:!1};export{Animator,AutoScroller,Dragger,Grid,Item,ItemDrag,ItemDragPlaceholder,ItemDragRelease,ItemLayout,ItemMigrate,ItemVisibility,PHASE_READ,PHASE_READ_TAIL,PHASE_SETUP,PHASE_WRITE,Packer,addAutoScrollTick,addDebounceTick,addDragMoveTick,addDragScrollTick,addDragSortTick,addDragStartTick,addLayoutTick,addPlaceholderLayoutTick,addPlaceholderResizeTick,addReleaseScrollTick,addVisibilityTick,cancelAutoScrollTick,cancelDebounceTick,cancelDragMoveTick,cancelDragScrollTick,cancelDragSortTick,cancelDragStartTick,cancelLayoutTick,cancelPlaceholderLayoutTick,cancelPlaceholderResizeTick,cancelReleaseScrollTick,cancelVisibilityTick,ticker};